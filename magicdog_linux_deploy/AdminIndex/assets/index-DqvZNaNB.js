import{d as se,r as p,p as $,i as oe,o as v,b as g,f as s,w as n,h as o,B as b,_ as k,g as i,e as l,N as z,al as U,H as le,bT as B,cw as ne,ae as O,t as f,J as F,I,a2 as m,K as C,cx as A,cy as ie}from"./index-UyGIsgrM.js";import{f as re,a as de,c as ue,u as ce,b as pe,d as ve}from"./session-B6E-48fm.js";import{N as _}from"./text-BzkzQO8Z.js";import{N as E}from"./Space-sSsMuOHt.js";import{N as ge}from"./DataTable-Ctoc5GeF.js";import{N as fe}from"./Popconfirm-DxrwBVke.js";import"./get-slot-Bk_rJcZu.js";import"./Pagination-CWXxq3CH.js";const me={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},_e={class:"mb-4"},ye={class:"space-y-4"},xe={key:0,class:"space-y-4"},we={key:0,class:"space-y-6"},be={class:"grid grid-cols-3 gap-4"},ke={class:"rounded-lg bg-blue-50 p-4 text-center dark:bg-blue-900/20"},he={class:"text-2xl text-blue-600 font-bold"},ze={class:"rounded-lg bg-green-50 p-4 text-center dark:bg-green-900/20"},Ce={class:"text-2xl text-green-600 font-bold"},Ne={class:"rounded-lg bg-gray-50 p-4 text-center dark:bg-gray-900/20"},Se={class:"text-2xl text-gray-600 font-bold"},Pe={class:"space-y-2"},$e={class:"flex items-center gap-2"},Ue={class:"text-sm text-gray-600 dark:text-gray-400"},De={class:"font-medium"},Te={class:"max-h-200px overflow-y-auto space-y-2"},je={class:"flex items-center gap-2"},Be={class:"text-sm"},Ee={class:"text-xs text-gray-500"},Me={key:0,class:"py-4 text-center text-gray-500"},Oe={key:1,class:"py-8 text-center"},Fe=se({name:"payment_card-notes",__name:"index",setup(Ie){const D=p(!1),M=p([]),T=p([]),y=p(null),r=$({page:1,pageSize:20,total:0,showSizePicker:!0,pageSizes:[10,20,50,100]}),u=$({page:1,size:20,card_prefix:"",tag_color:"",is_active:void 0}),N=p(!1),S=p(!1),j=p(!1),h=p(null),d=$({card_prefix:"",note_content:"",tag_color:"info"}),c=$({note_content:"",tag_color:"info",is_active:!0}),V=[{label:"全部",value:void 0},{label:"生效",value:!0},{label:"失效",value:!1}],P=p([]);async function x(){var a;try{D.value=!0,u.page=r.page,u.size=r.pageSize;const e=await re(u);e.data&&(M.value=e.data.notes,r.total=e.data.total,r.page=e.data.current)}catch(e){console.error("获取卡头备注列表失败:",e),(a=window.$message)==null||a.error("获取卡头备注列表失败")}finally{D.value=!1}}async function q(){var a;try{const e=await de();e.data&&(T.value=e.data.colors,P.value=e.data.colors.map(t=>({label:`${t.name}`,value:t.value,color:t.color})))}catch(e){console.error("获取标签颜色失败:",e),(a=window.$message)==null||a.error("获取标签颜色失败")}}async function J(){var a;try{const e=await pe();e.data&&(y.value=e.data)}catch(e){console.error("获取统计数据失败:",e),(a=window.$message)==null||a.error("获取统计数据失败")}}function H(){r.page=1,x()}function K(){Object.assign(u,{page:1,size:20,card_prefix:"",tag_color:"",is_active:void 0}),r.page=1,x()}function L(a){r.page=a,x()}function Q(a){r.pageSize=a,r.page=1,x()}function R(){Object.assign(d,{card_prefix:"",note_content:"",tag_color:"info"}),N.value=!0}async function G(){var a,e,t,w;try{if(!d.card_prefix||!d.note_content){(a=window.$message)==null||a.error("请填写完整信息");return}if(!/^\d{6,8}$/.test(d.card_prefix)){(e=window.$message)==null||e.error("卡头必须是6-8位数字");return}await ue(d),(t=window.$message)==null||t.success("添加卡头备注成功"),N.value=!1,x()}catch(ae){console.error("添加卡头备注失败:",ae),(w=window.$message)==null||w.error("添加卡头备注失败")}}function W(a){h.value=a,Object.assign(c,{note_content:a.note_content,tag_color:a.tag_color,is_active:a.is_active}),S.value=!0}async function X(){var a,e,t;try{if(!h.value)return;if(!c.note_content){(a=window.$message)==null||a.error("请填写备注内容");return}await ce(h.value.id,c),(e=window.$message)==null||e.success("更新卡头备注成功"),S.value=!1,x()}catch(w){console.error("更新卡头备注失败:",w),(t=window.$message)==null||t.error("更新卡头备注失败")}}async function Y(a){var e,t;try{await ve(a.id),(e=window.$message)==null||e.success("删除卡头备注成功"),x()}catch(w){console.error("删除卡头备注失败:",w),(t=window.$message)==null||t.error("删除卡头备注失败")}}function Z(){J(),j.value=!0}function ee(a){const e=T.value.find(t=>t.value===a);return e?e.name:a}const te=[{title:"ID",key:"id",width:80,align:"center"},{title:"卡头",key:"card_prefix",width:120,align:"center",render:a=>m(C,{type:"primary",size:"small",style:{fontFamily:"monospace"}},{default:()=>a.card_prefix})},{title:"备注内容",key:"note_content",width:200,ellipsis:{tooltip:!0}},{title:"标签颜色",key:"tag_color",width:120,align:"center",render:a=>m(C,{type:a.tag_color,size:"small"},{default:()=>ee(a.tag_color)})},{title:"状态",key:"is_active",width:100,align:"center",render:a=>m(C,{type:a.is_active?"success":"default",size:"small"},{default:()=>a.is_active?"生效":"失效"})},{title:"创建者",key:"created_by",width:100,align:"center"},{title:"创建时间",key:"create_time",width:180,align:"center",render:a=>A(a.create_time)},{title:"操作",key:"actions",width:150,align:"center",render:a=>m(E,{size:"small"},{default:()=>[m(b,{size:"small",type:"primary",quaternary:!0,onClick:()=>W(a)},{icon:()=>m(k,{icon:"carbon:edit"}),default:()=>"编辑"}),m(fe,{onPositiveClick:()=>Y(a)},{trigger:()=>m(b,{size:"small",type:"error",quaternary:!0},{icon:()=>m(k,{icon:"carbon:delete"}),default:()=>"删除"}),default:()=>`确定要删除卡头 ${a.card_prefix} 的备注吗？`})]})}];return oe(()=>{q(),x()}),(a,e)=>(v(),g("div",me,[s(o(le),{title:"卡头备注管理",class:"h-full",size:"small"},{"header-extra":n(()=>[s(o(E),null,{default:n(()=>[s(o(b),{type:"info",onClick:Z},{icon:n(()=>[s(k,{icon:"carbon:analytics"})]),default:n(()=>[e[12]||(e[12]=i(" 统计信息 "))]),_:1}),s(o(b),{type:"primary",onClick:R},{icon:n(()=>[s(k,{icon:"carbon:add"})]),default:n(()=>[e[13]||(e[13]=i(" 添加备注 "))]),_:1})]),_:1})]),default:n(()=>[l("div",_e,[s(o(E),{class:"mb-2"},{default:n(()=>[s(o(z),{value:u.card_prefix,"onUpdate:value":e[0]||(e[0]=t=>u.card_prefix=t),placeholder:"搜索卡头",style:{width:"200px"},clearable:""},null,8,["value"]),s(o(U),{value:u.tag_color,"onUpdate:value":e[1]||(e[1]=t=>u.tag_color=t),options:[{label:"全部颜色",value:""},...P.value],placeholder:"标签颜色",style:{width:"180px"},clearable:""},null,8,["value","options"]),s(o(U),{value:u.is_active,"onUpdate:value":e[2]||(e[2]=t=>u.is_active=t),options:V,placeholder:"状态",style:{width:"120px"}},null,8,["value"]),s(o(b),{type:"primary",onClick:H},{icon:n(()=>[s(k,{icon:"carbon:search"})]),default:n(()=>[e[14]||(e[14]=i(" 搜索 "))]),_:1}),s(o(b),{onClick:K},{icon:n(()=>[s(k,{icon:"carbon:reset"})]),default:n(()=>[e[15]||(e[15]=i(" 重置 "))]),_:1})]),_:1})]),s(o(ge),{columns:te,data:M.value,loading:D.value,pagination:{page:r.page,pageSize:r.pageSize,itemCount:r.total,showSizePicker:r.showSizePicker,pageSizes:r.pageSizes,showQuickJumper:!0,prefix:t=>`共 ${t.itemCount} 条`,onUpdatePage:L,onUpdatePageSize:Q},size:"small",remote:"",bordered:""},null,8,["data","loading","pagination"])]),_:1}),s(o(B),{show:N.value,"onUpdate:show":e[6]||(e[6]=t=>N.value=t),preset:"dialog",title:"添加卡头备注","positive-text":"确定","negative-text":"取消",onPositiveClick:G},{default:n(()=>[l("div",ye,[l("div",null,[s(o(_),{class:"mb-2 block"},{default:n(()=>e[16]||(e[16]=[i("卡头 *")])),_:1}),s(o(z),{value:d.card_prefix,"onUpdate:value":e[3]||(e[3]=t=>d.card_prefix=t),placeholder:"请输入6-8位数字卡头",maxlength:"8"},null,8,["value"]),s(o(_),{depth:"3",class:"mt-1 text-sm"},{default:n(()=>e[17]||(e[17]=[i("卡头必须是6-8位数字，例如：123456")])),_:1})]),l("div",null,[s(o(_),{class:"mb-2 block"},{default:n(()=>e[18]||(e[18]=[i("备注内容 *")])),_:1}),s(o(z),{value:d.note_content,"onUpdate:value":e[4]||(e[4]=t=>d.note_content=t),type:"textarea",placeholder:"请输入备注内容",rows:3,maxlength:"200","show-count":""},null,8,["value"])]),l("div",null,[s(o(_),{class:"mb-2 block"},{default:n(()=>e[19]||(e[19]=[i("标签颜色")])),_:1}),s(o(U),{value:d.tag_color,"onUpdate:value":e[5]||(e[5]=t=>d.tag_color=t),options:P.value,placeholder:"选择标签颜色"},null,8,["value","options"])])])]),_:1},8,["show"]),s(o(B),{show:S.value,"onUpdate:show":e[10]||(e[10]=t=>S.value=t),preset:"dialog",title:"编辑卡头备注","positive-text":"确定","negative-text":"取消",onPositiveClick:X},{default:n(()=>[h.value?(v(),g("div",xe,[l("div",null,[s(o(_),{class:"mb-2 block"},{default:n(()=>e[20]||(e[20]=[i("卡头")])),_:1}),s(o(z),{value:h.value.card_prefix,disabled:"",placeholder:"卡头不可修改"},null,8,["value"])]),l("div",null,[s(o(_),{class:"mb-2 block"},{default:n(()=>e[21]||(e[21]=[i("备注内容 *")])),_:1}),s(o(z),{value:c.note_content,"onUpdate:value":e[7]||(e[7]=t=>c.note_content=t),type:"textarea",placeholder:"请输入备注内容",rows:3,maxlength:"200","show-count":""},null,8,["value"])]),l("div",null,[s(o(_),{class:"mb-2 block"},{default:n(()=>e[22]||(e[22]=[i("标签颜色")])),_:1}),s(o(U),{value:c.tag_color,"onUpdate:value":e[8]||(e[8]=t=>c.tag_color=t),options:P.value,placeholder:"选择标签颜色"},null,8,["value","options"])]),l("div",null,[s(o(_),{class:"mb-2 block"},{default:n(()=>e[23]||(e[23]=[i("状态")])),_:1}),s(o(ne),{value:c.is_active,"onUpdate:value":e[9]||(e[9]=t=>c.is_active=t),"checked-value":!0,"unchecked-value":!1},{checked:n(()=>e[24]||(e[24]=[i("生效")])),unchecked:n(()=>e[25]||(e[25]=[i("失效")])),_:1},8,["value"])])])):O("",!0)]),_:1},8,["show"]),s(o(B),{show:j.value,"onUpdate:show":e[11]||(e[11]=t=>j.value=t),preset:"card",title:"卡头备注统计",style:{width:"600px"},"mask-closable":!1},{default:n(()=>[y.value?(v(),g("div",we,[l("div",null,[e[29]||(e[29]=l("h4",{class:"mb-3"},"基础统计",-1)),l("div",be,[l("div",ke,[l("div",he,f(y.value.basic_stats.total_notes),1),e[26]||(e[26]=l("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"总备注数",-1))]),l("div",ze,[l("div",Ce,f(y.value.basic_stats.active_notes),1),e[27]||(e[27]=l("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"生效备注",-1))]),l("div",Ne,[l("div",Se,f(y.value.basic_stats.inactive_notes),1),e[28]||(e[28]=l("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"失效备注",-1))])])]),l("div",null,[e[30]||(e[30]=l("h4",{class:"mb-3"},"标签颜色分布",-1)),l("div",Pe,[(v(!0),g(F,null,I(T.value,t=>(v(),g("div",{key:t.value,class:"flex items-center justify-between rounded bg-gray-50 p-2 dark:bg-gray-800"},[l("div",$e,[s(o(C),{type:t.value,size:"small"},{default:n(()=>[i(f(t.name),1)]),_:2},1032,["type"]),l("span",Ue,f(t.description),1)]),l("div",De,f(y.value.color_stats[t.value]||0),1)]))),128))])]),l("div",null,[e[31]||(e[31]=l("h4",{class:"mb-3"},"最近添加的备注",-1)),l("div",Te,[(v(!0),g(F,null,I(y.value.recent_notes,t=>(v(),g("div",{key:t.id,class:"flex items-center justify-between rounded bg-gray-50 p-2 dark:bg-gray-800"},[l("div",je,[s(o(C),{type:"primary",size:"small"},{default:n(()=>[i(f(t.card_prefix),1)]),_:2},1024),l("span",Be,f(t.note_content),1)]),l("div",Ee,f(o(A)(t.create_time)),1)]))),128)),y.value.recent_notes.length?O("",!0):(v(),g("div",Me,"暂无数据"))])])])):(v(),g("div",Oe,[s(o(_),null,{default:n(()=>e[32]||(e[32]=[i("加载统计数据中...")])),_:1})]))]),_:1},8,["show"])]))}}),Re=ie(Fe,[["__scopeId","data-v-d5c7b765"]]);export{Re as default};
