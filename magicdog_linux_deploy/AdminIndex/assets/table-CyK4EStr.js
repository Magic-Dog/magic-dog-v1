import{v as $,ag as j,p as I,ah as M,r as P,a as O,cW as A,x as N,$ as E,ak as W,l as H}from"./index-iA9TGKTo.js";function U(t){const{loading:d,startLoading:k,endLoading:i}=$(),{bool:v,setBool:p}=j(),{apiFn:b,apiParams:u,transformer:y,immediate:m=!0,getColumnChecks:S,getColumns:x}=t,n=I(M({...u})),h=P(t.columns()),C=P([]),f=P(S(t.columns())),w=O(()=>x(h.value,f.value));function _(){h.value=t.columns();const r=new Map(f.value.map(e=>[e.key,e.checked])),l=S(h.value);f.value=l.map(e=>({...e,checked:r.get(e.key)??e.checked}))}async function g(){var a;k();const r=D(n),l=await b(r),e=y(l);C.value=e.data,p(e.data.length===0),await((a=t.onFetched)==null?void 0:a.call(t,e)),i()}function D(r){const l={};return Object.entries(r).forEach(([e,a])=>{a!=null&&(l[e]=a)}),l}function c(r){Object.assign(n,r)}function T(){Object.assign(n,M(u))}return m&&g(),{loading:d,empty:v,data:C,columns:w,columnChecks:f,reloadColumns:_,getData:g,searchParams:n,updateSearchParams:c,resetSearchParams:T}}function V(t){const d=A(),k=N(),i=O(()=>k.isMobile),{apiFn:v,apiParams:p,immediate:b,showTotal:u}=t,y="__selection__",m="__expand__",{loading:S,empty:x,data:n,columns:h,columnChecks:C,reloadColumns:f,getData:w,searchParams:_,updateSearchParams:g,resetSearchParams:D}=U({apiFn:v,apiParams:p,columns:t.columns,transformer:t.transformer?t.transformer:e=>{const{records:a=[],current:s=1,size:z=10,total:o=0}=e.data||{},B=z<=0?10:z;return{data:a.map((K,L)=>({...K,index:(s-1)*B+L+1})),pageNum:s,pageSize:B,total:o}},getColumnChecks:e=>{const a=[];return e.forEach(s=>{F(s)?a.push({key:s.key,title:s.title,checked:!0}):s.type==="selection"?a.push({key:y,title:E("common.check"),checked:!0}):s.type==="expand"&&a.push({key:m,title:E("common.expandColumn"),checked:!0})}),a},getColumns:(e,a)=>{const s=new Map;return e.forEach(o=>{F(o)?s.set(o.key,o):o.type==="selection"?s.set(y,o):o.type==="expand"&&s.set(m,o)}),a.filter(o=>o.checked).map(o=>s.get(o.key))},onFetched:async e=>{const{pageNum:a,pageSize:s,total:z}=e;r({page:a,pageSize:s,itemCount:z})},immediate:b}),c=I({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,20,100,1e3],onUpdatePage:async e=>{c.page=e,g({current:e,size:c.pageSize}),w()},onUpdatePageSize:async e=>{c.pageSize=e,c.page=1,g({current:c.page,size:e}),w()},...u?{prefix:e=>E("datatable.itemCount",{total:e.itemCount})}:{}}),T=O(()=>({...c,pageSlot:i.value?3:9,prefix:!i.value&&u?c.prefix:void 0}));function r(e){Object.assign(c,e)}async function l(e=1){r({page:e}),g({current:e,size:c.pageSize}),await w()}return d.run(()=>{W(()=>k.locale,()=>{f()})}),H(()=>{d.stop()}),{loading:S,empty:x,data:n,columns:h,columnChecks:C,reloadColumns:f,pagination:c,mobilePagination:T,updatePagination:r,getData:w,getDataByPage:l,searchParams:_,updateSearchParams:g,resetSearchParams:D}}function X(t,d){const{bool:k,setTrue:i,setFalse:v}=j(),p=P("add");function b(){p.value="add",i()}const u=P(null);function y(n){p.value="edit";const h=t.value.find(C=>C.id===n)||null;u.value=M(h),i()}const m=P([]);async function S(){var n;(n=window.$message)==null||n.success(E("common.deleteSuccess")),m.value=[],await d()}async function x(){var n;(n=window.$message)==null||n.success(E("common.deleteSuccess")),await d()}return{drawerVisible:k,openDrawer:i,closeDrawer:v,operateType:p,handleAdd:b,editingData:u,handleEdit:y,checkedRowKeys:m,onBatchDeleted:S,onDeleted:x}}function F(t){return!!t.key}export{X as a,V as u};
