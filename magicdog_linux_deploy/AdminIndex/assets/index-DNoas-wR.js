import{d as Pt,av as Tt,cz as Dt,a as ge,$ as i,r as _,p as ne,cA as It,a2 as o,cx as Y,cs as We,K as h,cB as zt,B as Z,_ as D,ak as ps,i as Ut,as as Ot,o as y,b as T,f as c,w as p,e as a,h as r,J as Nt,I as Rt,al as le,g as m,t as u,b1 as Lt,bw as Et,N as R,H as jt,c as X,ae as S,af as Mt,bT as G,cw as At,cy as Vt}from"./index-Bo2hlNwJ.js";import{e as Ht,p as Bt,g as Ft,r as Wt,h as Jt,i as Qt,a as Kt,c as Gt,j as Yt,k as Zt}from"./session-aAhRLxLc.js";import{N as _e}from"./Space-Blq-uKwy.js";import{N as vs}from"./DatePicker-CLw6silI.js";import{N as Xt}from"./DataTable-BIGVZJtZ.js";import{N as I}from"./text-DXu7XxZW.js";import"./get-slot-Bk_rJcZu.js";import"./Pagination-x70VmHhT.js";const ea={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden bg-gray-50 lt-sm:overflow-auto dark:bg-gray-900"},sa={class:"mb-4"},ta={class:"mb-4"},aa={class:"advanced-search"},la={key:0,class:"detail-content"},ia={class:"flat-info-container"},na={class:"info-row"},oa={class:"info-cell"},ra={class:"cell-value"},ca={class:"info-cell"},ua={class:"info-cell"},da={class:"info-cell"},pa={class:"cell-value"},va={class:"info-cell"},fa={class:"cell-value"},ma={class:"info-row"},ga={key:0,class:"info-cell"},_a={key:1,class:"info-cell"},ya={key:2,class:"info-cell"},ba={key:3,class:"info-cell"},xa={class:"info-cell"},ha={class:"cell-value"},wa={class:"info-row"},ka={class:"info-cell"},qa={class:"cell-value"},$a={key:0,class:"info-cell"},Ca={key:1,class:"info-cell"},Sa={key:2,class:"info-cell"},Pa={class:"info-row"},Ta={class:"info-cell"},Da={class:"cell-value"},Ia={class:"info-cell"},za={class:"cell-value"},Ua={class:"info-cell"},Oa={class:"cell-value"},Na={class:"info-cell"},Ra={class:"cell-value"},La={class:"info-row"},Ea={class:"info-cell"},ja={class:"cell-value"},Ma={class:"info-cell"},Aa={class:"cell-value"},Va={class:"info-cell"},Ha={class:"cell-value"},Ba={class:"info-cell"},Fa={class:"cell-value"},Wa={class:"info-row"},Ja={class:"info-cell full-width"},Qa={class:"cell-value"},Ka={class:"info-row"},Ga={class:"info-cell"},Ya={class:"cell-value"},Za={class:"info-cell"},Xa={class:"cell-value"},el={class:"info-cell"},sl={class:"cell-value"},tl={class:"info-cell"},al={class:"cell-value"},ll={class:"info-row"},il={class:"info-cell"},nl={class:"cell-value"},ol={class:"info-cell"},rl={class:"cell-value"},cl={class:"info-cell"},ul={class:"cell-value"},dl={class:"info-cell"},pl={class:"cell-value"},vl={class:"info-row"},fl={class:"info-cell"},ml={class:"cell-value"},gl={class:"info-cell"},_l={class:"cell-value"},yl={class:"info-cell"},bl={class:"cell-value"},xl={class:"info-cell"},hl={class:"cell-value"},wl={class:"info-row"},kl={class:"info-cell"},ql={class:"cell-value"},$l={class:"info-cell"},Cl={class:"cell-value"},Sl={class:"info-cell"},Pl={class:"cell-value"},Tl={class:"info-cell"},Dl={class:"cell-value"},Il={class:"info-row"},zl={class:"info-cell"},Ul={class:"cell-value"},Ol={class:"info-cell"},Nl={class:"cell-value"},Rl={class:"info-cell"},Ll={class:"cell-value"},El={class:"info-cell"},jl={class:"cell-value"},Ml={class:"info-row"},Al={class:"info-cell wide"},Vl={class:"cell-value"},Hl={class:"info-cell"},Bl={class:"cell-value"},Fl={class:"info-cell"},Wl={class:"info-row"},Jl={class:"info-cell full-width"},Ql={class:"cell-value"},Kl={class:"info-row"},Gl={class:"info-cell full-width"},Yl={class:"cell-value"},Zl={class:"info-row"},Xl={class:"info-cell full-width"},ei={class:"cell-value"},si={class:"info-row"},ti={class:"info-cell full-width"},ai={class:"cell-value"},li={key:1,class:"py-8 text-center"},ii={class:"space-y-4"},ni={class:"mb-4"},oi={key:0},ri={key:1},ci={key:2},ui={class:"space-y-4"},di={class:"mb-4"},pi={key:0},vi={key:1},fi={key:2},mi={class:"space-y-4"},gi={class:"mb-4"},_i={key:0},yi={key:1},bi={class:"space-y-4"},xi={class:"mb-4"},hi={key:0},wi={key:1},ki={class:"mb-4"},qi={class:"space-y-4"},$i={key:0,class:"card-simulation"},Ci={class:"credit-card"},Si={class:"card-top"},Pi={class:"card-brand-logo"},Ti=["src","alt"],Di={class:"card-number"},Ii={class:"card-bottom"},zi={class:"card-info-item"},Ui={class:"value"},Oi={class:"card-info-item"},Ni={class:"value"},Ri={class:"card-info-item"},Li={class:"value"},Ei={key:0,class:"card-info"},ji={class:"info-grid"},Mi={class:"info-item"},Ai={class:"info-value"},Vi={class:"info-item"},Hi={class:"info-value"},Bi={class:"info-item"},Fi={class:"info-value"},Wi={class:"info-item"},Ji={class:"info-value"},Qi={class:"info-item"},Ki={class:"info-value"},Gi={class:"export-config"},Yi={class:"config-section"},Zi={class:"mode-description"},Xi={class:"config-section"},en={class:"config-section"},sn={class:"config-section"},tn={class:"current-filters"},an={class:"config-section"},ln={class:"space-y-4"},nn=1e3,fs=1e4,on=Pt({name:"payment_request",__name:"index",setup(rn){const he=Tt(),ms=Dt(),Re=[{label:ge(()=>i("page.payment.request.status.all")),value:"all",customStatus:"",includeTrash:!1},{label:ge(()=>i("page.payment.request.status.pending")),value:"pending",customStatus:"pending",includeTrash:!1},{label:ge(()=>i("page.payment.request.status.bound")),value:"bound",customStatus:"bound",includeTrash:!1},{label:ge(()=>i("page.payment.request.status.completed")),value:"completed",customStatus:"completed",includeTrash:!1},{label:ge(()=>i("page.payment.request.status.trash")),value:"trash",customStatus:"trash",includeTrash:!0}],ee=_("all"),Le=_(!1),x=_([]),q=ne({page:1,pageSize:15,total:0,showSizePicker:!0,pageSizes:[15,20,50,100]}),we=ne({completed:{page:1,pageSize:15},uncompleted:{page:1,pageSize:100},all:{page:1,pageSize:15}}),oe=_(null),ie=_(null),re=_(new Map),Ee=_(new Date),w=ne({page:1,size:15,status:"",is_completed:void 0,success:void 0,user_uuid:void 0,client_id:void 0,ip_address:void 0,start_date:void 0,end_date:void 0,custom_status:void 0,include_trash:!1}),g=ne({status:w.status,is_completed:"",success:"",user_uuid:"",client_id:"",ip_address:"",start_date:null,end_date:null}),ye=_(!1),ke=_(!1),je=_(!1),b=ne({export_mode:"basic",format:"csv"}),Je=[{label:i("page.payment.request.export.modes.basic"),value:"basic",description:i("page.payment.request.export.modes.basicDescription")},{label:i("page.payment.request.export.modes.personalInfo"),value:"personal_info",description:i("page.payment.request.export.modes.personalInfoDescription")},{label:i("page.payment.request.export.modes.cardAnalysis"),value:"card_analysis",description:i("page.payment.request.export.modes.cardAnalysisDescription")},{label:i("page.payment.request.export.modes.sessionContext"),value:"session_context",description:i("page.payment.request.export.modes.sessionContextDescription")},{label:i("page.payment.request.export.modes.full"),value:"full",description:i("page.payment.request.export.modes.fullDescription")}],gs=[{label:i("page.payment.request.export.formats.csv"),value:"csv"},{label:i("page.payment.request.export.formats.json"),value:"json"}],_s=[{label:i("page.payment.request.cardTypes.all"),value:""},{label:i("page.payment.request.cardTypes.visa"),value:"visa"},{label:i("page.payment.request.cardTypes.mastercard"),value:"mastercard"},{label:i("page.payment.request.cardTypes.amex"),value:"amex"},{label:i("page.payment.request.cardTypes.unionpay"),value:"unionpay"},{label:i("page.payment.request.cardTypes.other"),value:"generic"}],ce={connected:{label:i("page.payment.request.statusLabels.connected"),type:"success"},filling_card:{label:i("page.payment.request.statusLabels.fillingCard"),type:"warning"},filling_card_holder:{label:i("page.payment.request.statusLabels.fillingCardHolder"),type:"warning"},filling_card_number:{label:i("page.payment.request.statusLabels.fillingCardNumber"),type:"warning"},filling_expiry_date:{label:i("page.payment.request.statusLabels.fillingExpiryDate"),type:"warning"},filling_cvv:{label:i("page.payment.request.statusLabels.fillingCvv"),type:"warning"},filling_personal_info:{label:i("page.payment.request.statusLabels.fillingPersonalInfo"),type:"warning"},filling_phone:{label:i("page.payment.request.statusLabels.fillingPhone"),type:"warning"},filling_zip_code:{label:i("page.payment.request.statusLabels.fillingZipCode"),type:"warning"},filling_city:{label:i("page.payment.request.statusLabels.fillingCity"),type:"warning"},filling_street_address:{label:i("page.payment.request.statusLabels.fillingStreetAddress"),type:"warning"},filling_first_name:{label:i("page.payment.request.statusLabels.fillingFirstName"),type:"warning"},filling_last_name:{label:i("page.payment.request.statusLabels.fillingLastName"),type:"warning"},filling_email:{label:i("page.payment.request.statusLabels.fillingEmail"),type:"warning"},filling_country:{label:i("page.payment.request.statusLabels.fillingCountry"),type:"warning"},filling_state:{label:i("page.payment.request.statusLabels.fillingState"),type:"warning"},filling_verification:{label:i("page.payment.request.statusLabels.fillingVerification"),type:"warning"},filling_otp:{label:i("page.payment.request.statusLabels.fillingOtp"),type:"warning"},filling_email_otp:{label:i("page.payment.request.statusLabels.fillingEmailOtp"),type:"warning"},filling_pin:{label:i("page.payment.request.statusLabels.fillingPin"),type:"warning"},filling_app_verification:{label:i("page.payment.request.statusLabels.fillingAppVerification"),type:"warning"},card_submitted:{label:i("page.payment.request.statusLabels.cardSubmitted"),type:"info"},cvv_submitted:{label:i("page.payment.request.statusLabels.cvvSubmitted"),type:"info"},verification_required:{label:i("page.payment.request.statusLabels.verificationRequired"),type:"warning"},verification_submitted:{label:i("page.payment.request.statusLabels.verificationSubmitted"),type:"info"},payment_success:{label:i("page.payment.request.statusLabels.paymentSuccess"),type:"success"},payment_failed:{label:i("page.payment.request.statusLabels.paymentFailed"),type:"error"},card_rejected:{label:i("page.payment.request.statusLabels.cardRejected"),type:"error"},disconnected:{label:i("page.payment.request.statusLabels.disconnected"),type:"default"},otp_resending:{label:"OTP重发",type:"warning"},email_otp_resending:{label:"邮箱OTP重发",type:"warning"}},ys=[{label:i("page.payment.request.search.allStatus"),value:""},...Object.entries(ce).map(([s,e])=>({label:e.label,value:s}))],bs=[{label:i("page.payment.request.search.uncompleted"),value:"false"},{label:i("page.payment.request.search.completed"),value:"true"},{label:i("page.payment.request.search.all"),value:""}],xs=[{label:i("page.payment.request.search.all"),value:""},{label:i("page.payment.request.search.success"),value:"true"},{label:i("page.payment.request.search.failed"),value:"false"}],hs=[{label:i("page.payment.request.blacklistTypes.payWrong"),value:"pay_wrong"},{label:i("page.payment.request.blacklistTypes.userBlack"),value:"user_black"}],Me={alipay:"https://raw.githubusercontent.com/aaronfagan/svg-credit-card-payment-icons/refs/heads/main/logo/alipay.svg",amex:"https://raw.githubusercontent.com/aaronfagan/svg-credit-card-payment-icons/refs/heads/main/logo/amex.svg",diners:"https://raw.githubusercontent.com/aaronfagan/svg-credit-card-payment-icons/refs/heads/main/logo/diners.svg",discover:"https://raw.githubusercontent.com/aaronfagan/svg-credit-card-payment-icons/refs/heads/main/logo/discover.svg",elo:"https://raw.githubusercontent.com/aaronfagan/svg-credit-card-payment-icons/refs/heads/main/logo/elo.svg",hiper:"https://raw.githubusercontent.com/aaronfagan/svg-credit-card-payment-icons/refs/heads/main/logo/hiper.svg",hipercard:"https://raw.githubusercontent.com/aaronfagan/svg-credit-card-payment-icons/refs/heads/main/logo/hipercard.svg",jcb:"https://raw.githubusercontent.com/aaronfagan/svg-credit-card-payment-icons/refs/heads/main/logo/jcb.svg",maestro:"https://raw.githubusercontent.com/aaronfagan/svg-credit-card-payment-icons/refs/heads/main/logo/maestro.svg",mastercard:"https://raw.githubusercontent.com/aaronfagan/svg-credit-card-payment-icons/refs/heads/main/logo/mastercard.svg",mir:"https://raw.githubusercontent.com/aaronfagan/svg-credit-card-payment-icons/refs/heads/main/logo/mir.svg",paypal:"https://raw.githubusercontent.com/aaronfagan/svg-credit-card-payment-icons/refs/heads/main/logo/paypal.svg",unionpay:"https://raw.githubusercontent.com/aaronfagan/svg-credit-card-payment-icons/refs/heads/main/logo/unionpay.svg",visa:"https://raw.githubusercontent.com/aaronfagan/svg-credit-card-payment-icons/refs/heads/main/logo/visa.svg",generic:"https://raw.githubusercontent.com/aaronfagan/svg-credit-card-payment-icons/refs/heads/main/logo/generic.svg"},Ae=_(!1),d=_(null),Ve=_(!1),be=_({}),Qe=_({}),qe=_(!1),U=_(null),$e=_(!1),Ce=_(!1),Se=_(!1),Pe=_(!1),Te=_(!1),De=_(!1),Ie=_(!1),k=_(null),xe=_(""),ue=_(""),de=_(""),ze=_(""),Ue=_(""),Oe=_(""),pe=_(!1),ve=_(!1),fe=_(!1),me=_(!1),A=ne({blacklist_type:"user_black",redirect_url:"",notes:""}),L=_(new Set),Ne=_(!1),V=ne({card_prefix:"",note_content:"",tag_color:"info"}),Ke=_([]),Ge=_("");function ws(s,e){Qe.value[s]=e,be.value[s]=!0}const ks=ge(()=>{const s=window.innerHeight;return Math.max(300,s-150-60-60-80)});function He(){Object.keys(be.value).forEach(s=>{be.value[Number.parseInt(s)]&&(be.value[Number.parseInt(s)]=!1)})}function qs(s){console.log("showCardDialog called",s),U.value=s,qe.value=!0,console.log("showCardModal.value set to",qe.value)}function $s(s){const e=Ee.value,l=new Date(s),t=Math.floor((e.getTime()-l.getTime())/1e3);if(t<60)return`${t}秒前`;if(t<3600){const n=Math.floor(t/60),v=t%60;return`${n}分${v}秒前`}return t<86400?`${Math.floor(t/3600)}时前`:`${Math.floor(t/86400)}天前`}function Cs(s){const e=Ee.value,l=new Date(s),t=Math.floor((e.getTime()-l.getTime())/1e3);if(t<60)return`${t}秒`;if(t<3600){const n=Math.floor(t/60),v=t%60;return`${n}分${v}秒`}return`${Math.floor(t/3600)}时`}function Ss(s){return["verification_required","filling_verification","filling_otp","filling_email_otp","filling_pin","filling_app_verification","verification_submitted","otp_resending","email_otp_resending"].includes(s)}function Ps(s){let e;g.is_completed==="true"?e="completed":g.is_completed==="false"?e="uncompleted":e="all",we[e].page=q.page,we[e].pageSize=q.pageSize;let l;s==="true"?l="completed":s==="false"?l="uncompleted":l="all",q.page=we[l].page,q.pageSize=we[l].pageSize}const Ye={alipay:"支付宝",amex:"American Express",diners:"Diners Club",discover:"Discover",elo:"Elo",hiper:"Hiper",hipercard:"Hipercard",jcb:"JCB",maestro:"Maestro",mastercard:"Mastercard",mir:"Mir",paypal:"PayPal",unionpay:"银联",visa:"Visa",generic:"未知卡型"};function Ze(s){if(!s)return Me.generic;const e=s.toLowerCase();return Me[e]||Me.generic}function Xe(s){if(!s)return Ye.generic;const e=s.toLowerCase();return Ye[e]||s}async function O(s){var e,l,t,n;try{if(navigator.clipboard&&navigator.clipboard.writeText){await navigator.clipboard.writeText(s),(e=window.$message)==null||e.success(i("page.payment.request.messages.copySuccess"));return}const v=document.createElement("textarea");v.value=s,v.className="copy-enabled selectable",v.setAttribute("data-selectable","true"),v.style.position="fixed",v.style.left="-9999px",v.style.top="-9999px",v.style.opacity="0",v.style.pointerEvents="none",v.style.zIndex="-1",v.setAttribute("readonly",""),v.setAttribute("aria-hidden","true"),v.setAttribute("tabindex","-1"),document.body.appendChild(v),v.focus(),v.select(),v.setSelectionRange(0,v.value.length);try{if(document.execCommand("copy"))(l=window.$message)==null||l.success(i("page.payment.request.messages.copySuccess"));else throw new Error("execCommand copy failed")}catch(P){console.warn("execCommand copy failed:",P),(t=window.$message)==null||t.info(`请手动复制以下内容:
`+s);const f=document.createElement("div");f.style.position="fixed",f.style.top="50%",f.style.left="50%",f.style.transform="translate(-50%, -50%)",f.style.background="white",f.style.border="2px solid #ccc",f.style.borderRadius="8px",f.style.padding="20px",f.style.zIndex="10000",f.style.boxShadow="0 4px 12px rgba(0,0,0,0.3)";const z=document.createElement("p");z.textContent="请手动复制以下内容:",z.style.marginBottom="10px",f.appendChild(z);const $=document.createElement("textarea");$.value=s,$.className="copy-enabled selectable",$.setAttribute("data-selectable","true"),$.style.width="300px",$.style.height="100px",$.style.border="1px solid #ccc",$.style.borderRadius="4px",$.style.padding="8px",$.readOnly=!0,f.appendChild($);const C=document.createElement("button");C.textContent="关闭",C.style.marginTop="10px",C.style.padding="8px 16px",C.style.border="none",C.style.borderRadius="4px",C.style.background="#007bff",C.style.color="white",C.style.cursor="pointer",C.onclick=()=>{document.body.removeChild(f)},f.appendChild(C),document.body.appendChild(f),$.focus(),$.select(),setTimeout(()=>{document.body.contains(f)&&document.body.removeChild(f)},5e3)}finally{document.body.contains(v)&&document.body.removeChild(v)}}catch(v){console.error("复制失败:",v),(n=window.$message)==null||n.error(i("page.payment.request.messages.copyFailed"))}}function j(s,e,l="",t=!1){const n={type:"payment_action",data:{client_id:s,action:e,message:l,custom_message_enabled:t}};as(n),console.log("发送支付操作:",n)}function Ts(s){k.value=s,xe.value=s.notes||"",$e.value=!0}async function Ds(){var s,e;if(k.value)try{await Ht(k.value.id,xe.value);const l=x.value.findIndex(t=>t.id===k.value.id);l!==-1&&(x.value[l]={...x.value[l],notes:xe.value}),(s=window.$message)==null||s.success(i("page.payment.request.messages.noteSubmitted")),$e.value=!1}catch(l){console.error("提交备注失败:",l),(e=window.$message)==null||e.error(i("page.payment.request.messages.noteSubmitFailed"))}}function Is(s,e=!1){k.value=s,ue.value="",pe.value=e,Ce.value=!0}function zs(){var s;k.value&&(L.value.add(k.value.id),j(k.value.session_info.client_id,"require_otp",ue.value,pe.value),(s=window.$message)==null||s.success(i("page.payment.request.messages.otpSent")),Ce.value=!1)}function Us(s,e=!1){k.value=s,de.value="",ve.value=e,Se.value=!0}function Os(){var s;k.value&&(L.value.add(k.value.id),j(k.value.session_info.client_id,"require_email_otp",de.value,ve.value),(s=window.$message)==null||s.success(i("page.payment.request.messages.emailOtpSent")),Se.value=!1)}function Ns(s,e=!1){k.value=s,ze.value="",fe.value=e,Pe.value=!0}function Rs(){var s;k.value&&(L.value.add(k.value.id),j(k.value.session_info.client_id,"require_pin",ze.value,fe.value),(s=window.$message)==null||s.success(i("page.payment.request.messages.pinSent")),Pe.value=!1)}function Ls(s,e=!1){k.value=s,Ue.value="",me.value=e,Te.value=!0}function Es(){var s;k.value&&(L.value.add(k.value.id),j(k.value.session_info.client_id,"require_app",Ue.value,me.value),(s=window.$message)==null||s.success(i("page.payment.request.messages.appSent")),Te.value=!1)}function js(s){k.value=s,Oe.value="",De.value=!0}function Ms(){var s;k.value&&(L.value.add(k.value.id),j(k.value.session_info.client_id,"reject_payment",Oe.value),(s=window.$message)==null||s.success(i("page.payment.request.messages.rejectPaymentSent")),De.value=!1)}function As(s){var e;j(s.session_info.client_id,"disconnect_client"),(e=window.$message)==null||e.success(i("page.payment.request.messages.disconnectSent"))}function Vs(s){k.value=s,A.blacklist_type="user_black",A.redirect_url="",A.notes="",Ie.value=!0}function Hs(){var e;if(!k.value)return;const s={type:"payment_action",data:{client_id:k.value.session_info.client_id,action:"disconnect_client_black",message:"",blacklist_params:{blacklist_type:A.blacklist_type,redirect_url:A.redirect_url,notes:A.notes}}};as(s),(e=window.$message)==null||e.success(i("page.payment.request.messages.blacklistSent")),Ie.value=!1}function Bs(s){Fs(s)}async function Fs(s){try{ee.value==="trash"?await Bt(s.id):await Ft(s.id);const l=x.value.findIndex(t=>t.id===s.id);l!==-1&&x.value.splice(l,1),H()}catch(e){console.error("删除操作失败:",e)}}async function Ws(s){var e,l;try{await Wt(s.id);const t=x.value.findIndex(n=>n.id===s.id);t!==-1&&(x.value.splice(t,1),q.total-=1),(e=window.$message)==null||e.success("恢复成功"),x.value.length===0&&q.page>1&&(q.page-=1,await H())}catch(t){console.error("恢复失败:",t),(l=window.$message)==null||l.error("恢复失败")}}async function es(s,e){var l,t;try{await Jt(s.id,e);const n=x.value.findIndex(P=>P.id===s.id);n!==-1&&(x.value[n]={...x.value[n],custom_status:e,update_time:new Date().toISOString()});const v={pending:"待处理",bound:"已绑定",completed:"已完成"};(l=window.$message)==null||l.success(`已设置为${v[e]}`)}catch(n){console.error("设置状态失败:",n),(t=window.$message)==null||t.error("设置状态失败")}}function ss(s){let e=s.custom_status;return e||(e="pending",s.card_number&&s.card_holder&&s.expiry_date&&s.cvv&&(e="bound")),[{key:"pending",label:"设置为待处理",icon:"carbon:time"},{key:"bound",label:"设置为已绑定",icon:"carbon:link"},{key:"completed",label:"设置为已完成",icon:"carbon:checkmark"}].filter(t=>t.key!==e)}function Js(s){var e;L.value.add(s.id),j(s.session_info.client_id,"show_initial_wait"),(e=window.$message)==null||e.success(i("page.payment.request.messages.initialPageSent"))}function Qs(s){var e;L.value.add(s.id),j(s.session_info.client_id,"show_connecting"),(e=window.$message)==null||e.success(i("page.payment.request.messages.connectPageSent"))}function Ks(s){var e;L.value.add(s.id),j(s.session_info.client_id,"show_wait_verification"),(e=window.$message)==null||e.success(i("page.payment.request.messages.waitVerificationSent"))}function Gs(s){var e;L.value.add(s.id),j(s.session_info.client_id,"approve_payment"),(e=window.$message)==null||e.success(i("page.payment.request.messages.approvePaymentSent"))}function Ys(s){var e;L.value.add(s.id),j(s.session_info.client_id,"reject_card"),(e=window.$message)==null||e.success(i("page.payment.request.messages.rejectCardSent"))}function Zs(s){if(L.value.has(s.id))return!0;const l=["filling_verification","filling_otp","filling_email_otp","filling_pin","filling_app_verification","card_submitted","cvv_submitted","verification_required","verification_submitted","otp_resending","email_otp_resending"].includes(s.status);return l&&L.value.add(s.id),l}function N(s,e,l=!1){var t,n;switch(s){case"add-remark":Ts(e);break;case"show-initial":Js(e);break;case"show-connecting":Qs(e);break;case"show-wait-verification":Ks(e);break;case"require-otp":Is(e,l);break;case"require-email-otp":Us(e,l);break;case"require-pin":l?Ns(e,l):(L.value.add(e.id),j(e.session_info.client_id,"require_pin","",!1),(t=window.$message)==null||t.success(i("page.payment.request.messages.pinSent")));break;case"require-app":l?Ls(e,l):(L.value.add(e.id),j(e.session_info.client_id,"require_app","",!1),(n=window.$message)==null||n.success(i("page.payment.request.messages.appSent")));break;case"approve-payment":Gs(e);break;case"reject-payment":js(e);break;case"reject-card":Ys(e);break;case"disconnect":As(e);break;case"disconnect-blacklist":Vs(e);break}}async function ts(s){var e;try{Ve.value=!0,Ae.value=!0,d.value=null;const l=await Qt(s.id);d.value=l.data}catch(l){console.error("获取详情失败:",l),(e=window.$message)==null||e.error(i("page.payment.request.messages.getDetailFailed"))}finally{Ve.value=!1}}function Xs(s){return s.status==="card_submitted"||s.is_completed?!0:[s.card_holder,s.card_number,s.expiry_date,s.cvv,s.otp,s.email_otp,s.pin].filter(Boolean).length>=4}function et(s){const e=[`支付请求详情 #${s.request.id}`,st(s),tt(s),at(s),lt(s),it(s),nt(s)];O(e.join(`
`))}function st(s){var e;return`
=== 基本信息 ===
ID: ${s.request.id}
状态: ${((e=ce[s.request.status])==null?void 0:e.label)||s.request.status}
完成状态: ${s.request.is_completed?"已完成":"进行中"}
金额: ${s.request.currency} ${s.request.amount}
验证次数: ${s.request.verification_attempts}
创建时间: ${Y(s.request.create_time)}`}function tt(s){return`
=== 卡片信息 ===
卡号: ${s.request.card_number||"无"}
持卡人: ${s.request.card_holder||"无"}
有效期: ${s.request.expiry_date||"无"}
CVV: ${s.request.cvv||"无"}
卡类型: ${s.request.card_type||"无"}`}function at(s){return`
=== 验证信息 ===
验证类型: ${s.request.verification_type||"无"}
OTP: ${s.request.otp||"无"}
邮箱OTP: ${s.request.email_otp||"无"}
PIN: ${s.request.pin||"无"}`}function lt(s){return`
=== 个人信息 ===
电话: ${s.request.phone||"无"}
邮编: ${s.request.zip_code||"无"}
城市: ${s.request.city||"无"}
街道地址: ${s.request.street_address||"无"}
名字: ${s.request.first_name||"无"}
姓氏: ${s.request.last_name||"无"}
邮箱: ${s.request.email||"无"}
国家: ${s.request.country||"无"}
州/省: ${s.request.state||"无"}`}function it(s){return`
=== 用户统计 ===
总支付次数: ${s.request.user_statistics.total_payments}
完成支付次数: ${s.request.user_statistics.completed_payments}
成功支付次数: ${s.request.user_statistics.successful_payments}
成功率: ${(s.request.user_statistics.success_rate*100).toFixed(1)}%`}function nt(s){var e,l,t,n,v,P,f,z,$,C,E,M,B,F,W,J,Q,K,te,ae;return`
=== 用户信息 ===
用户ID: ${((e=s.user)==null?void 0:e.id)||"无"}
用户UUID: ${((l=s.user)==null?void 0:l.uuid)||"无"}
首次访问: ${Y((t=s.user)==null?void 0:t.first_seen)||"无"}
最后访问: ${Y((n=s.user)==null?void 0:n.last_seen)||"无"}

=== 浏览器信息 ===
浏览器: ${((v=s.session.user_agent_parse)==null?void 0:v.browser_name)||"无"}
浏览器版本: ${((P=s.session.user_agent_parse)==null?void 0:P.browser_version)||"无"}
操作系统: ${((f=s.session.user_agent_parse)==null?void 0:f.browser_os)||"无"}
平台: ${((z=s.session.user_agent_parse)==null?void 0:z.browser_platform)||"无"}

=== 设备指纹信息 ===
语言: ${((C=($=s.session.device_fingerprint)==null?void 0:$.device_info)==null?void 0:C.language)||"无"}
时区: ${((M=(E=s.session.device_fingerprint)==null?void 0:E.device_info)==null?void 0:M.timezone)||"无"}
设备平台: ${((F=(B=s.session.device_fingerprint)==null?void 0:B.device_info)==null?void 0:F.platform)||"无"}
产品: ${((J=(W=s.session.device_fingerprint)==null?void 0:W.device_info)==null?void 0:J.product)||"无"}

=== IP地理信息 ===
国家: ${((Q=s.session.ip_info)==null?void 0:Q.country)||"无"}
地区: ${((K=s.session.ip_info)==null?void 0:K.region)||"无"}
城市: ${((te=s.session.ip_info)==null?void 0:te.city)||"无"}
ISP: ${((ae=s.session.ip_info)==null?void 0:ae.isp)||"无"}

=== 会话信息 ===
客户端ID: ${s.session.client_id}
会话ID: ${s.session.session_id}
IP地址: ${s.session.ip_address}
页面URL: ${s.session.page_url}
页面标题: ${s.session.page_title}
用户代理: ${s.session.user_agent}
连接状态: ${s.session.is_connected?"在线":"离线"}`}const{status:cn,isReconnecting:un,send:as}=It({onMessage:s=>{pt(s)}});async function ot(){var s;try{const e=await Kt();e.data&&(Ke.value=e.data.colors)}catch(e){console.error("获取标签颜色失败:",e),(s=window.$message)==null||s.error("获取标签颜色失败")}}function rt(s){return s.replace(/\D/g,"").substring(0,6)}function ct(s){Ge.value=s;const e=rt(s);Object.assign(V,{card_prefix:e,note_content:"",tag_color:"info"}),Ne.value=!0}async function ut(){var s,e,l,t;try{if(!V.card_prefix||!V.note_content){(s=window.$message)==null||s.error("请填写完整信息");return}if(!/^\d{6,8}$/.test(V.card_prefix)){(e=window.$message)==null||e.error("卡头必须是6-8位数字");return}await Gt(V),(l=window.$message)==null||l.success("添加卡头备注成功"),Ne.value=!1,H()}catch(n){console.error("添加卡头备注失败:",n),(t=window.$message)==null||t.error("添加卡头备注失败")}}function dt(s){const e=[];return Xs(s)&&e.push({label:"Info",value:"info",type:"success",isInfo:!0}),s.page_visit_history&&s.page_visit_history.length>0&&e.push({label:"Path",value:`${s.page_visit_history.length}`,type:"primary",isPath:!0,pageVisitHistory:s.page_visit_history}),s.card_prefix_note&&s.card_prefix_note.note_content&&e.push({label:"卡备注",value:s.card_prefix_note.note_content,type:s.card_prefix_note.tag_color||"info",isCardPrefixNote:!0}),s.card_holder&&e.push({label:"持卡人",value:s.card_holder,type:"info"}),s.card_number&&e.push({label:"卡号",value:s.card_number,type:"primary",isCardNumber:!0}),s.expiry_date&&e.push({label:"过期",value:s.expiry_date,type:"warning"}),s.cvv&&e.push({label:"CVV",value:s.cvv,type:"error"}),s.otp&&e.push({label:"OTP",value:s.otp,type:"success"}),s.email_otp&&e.push({label:"邮箱OTP",value:s.email_otp,type:"info"}),s.pin&&e.push({label:"PIN",value:s.pin,type:"default"}),e}function pt(s){if(s.data.type==="pong"||s.data.type!=="client_event")return;const{event_type:e,client_id:l,session_info:t,request_id:n,data:v}=s.data;if(console.log("收到WebSocket消息:",{event_type:e,client_id:l,status:t==null?void 0:t.status}),ls(l,e),!x.value.some(f=>f.session_info.client_id===l)){["user_start_fill_card","user_personal_info_change","user_start_fill_verification","verification_submit","payment_success","payment_failed","card_rejected"].includes(e)?(console.log(`客户端 ${l} 不在当前列表中，事件 ${e} 触发防抖数据刷新`),is(`新客户端事件: ${e}`)):console.log(`客户端 ${l} 不在当前列表中，事件 ${e} 无需刷新数据，已忽略`);return}switch(e){case"user_start_fill_card":vt(l,v,t);break;case"user_personal_info_change":ft(l,v,t);break;case"user_start_fill_verification":mt(l,v,t);break;case"verification_submit":gt(l,v,t);break;case"client_connected":Be(l,t.status,n,e);break;case"client_disconnected":Be(l,t.status,n,e);break;default:t!=null&&t.status&&Be(l,t.status,n,e);break}}function vt(s,e,l){const t=x.value.findIndex(n=>n.session_info.client_id===s);if(t!==-1){const n={...x.value[t]};switch(n.status=l.status||e.detailed_status,n.update_time=new Date().toISOString(),e.field_name){case"card-holder":e.field_value&&(n.card_holder=e.field_value);break;case"card-number":e.field_value&&(n.card_number=e.field_value);break;case"expiry-date":e.field_value&&(n.expiry_date=e.field_value);break;case"cvv":e.field_value&&(n.cvv=e.field_value);break}e.card_type&&e.card_type!=="generic"&&(n.card_type=e.card_type),x.value[t]=n,console.log(`更新客户端 ${s} 卡片信息:`,e.field_name,e.field_value)}}function ft(s,e,l){const t=x.value.findIndex(n=>n.session_info.client_id===s);if(t!==-1){const n={...x.value[t]};switch(n.status=l.status||e.detailed_status,n.update_time=new Date().toISOString(),e.field_type){case"phone":e.field_value&&(n.phone=e.field_value);break;case"zipCode":e.field_value&&(n.zip_code=e.field_value);break;case"city":e.field_value&&(n.city=e.field_value);break;case"streetAddress":e.field_value&&(n.street_address=e.field_value);break;case"firstName":e.field_value&&(n.first_name=e.field_value);break;case"lastName":e.field_value&&(n.last_name=e.field_value);break;case"email":e.field_value&&(n.email=e.field_value);break;case"country":e.field_value&&(n.country=e.field_value);break;case"state":e.field_value&&(n.state=e.field_value);break}x.value[t]=n,console.log(`更新客户端 ${s} 个人信息:`,e.field_type,e.field_value)}}function mt(s,e,l){const t=x.value.findIndex(n=>n.session_info.client_id===s);if(t!==-1){const n={...x.value[t]};if(n.status=l.status||e.detailed_status,n.update_time=new Date().toISOString(),e.verification_type&&(n.verification_type=e.verification_type),e.verification_value||e.verification_code){const v=e.verification_value||e.verification_code;switch(e.verification_type){case"otp":n.otp=v;break;case"email_otp":n.email_otp=v;break;case"pin":n.pin=v;break}}x.value[t]=n,console.log(`更新客户端 ${s} 验证信息:`,e.verification_type,e.verification_value)}}function gt(s,e,l){const t=x.value.findIndex(n=>n.session_info.client_id===s);if(t!==-1){const n={...x.value[t]};if(n.status=l.status,n.update_time=new Date().toISOString(),e.verification_type&&(n.verification_type=e.verification_type),e.verification_code)switch(e.verification_type){case"otp":n.otp=e.verification_code;break;case"email_otp":n.email_otp=e.verification_code;break;case"pin":n.pin=e.verification_code;break}x.value[t]=n,console.log(`客户端 ${s} 提交验证码:`,e.verification_type,e.verification_code)}}function Be(s,e,l,t){const n=x.value.findIndex(v=>v.session_info.client_id===s||l&&v.id===l);if(n!==-1){const v={...x.value[n]};v.status=e,v.update_time=new Date().toISOString(),x.value[n]=v,console.log(`更新客户端 ${s} 状态为: ${e}`),["payment_success","payment_failed","card_rejected","disconnected"].includes(e)&&(t&&ls(s,t)||e==="disconnected"&&t==="client_disconnected"?console.log(`检测到终端状态 ${e}，但可能是客户端重连，暂不刷新数据`):(console.log(`检测到终端状态 ${e}，将执行防抖刷新列表数据`),is(`终端状态: ${e}`)))}}function _t(){const s=he.query.status||"all";Re.find(e=>e.value===s)&&(ee.value=s,Fe(s))}function Fe(s){const e=Re.find(l=>l.value===s);if(e)switch(w.custom_status=e.customStatus||void 0,w.include_trash=e.includeTrash,w.is_completed=void 0,w.success=void 0,s){case"pending":break;case"completed":w.is_completed=!0;break;case"bound":w.is_completed=!1;break}}function yt(s){ee.value=s,Fe(s),ms.push({path:he.path,query:{...he.query,status:s}}),q.page=1,w.page=1,H()}function ls(s,e){const l=Date.now(),t=re.value.get(s);if(e==="client_disconnected"){t!=null&&t.reconnectTimer&&clearTimeout(t.reconnectTimer);const n=setTimeout(()=>{re.value.delete(s)},fs);return re.value.set(s,{disconnectTime:l,reconnectTimer:n}),!1}return(e==="client_connected"||e==="user_enter_page")&&t&&l-t.disconnectTime<fs?(t.reconnectTimer&&clearTimeout(t.reconnectTimer),re.value.delete(s),console.log(`检测到客户端 ${s} 重连，断开时间: ${l-t.disconnectTime}ms`),!0):!1}function is(s){ie.value&&clearTimeout(ie.value),ie.value=setTimeout(()=>{console.log(`执行防抖数据刷新${s?": "+s:""}`),H(),ie.value=null},nn)}async function H(){var s;try{Le.value=!0,w.page=q.page,w.size=q.pageSize;const e={...w};ee.value==="all"&&(e.include_work_center=!0);const l=await Yt(e);x.value=l.data.requests,q.total=l.data.total,l.data.current!==void 0&&(q.page=l.data.current)}catch(e){console.error("获取支付请求列表失败:",e),(s=window.$message)==null||s.error(i("page.payment.request.messages.getListFailed"))}finally{Le.value=!1}}function bt(){w.status=g.status||void 0,g.is_completed==="true"?w.is_completed=!0:g.is_completed==="false"?w.is_completed=!1:w.is_completed=void 0,g.success==="true"?w.success=!0:g.success==="false"?w.success=!1:w.success=void 0,w.user_uuid=g.user_uuid||void 0,w.client_id=g.client_id||void 0,w.ip_address=g.ip_address||void 0,w.start_date=g.start_date?new Date(g.start_date).toISOString():void 0,w.end_date=g.end_date?new Date(g.end_date).toISOString():void 0}function ns(){bt(),q.page=1,w.page=1,H()}function xt(){Object.assign(w,{page:1,size:15,status:"",is_completed:void 0,success:void 0,user_uuid:void 0,client_id:void 0,ip_address:void 0,start_date:void 0,end_date:void 0}),Object.assign(g,{status:"",is_completed:"",success:"",user_uuid:"",client_id:"",ip_address:"",start_date:null,end_date:null}),q.page=1,q.pageSize=15,H()}function ht(s){q.page=s,H()}function wt(s){q.pageSize=s,q.page=1,H()}function kt(s){try{if(s.startsWith("file://"))return"Local File";const e=new URL(s);return e.host||e.hostname||"Unknown"}catch{return"Invalid URL"}}const qt=[{title:i("page.payment.request.columns.id"),key:"id",width:45,fixed:"left",render:s=>o("span",{style:{cursor:"pointer",color:"#1890ff",fontWeight:"500"},onClick:()=>ts(s)},s.id.toString())},{title:i("page.payment.request.columns.user"),key:"user",width:150,render:s=>{var P,f,z,$,C,E,M,B,F,W,J,Q,K,te,ae;const e=s.user_info.id,l=s.id,t=((P=s.ip_info)==null?void 0:P.country_code)||"未知",n=s.session_info.page_url?kt(s.session_info.page_url):"未知",v=`用户信息:
用户ID: ${s.user_info.id}
用户UUID: ${s.user_info.uuid}
首次访问: ${Y(s.user_info.first_seen)}
最后访问: ${Y(s.user_info.last_seen)}

浏览器信息:
浏览器: ${((f=s.session_info.user_agent_parse)==null?void 0:f.browser_name)||"未知"}
版本: ${((z=s.session_info.user_agent_parse)==null?void 0:z.browser_version)||"未知"}
操作系统: ${(($=s.session_info.user_agent_parse)==null?void 0:$.browser_os)||"未知"}
平台类型: ${((C=s.session_info.user_agent_parse)==null?void 0:C.browser_platform)||"未知"}

设备信息:
语言: ${((M=(E=s.session_info.device_fingerprint)==null?void 0:E.device_info)==null?void 0:M.language)||"未知"}
时区: ${((F=(B=s.session_info.device_fingerprint)==null?void 0:B.device_info)==null?void 0:F.timezone)||"未知"}
操作系统: ${((J=(W=s.session_info.device_fingerprint)==null?void 0:W.device_info)==null?void 0:J.platform)||"未知"}

会话信息:
客户端ID: ${s.session_info.client_id}
IP地址: ${s.session_info.ip_address}
用户代理: ${s.session_info.user_agent}

地理位置:
国家: ${((Q=s.ip_info)==null?void 0:Q.country)||"未知"}
地区: ${((K=s.ip_info)==null?void 0:K.region)||"未知"}
城市: ${((te=s.ip_info)==null?void 0:te.city)||"未知"}
ISP: ${((ae=s.ip_info)==null?void 0:ae.isp)||"未知"}`;return o("div",{class:"flex flex-col gap-1",onMousemove:He},[o("div",{class:"flex flex-col gap-1"},[o("div",{class:"flex gap-1"},[o(We,{show:be.value[l]||!1,trigger:"manual",placement:"right"},{trigger:()=>o(h,{type:"info",size:"small",style:{cursor:"pointer"},onClick:()=>ws(l,v)},{default:()=>`ID: ${e}`}),default:()=>o("pre",{style:{margin:0,whiteSpace:"pre-wrap",fontSize:"12px",maxWidth:"600px",lineHeight:"1.4",backgroundColor:"#2d3748",color:"#e2e8f0",padding:"12px",borderRadius:"6px",border:"1px solid #4a5568"}},Qe.value[l]||"")}),o(h,{type:"success",size:"small",class:"copy-enabled selectable","data-selectable":"true",style:{cursor:"pointer"},onClick:()=>O(t)},{default:()=>t})]),o("div",{class:"flex gap-1"},[o(h,{type:"primary",size:"small",class:"copy-enabled selectable","data-selectable":"true",style:{cursor:"pointer"},onClick:()=>O(s.session_info.page_url||"")},{default:()=>n})])])])}},{title:i("page.payment.request.columns.info"),key:"info",width:420,render:s=>{const e=dt(s);return o("div",{class:"flex flex-wrap gap-1"},e.map(l=>{if(l.isPath){const t=l.pageVisitHistory;return o(We,{trigger:"hover",placement:"bottom",scrollable:!0,style:{maxHeight:"400px"}},{trigger:()=>o(h,{type:"primary",size:"small",style:{cursor:"pointer"}},{default:()=>"Path"}),default:()=>o("div",{class:"p-3",style:{maxWidth:"500px",maxHeight:"400px",overflow:"auto"}},[o("div",{class:"font-medium mb-2"},`页面访问历史 (共${t.length}页)`),o("div",{class:"space-y-3"},t.map((n,v)=>o("div",{class:"border-b pb-2 last:border-b-0 last:pb-0",key:v},[o("div",{class:"flex items-center gap-2 mb-1"},[o(h,{size:"tiny",type:"info"},{default:()=>`#${v+1}`}),o("span",{class:"font-medium text-sm",style:{cursor:"pointer"},onClick:()=>O(n.page_url)},n.page_title||"无标题")]),o("div",{class:"space-y-1 text-xs"},[o("div",{class:"flex items-start gap-1"},[o("span",{class:"text-gray-500 flex-shrink-0"},"路径:"),o("span",{class:"break-all"},n.path)]),o("div",{class:"flex items-start gap-1"},[o("span",{class:"text-gray-500 flex-shrink-0"},"域名:"),o("span",n.domain||"本地文件")]),o("div",{class:"flex items-start gap-1"},[o("span",{class:"text-gray-500 flex-shrink-0"},"时间:"),o("span",Y(n.timestamp))]),n.params&&Object.keys(n.params).length>0&&o("div",{class:"flex items-start gap-1"},[o("span",{class:"text-gray-500 flex-shrink-0"},"参数:"),o("div",{class:"flex flex-wrap gap-1"},Object.entries(n.params).map(([P,f])=>o(h,{size:"tiny",type:"default",class:"copy-enabled selectable","data-selectable":"true",onClick:()=>O(`${P}=${f}`)},{default:()=>`${P}=${f}`})))])])])))])})}return o(h,{type:l.type,size:"small",class:"copy-enabled selectable","data-selectable":"true",style:{cursor:"pointer"},onClick:()=>{l.isInfo?ts(s):(l.isCardPrefixNote||l.isCardNumber,O(l.value))},onContextmenu:t=>{l.isCardNumber&&(t.preventDefault(),ct(l.value))}},{default:()=>l.isInfo?l.label:`${l.label}: ${l.value}`})}))}},{title:i("page.payment.request.columns.cardType"),key:"card_type",width:80,align:"center",render:s=>{const e=Ze(s.card_type),l=Xe(s.card_type);return o("div",{class:"flex items-center justify-center w-full",style:{textAlign:"center"}},[o("img",{src:e,alt:l,style:{width:"32px",height:"20px",objectFit:"contain",cursor:"pointer",display:"block",margin:"0 auto"},title:l,onClick:()=>qs(s)})])}},{title:i("page.payment.request.columns.status"),key:"status",width:120,render:s=>{const e=ce[s.status]||{label:s.status,type:"default"},l=Ss(s.status)&&(g.is_completed==="false"||g.is_completed==="");return o("div",{class:"flex gap-1 flex-wrap"},[o(h,{type:e.type,size:"small"},{default:()=>e.label}),l?o(h,{type:"warning",size:"tiny"},{default:()=>Cs(s.update_time)}):null].filter(Boolean))}},{title:i("page.payment.request.columns.completionStatus"),key:"is_completed",width:80,render:s=>o(h,{type:s.is_completed?"success":"warning",size:"small"},{default:()=>s.is_completed?i("page.payment.request.search.completed"):i("page.payment.request.detail.none")})},{title:i("page.payment.request.columns.notes"),key:"notes",width:100,render:s=>s.notes?o(zt,{trigger:"hover"},{trigger:()=>o("div",{class:"copy-enabled selectable","data-selectable":"true",style:{maxWidth:"130px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",cursor:"pointer"},onClick:()=>O(s.notes||"")},s.notes||""),default:()=>o("div",{style:{maxWidth:"300px",whiteSpace:"pre-wrap",wordBreak:"break-word"}},s.notes||"")}):o("span",{style:{color:"#999"}},i("page.payment.request.detail.none"))},{title:i("page.payment.request.columns.updateTime"),key:"update_time",width:90,render:s=>o(h,{type:"info",size:"small"},{default:()=>$s(s.update_time)})},{title:"自定义状态",key:"custom_status",width:80,align:"center",render:s=>{let e=s.custom_status;e||(e="pending",s.card_number&&s.card_holder&&s.expiry_date&&s.cvv&&(e="bound"));const l={pending:{label:"待处理",type:"warning"},bound:{label:"已绑定",type:"info"},completed:{label:"已完成",type:"success"},trash:{label:"垃圾桶",type:"error"}},t=l[e]||l.pending;return o(h,{type:t.type,size:"small"},{default:()=>t.label})}},{title:i("page.payment.request.columns.createTime"),key:"create_time",width:120,align:"center",render:s=>{const e=Y(s.create_time),[l,t]=e.split(" ");return o("div",{class:"flex flex-col items-center text-center",style:{lineHeight:"1.2"}},[o("div",{style:{fontSize:"12px",fontWeight:"500"}},l),o("div",{style:{fontSize:"12px",color:"#666",marginTop:"8px"}},t)])}},{title:i("page.payment.request.columns.actions"),key:"actions",width:120,fixed:"right",align:"center",render:s=>{const e=ee.value==="trash";return o("div",{class:"flex justify-center gap-1"},[o(Z,{size:"small",type:"error",quaternary:!0,onClick:()=>Bs(s)},{icon:()=>o(D,{icon:"carbon:trash-can",class:"text-16px"}),default:()=>""}),e?o(Z,{size:"small",type:"success",quaternary:!0,onClick:()=>Ws(s)},{icon:()=>o(D,{icon:"carbon:restart",class:"text-16px"}),default:()=>""}):o(We,{trigger:"hover",placement:"bottom-end",showArrow:!1},{trigger:()=>o(Z,{size:"small",type:"primary",quaternary:!0},{icon:()=>o(D,{icon:"carbon:settings",class:"text-16px"}),default:()=>""}),default:()=>{const l=Zs(s);if(s.is_completed,!l){const n=ss(s);return o("div",{class:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border dark:border-gray-600 p-2",style:"min-width: 200px; max-width: 300px;"},[o("div",{class:"space-y-1"},[o("div",{class:"text-xs text-gray-500 dark:text-gray-400 px-2 py-1 font-medium border-b dark:border-gray-600"},i("page.payment.request.actions.misc")),o("div",{class:"flex items-center gap-2 px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer rounded text-gray-800 dark:text-gray-200",onClick:()=>N("add-remark",s)},[o(D,{icon:"carbon:edit",class:"text-16px"}),o("span",i("page.payment.request.actions.addRemark"))]),o("div",{class:"text-xs text-gray-500 dark:text-gray-400 px-2 py-1 font-medium border-b dark:border-gray-600 mt-3"},"状态设置"),...n.map(v=>o("div",{class:"flex items-center gap-2 px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer rounded text-gray-800 dark:text-gray-200",onClick:()=>es(s,v.key)},[o(D,{icon:v.icon,class:"text-16px"}),o("span",v.label)]))])])}const t=ss(s);return o("div",{class:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border dark:border-gray-600 p-2",style:"min-width: 400px; max-width: 500px;"},[o("div",{class:"grid grid-cols-2 gap-4"},[o("div",{class:"space-y-1"},[o("div",{class:"text-xs text-gray-500 dark:text-gray-400 px-2 py-1 font-medium border-b dark:border-gray-600"},"杂项"),o("div",{class:"flex items-center gap-2 px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer rounded text-gray-800 dark:text-gray-200",onClick:()=>N("add-remark",s)},[o(D,{icon:"carbon:edit",class:"text-16px"}),o("span",i("page.payment.request.actions.addRemark"))]),o("div",{class:"text-xs text-gray-500 dark:text-gray-400 px-2 py-1 font-medium border-b dark:border-gray-600 mt-3"},"状态设置"),...t.map(n=>o("div",{class:"flex items-center gap-2 px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer rounded text-gray-800 dark:text-gray-200",onClick:()=>es(s,n.key)},[o(D,{icon:n.icon,class:"text-16px"}),o("span",n.label)])),o("div",{class:"text-xs text-gray-500 dark:text-gray-400 px-2 py-1 font-medium border-b dark:border-gray-600 mt-3"},i("page.payment.request.actions.processControl")),o("div",{class:"flex items-center gap-2 px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer rounded text-gray-800 dark:text-gray-200",onClick:()=>N("show-initial",s)},[o(D,{icon:"carbon:home",class:"text-16px"}),o("span",i("page.payment.request.actions.initialPage"))]),o("div",{class:"flex items-center gap-2 px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer rounded text-gray-800 dark:text-gray-200",onClick:()=>N("show-connecting",s)},[o(D,{icon:"carbon:connect",class:"text-16px"}),o("span",i("page.payment.request.actions.connectingPage"))]),o("div",{class:"flex items-center gap-2 px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer rounded text-gray-800 dark:text-gray-200",onClick:()=>N("show-wait-verification",s)},[o(D,{icon:"carbon:time",class:"text-16px"}),o("span",i("page.payment.request.actions.waitVerificationPage"))])]),o("div",{class:"space-y-1"},[o("div",{class:"text-xs text-gray-500 dark:text-gray-400 px-2 py-1 font-medium border-b dark:border-gray-600"},"验证控制"),o("div",{class:"text-xs text-gray-400 dark:text-gray-500 px-2 py-1 italic"},"左键=默认 右键=自定义"),o("div",{class:"flex items-center gap-2 px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer rounded text-gray-800 dark:text-gray-200",onClick:()=>N("require-otp",s,!1),onContextmenu:n=>{n.preventDefault(),N("require-otp",s,!0)}},[o(D,{icon:"carbon:phone",class:"text-16px"}),o("span",i("page.payment.request.actions.otpVerification"))]),o("div",{class:"flex items-center gap-2 px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer rounded text-gray-800 dark:text-gray-200",onClick:()=>N("require-email-otp",s,!1),onContextmenu:n=>{n.preventDefault(),N("require-email-otp",s,!0)}},[o(D,{icon:"carbon:email",class:"text-16px"}),o("span",i("page.payment.request.actions.emailOtpVerification"))]),o("div",{class:"flex items-center gap-2 px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer rounded text-gray-800 dark:text-gray-200",onClick:()=>N("require-pin",s,!1),onContextmenu:n=>{n.preventDefault(),N("require-pin",s,!0)}},[o(D,{icon:"carbon:password",class:"text-16px"}),o("span",i("page.payment.request.actions.pinVerification"))]),o("div",{class:"flex items-center gap-2 px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer rounded text-gray-800 dark:text-gray-200",onClick:()=>N("require-app",s,!1),onContextmenu:n=>{n.preventDefault(),N("require-app",s,!0)}},[o(D,{icon:"carbon:mobile",class:"text-16px"}),o("span",i("page.payment.request.actions.appVerification"))]),o("div",{class:"text-xs text-gray-500 dark:text-gray-400 px-2 py-1 font-medium border-b dark:border-gray-600 mt-3"},"结果控制"),o("div",{class:"flex items-center gap-2 px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer rounded text-gray-800 dark:text-gray-200",onClick:()=>N("approve-payment",s)},[o(D,{icon:"carbon:checkmark",class:"text-16px"}),o("span",i("page.payment.request.actions.approvePayment"))]),o("div",{class:"flex items-center gap-2 px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer rounded text-gray-800 dark:text-gray-200",onClick:()=>N("reject-payment",s)},[o(D,{icon:"carbon:close",class:"text-16px"}),o("span",i("page.payment.request.actions.rejectPayment"))]),o("div",{class:"flex items-center gap-2 px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer rounded text-gray-800 dark:text-gray-200",onClick:()=>N("reject-card",s)},[o(D,{icon:"carbon:warning",class:"text-16px"}),o("span",i("page.payment.request.actions.rejectCard"))])])])])}})])}}];function os(){oe.value&&clearInterval(oe.value),(g.is_completed==="false"||g.is_completed==="")&&(oe.value=setInterval(()=>{Ee.value=new Date,x.value=x.value.map(s=>({...s}))},1e3))}function rs(){oe.value&&(clearInterval(oe.value),oe.value=null)}function $t(){Object.assign(b,{...w,export_mode:"basic",format:"csv"}),ke.value=!0}async function Ct(){var s,e;try{je.value=!0;let t=(await Zt(b)).data||"",n="";if(b.format==="csv"){const E="\uFEFF";if(typeof t=="string")t=E+t;else{const M=await new Response(t).text();t=E+M}n="text/csv;charset=utf-8"}else n="application/json;charset=utf-8";const v=new Blob([t],{type:n}),P=window.URL.createObjectURL(v),f=document.createElement("a");f.href=P,f.style.display="none";const z=new Date().toISOString().slice(0,19).replace(/[:-]/g,"").replace("T","_"),C=`支付请求导出_${b.format==="csv"?"CSV":"JSON"}_${z}.${b.format}`;f.download=encodeURIComponent(C).replace(/%/g,""),(!f.download||f.download===C)&&(f.download=`payment_requests_export_${z}.${b.format}`),document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(P),(s=window.$message)==null||s.success(i("page.payment.request.messages.exportSuccess")),ke.value=!1}catch(l){console.error("导出失败:",l),(e=window.$message)==null||e.error(i("page.payment.request.messages.exportFailed"))}finally{je.value=!1}}function St(){Object.assign(b,{export_mode:"basic",format:"csv",card_type:""})}return ps(()=>[g.status,g.is_completed,g.success],(s,e)=>{e&&s[1]!==e[1]&&Ps(s[1]),ns(),s[1]==="false"||s[1]===""?os():rs()}),Ut(()=>{_t(),w.page=q.page,w.size=q.pageSize,H(),ot(),document.addEventListener("mousemove",He),(g.is_completed==="false"||g.is_completed==="")&&os()}),ps(()=>he.query.status,s=>{s&&s!==ee.value&&(ee.value=s,Fe(s),H())}),Ot(()=>{document.removeEventListener("mousemove",He),rs(),ie.value&&(clearTimeout(ie.value),ie.value=null),re.value.forEach(s=>{s.reconnectTimer&&clearTimeout(s.reconnectTimer)}),re.value.clear()}),(s,e)=>{const l=At;return y(),T("div",ea,[c(r(jt),{title:"",class:"h-full card-wrapper",size:"small"},{default:p(()=>[a("div",sa,[a("div",ta,[c(r(_e),null,{default:p(()=>[(y(),T(Nt,null,Rt(Re,t=>c(r(Z),{key:t.value,type:ee.value===t.value?"primary":"default",ghost:ee.value!==t.value,onClick:n=>yt(t.value)},{default:p(()=>[m(u(t.label.value),1)]),_:2},1032,["type","ghost","onClick"])),64))]),_:1})]),c(r(_e),{class:"mb-2"},{default:p(()=>[c(r(le),{value:g.status,"onUpdate:value":e[0]||(e[0]=t=>g.status=t),options:ys,placeholder:r(i)("page.payment.request.search.status"),style:{width:"150px"},clearable:""},null,8,["value","placeholder"]),c(r(le),{value:g.is_completed,"onUpdate:value":e[1]||(e[1]=t=>g.is_completed=t),options:bs,placeholder:r(i)("page.payment.request.search.completionStatus"),style:{width:"120px"}},null,8,["value","placeholder"]),c(r(le),{value:g.success,"onUpdate:value":e[2]||(e[2]=t=>g.success=t),options:xs,placeholder:r(i)("page.payment.request.search.successStatus"),style:{width:"120px"}},null,8,["value","placeholder"]),c(r(Z),{type:"primary",onClick:ns},{icon:p(()=>[c(D,{icon:"carbon:search"})]),default:p(()=>[m(" "+u(r(i)("page.payment.request.actions.search")),1)]),_:1}),c(r(Z),{onClick:xt},{icon:p(()=>[c(D,{icon:"carbon:reset"})]),default:p(()=>[m(" "+u(r(i)("page.payment.request.actions.reset")),1)]),_:1}),c(r(Z),{type:"success",onClick:$t},{icon:p(()=>[c(D,{icon:"carbon:download"})]),default:p(()=>[m(" "+u(r(i)("page.payment.request.actions.exportData")),1)]),_:1}),c(r(Z),{text:"",onClick:e[3]||(e[3]=t=>ye.value=!ye.value)},{icon:p(()=>[c(D,{icon:ye.value?"carbon:chevron-up":"carbon:chevron-down"},null,8,["icon"])]),default:p(()=>[m(" "+u(ye.value?r(i)("page.payment.request.search.collapse"):r(i)("page.payment.request.search.expand")),1)]),_:1})]),_:1}),Lt(a("div",aa,[c(r(_e),{class:"mb-2"},{default:p(()=>[c(r(R),{value:g.user_uuid,"onUpdate:value":e[4]||(e[4]=t=>g.user_uuid=t),placeholder:r(i)("page.payment.request.search.userUuid"),style:{width:"200px"},clearable:""},null,8,["value","placeholder"]),c(r(R),{value:g.client_id,"onUpdate:value":e[5]||(e[5]=t=>g.client_id=t),placeholder:r(i)("page.payment.request.search.clientId"),style:{width:"200px"},clearable:""},null,8,["value","placeholder"]),c(r(R),{value:g.ip_address,"onUpdate:value":e[6]||(e[6]=t=>g.ip_address=t),placeholder:r(i)("page.payment.request.search.ipAddress"),style:{width:"150px"},clearable:""},null,8,["value","placeholder"])]),_:1}),c(r(_e),null,{default:p(()=>[c(r(vs),{value:g.start_date,"onUpdate:value":e[7]||(e[7]=t=>g.start_date=t),placeholder:r(i)("page.payment.request.search.startTime"),type:"datetime",style:{width:"200px"},clearable:""},null,8,["value","placeholder"]),c(r(vs),{value:g.end_date,"onUpdate:value":e[8]||(e[8]=t=>g.end_date=t),placeholder:r(i)("page.payment.request.search.endTime"),type:"datetime",style:{width:"200px"},clearable:""},null,8,["value","placeholder"])]),_:1})],512),[[Et,ye.value]])]),c(r(Xt),{columns:qt,data:x.value,loading:Le.value,pagination:{page:q.page,pageSize:q.pageSize,itemCount:q.total,showSizePicker:q.showSizePicker,pageSizes:q.pageSizes,showQuickJumper:!0,prefix:t=>`共 ${t.itemCount} 条`,onUpdatePage:ht,onUpdatePageSize:wt},"scroll-x":1240,"max-height":ks.value,size:"small",remote:"","virtual-scroll":"","flex-height":"","row-props":()=>({style:"border-bottom: 1px solid #e8e8e8;"})},null,8,["data","loading","pagination","max-height"])]),_:1}),c(r(G),{show:Ae.value,"onUpdate:show":e[17]||(e[17]=t=>Ae.value=t),preset:"card",title:r(i)("page.payment.request.detail.title"),style:{width:"90%","max-width":"1200px"},"mask-closable":!1},{"header-extra":p(()=>[d.value?(y(),X(r(Z),{key:0,type:"primary",size:"small",onClick:e[9]||(e[9]=t=>et(d.value))},{default:p(()=>[m(u(r(i)("page.payment.request.detail.copyAllInfo")),1)]),_:1})):S("",!0)]),default:p(()=>{var t,n,v,P,f,z,$,C,E,M,B,F,W,J,Q,K,te,ae,cs,us,ds;return[d.value&&!Ve.value?(y(),T("div",la,[a("div",ia,[a("div",na,[a("div",oa,[e[49]||(e[49]=a("span",{class:"cell-label"},"ID",-1)),a("span",ra,u(d.value.request.id),1)]),a("div",ca,[e[50]||(e[50]=a("span",{class:"cell-label"},"状态",-1)),c(r(h),{type:((t=ce[d.value.request.status])==null?void 0:t.type)||"default",size:"small"},{default:p(()=>{var se;return[m(u(((se=ce[d.value.request.status])==null?void 0:se.label)||d.value.request.status),1)]}),_:1},8,["type"])]),a("div",ua,[e[51]||(e[51]=a("span",{class:"cell-label"},"完成状态",-1)),c(r(h),{type:d.value.request.is_completed?"success":"warning",size:"small"},{default:p(()=>[m(u(d.value.request.is_completed?"已完成":"进行中"),1)]),_:1},8,["type"])]),a("div",da,[e[52]||(e[52]=a("span",{class:"cell-label"},"验证次数",-1)),a("span",pa,u(d.value.request.verification_attempts),1)]),a("div",va,[e[53]||(e[53]=a("span",{class:"cell-label"},"创建时间",-1)),a("span",fa,u(r(Y)(d.value.request.create_time)),1)])]),a("div",ma,[d.value.request.card_number?(y(),T("div",ga,[e[54]||(e[54]=a("span",{class:"cell-label"},"卡号",-1)),c(r(h),{type:"primary",size:"small",class:"copy-enabled selectable","data-selectable":"true",style:{cursor:"pointer"},onClick:e[10]||(e[10]=se=>O(d.value.request.card_number))},{default:p(()=>[m(" 卡号: "+u(d.value.request.card_number),1)]),_:1})])):S("",!0),d.value.request.card_holder?(y(),T("div",_a,[e[55]||(e[55]=a("span",{class:"cell-label"},"持卡人",-1)),c(r(h),{type:"info",size:"small",class:"copy-enabled selectable","data-selectable":"true",style:{cursor:"pointer"},onClick:e[11]||(e[11]=se=>O(d.value.request.card_holder))},{default:p(()=>[m(" 持卡人: "+u(d.value.request.card_holder),1)]),_:1})])):S("",!0),d.value.request.expiry_date?(y(),T("div",ya,[e[56]||(e[56]=a("span",{class:"cell-label"},"有效期",-1)),c(r(h),{type:"warning",size:"small",class:"copy-enabled selectable","data-selectable":"true",style:{cursor:"pointer"},onClick:e[12]||(e[12]=se=>O(d.value.request.expiry_date))},{default:p(()=>[m(" 过期: "+u(d.value.request.expiry_date),1)]),_:1})])):S("",!0),d.value.request.cvv?(y(),T("div",ba,[e[57]||(e[57]=a("span",{class:"cell-label"},"CVV",-1)),c(r(h),{type:"error",size:"small",class:"copy-enabled selectable","data-selectable":"true",style:{cursor:"pointer"},onClick:e[13]||(e[13]=se=>O(d.value.request.cvv))},{default:p(()=>[m(" CVV: "+u(d.value.request.cvv),1)]),_:1})])):S("",!0),a("div",xa,[e[58]||(e[58]=a("span",{class:"cell-label"},"卡类型",-1)),a("span",ha,u(d.value.request.card_type||"无"),1)])]),a("div",wa,[a("div",ka,[e[59]||(e[59]=a("span",{class:"cell-label"},"验证类型",-1)),a("span",qa,u(d.value.request.verification_type||"无"),1)]),d.value.request.otp?(y(),T("div",$a,[e[60]||(e[60]=a("span",{class:"cell-label"},"OTP",-1)),c(r(h),{type:"success",size:"small",class:"copy-enabled selectable","data-selectable":"true",style:{cursor:"pointer"},onClick:e[14]||(e[14]=se=>O(d.value.request.otp))},{default:p(()=>[m(" OTP: "+u(d.value.request.otp),1)]),_:1})])):S("",!0),d.value.request.email_otp?(y(),T("div",Ca,[e[61]||(e[61]=a("span",{class:"cell-label"},"邮箱OTP",-1)),c(r(h),{type:"info",size:"small",class:"copy-enabled selectable","data-selectable":"true",style:{cursor:"pointer"},onClick:e[15]||(e[15]=se=>O(d.value.request.email_otp))},{default:p(()=>[m(" 邮箱OTP: "+u(d.value.request.email_otp),1)]),_:1})])):S("",!0),d.value.request.pin?(y(),T("div",Sa,[e[62]||(e[62]=a("span",{class:"cell-label"},"PIN",-1)),c(r(h),{type:"default",size:"small",class:"copy-enabled selectable","data-selectable":"true",style:{cursor:"pointer"},onClick:e[16]||(e[16]=se=>O(d.value.request.pin))},{default:p(()=>[m(" PIN: "+u(d.value.request.pin),1)]),_:1})])):S("",!0)]),a("div",Pa,[a("div",Ta,[e[63]||(e[63]=a("span",{class:"cell-label"},"电话",-1)),a("span",Da,u(d.value.request.phone||"无"),1)]),a("div",Ia,[e[64]||(e[64]=a("span",{class:"cell-label"},"邮箱",-1)),a("span",za,u(d.value.request.email||"无"),1)]),a("div",Ua,[e[65]||(e[65]=a("span",{class:"cell-label"},"名字",-1)),a("span",Oa,u(d.value.request.first_name||"无"),1)]),a("div",Na,[e[66]||(e[66]=a("span",{class:"cell-label"},"姓氏",-1)),a("span",Ra,u(d.value.request.last_name||"无"),1)])]),a("div",La,[a("div",Ea,[e[67]||(e[67]=a("span",{class:"cell-label"},"国家",-1)),a("span",ja,u(d.value.request.country||"无"),1)]),a("div",Ma,[e[68]||(e[68]=a("span",{class:"cell-label"},"州/省",-1)),a("span",Aa,u(d.value.request.state||"无"),1)]),a("div",Va,[e[69]||(e[69]=a("span",{class:"cell-label"},"城市",-1)),a("span",Ha,u(d.value.request.city||"无"),1)]),a("div",Ba,[e[70]||(e[70]=a("span",{class:"cell-label"},"邮编",-1)),a("span",Fa,u(d.value.request.zip_code||"无"),1)])]),a("div",Wa,[a("div",Ja,[e[71]||(e[71]=a("span",{class:"cell-label"},"街道地址",-1)),a("span",Qa,u(d.value.request.street_address||"无"),1)])]),a("div",Ka,[a("div",Ga,[e[72]||(e[72]=a("span",{class:"cell-label"},"总支付次数",-1)),a("span",Ya,u(d.value.request.user_statistics.total_payments),1)]),a("div",Za,[e[73]||(e[73]=a("span",{class:"cell-label"},"完成支付次数",-1)),a("span",Xa,u(d.value.request.user_statistics.completed_payments),1)]),a("div",el,[e[74]||(e[74]=a("span",{class:"cell-label"},"成功支付次数",-1)),a("span",sl,u(d.value.request.user_statistics.successful_payments),1)]),a("div",tl,[e[75]||(e[75]=a("span",{class:"cell-label"},"成功率",-1)),a("span",al,u((d.value.request.user_statistics.success_rate*100).toFixed(1))+"%",1)])]),a("div",ll,[a("div",il,[e[76]||(e[76]=a("span",{class:"cell-label"},"用户ID",-1)),a("span",nl,u(((n=d.value.request.user_info)==null?void 0:n.id)||"无"),1)]),a("div",ol,[e[77]||(e[77]=a("span",{class:"cell-label"},"用户UUID",-1)),a("span",rl,u(((v=d.value.request.user_info)==null?void 0:v.uuid)||"无"),1)]),a("div",cl,[e[78]||(e[78]=a("span",{class:"cell-label"},"首次访问",-1)),a("span",ul,u(r(Y)((P=d.value.request.user_info)==null?void 0:P.first_seen)||"无"),1)]),a("div",dl,[e[79]||(e[79]=a("span",{class:"cell-label"},"最后访问",-1)),a("span",pl,u(r(Y)((f=d.value.request.user_info)==null?void 0:f.last_seen)||"无"),1)])]),a("div",vl,[a("div",fl,[e[80]||(e[80]=a("span",{class:"cell-label"},"浏览器",-1)),a("span",ml,u(((z=d.value.session.user_agent_parse)==null?void 0:z.browser_name)||"无"),1)]),a("div",gl,[e[81]||(e[81]=a("span",{class:"cell-label"},"浏览器版本",-1)),a("span",_l,u((($=d.value.session.user_agent_parse)==null?void 0:$.browser_version)||"无"),1)]),a("div",yl,[e[82]||(e[82]=a("span",{class:"cell-label"},"操作系统",-1)),a("span",bl,u(((C=d.value.session.user_agent_parse)==null?void 0:C.browser_os)||"无"),1)]),a("div",xl,[e[83]||(e[83]=a("span",{class:"cell-label"},"平台",-1)),a("span",hl,u(((E=d.value.session.user_agent_parse)==null?void 0:E.browser_platform)||"无"),1)])]),a("div",wl,[a("div",kl,[e[84]||(e[84]=a("span",{class:"cell-label"},"语言",-1)),a("span",ql,u(((B=(M=d.value.session.device_fingerprint)==null?void 0:M.device_info)==null?void 0:B.language)||"无"),1)]),a("div",$l,[e[85]||(e[85]=a("span",{class:"cell-label"},"时区",-1)),a("span",Cl,u(((W=(F=d.value.session.device_fingerprint)==null?void 0:F.device_info)==null?void 0:W.timezone)||"无"),1)]),a("div",Sl,[e[86]||(e[86]=a("span",{class:"cell-label"},"设备平台",-1)),a("span",Pl,u(((Q=(J=d.value.session.device_fingerprint)==null?void 0:J.device_info)==null?void 0:Q.platform)||"无"),1)]),a("div",Tl,[e[87]||(e[87]=a("span",{class:"cell-label"},"产品",-1)),a("span",Dl,u(((te=(K=d.value.session.device_fingerprint)==null?void 0:K.device_info)==null?void 0:te.product)||"无"),1)])]),a("div",Il,[a("div",zl,[e[88]||(e[88]=a("span",{class:"cell-label"},"国家",-1)),a("span",Ul,u(((ae=d.value.session.ip_info)==null?void 0:ae.country)||"无"),1)]),a("div",Ol,[e[89]||(e[89]=a("span",{class:"cell-label"},"地区",-1)),a("span",Nl,u(((cs=d.value.session.ip_info)==null?void 0:cs.region)||"无"),1)]),a("div",Rl,[e[90]||(e[90]=a("span",{class:"cell-label"},"城市",-1)),a("span",Ll,u(((us=d.value.session.ip_info)==null?void 0:us.city)||"无"),1)]),a("div",El,[e[91]||(e[91]=a("span",{class:"cell-label"},"ISP",-1)),a("span",jl,u(((ds=d.value.session.ip_info)==null?void 0:ds.isp)||"无"),1)])]),a("div",Ml,[a("div",Al,[e[92]||(e[92]=a("span",{class:"cell-label"},"客户端ID",-1)),a("span",Vl,u(d.value.session.client_id),1)]),a("div",Hl,[e[93]||(e[93]=a("span",{class:"cell-label"},"IP地址",-1)),a("span",Bl,u(d.value.session.ip_address),1)]),a("div",Fl,[e[94]||(e[94]=a("span",{class:"cell-label"},"连接状态",-1)),c(r(h),{type:d.value.session.is_connected?"success":"default",size:"small"},{default:p(()=>[m(u(d.value.session.is_connected?"在线":"离线"),1)]),_:1},8,["type"])])]),a("div",Wl,[a("div",Jl,[e[95]||(e[95]=a("span",{class:"cell-label"},"会话ID",-1)),a("span",Ql,u(d.value.session.session_id),1)])]),a("div",Kl,[a("div",Gl,[e[96]||(e[96]=a("span",{class:"cell-label"},"页面URL",-1)),a("span",Yl,u(d.value.session.page_url),1)])]),a("div",Zl,[a("div",Xl,[e[97]||(e[97]=a("span",{class:"cell-label"},"页面标题",-1)),a("span",ei,u(d.value.session.page_title),1)])]),a("div",si,[a("div",ti,[e[98]||(e[98]=a("span",{class:"cell-label"},"用户代理",-1)),a("span",ai,u(d.value.session.user_agent||"无"),1)])])])])):(y(),T("div",li,[c(r(Mt),{size:"large"})]))]}),_:1},8,["show","title"]),c(r(G),{show:$e.value,"onUpdate:show":e[19]||(e[19]=t=>$e.value=t),preset:"dialog",title:"添加备注","positive-text":"提交","negative-text":"取消",onPositiveClick:Ds},{default:p(()=>[c(r(R),{value:xe.value,"onUpdate:value":e[18]||(e[18]=t=>xe.value=t),type:"textarea",placeholder:"请输入备注内容",rows:4},null,8,["value"])]),_:1},8,["show"]),c(r(G),{show:Ce.value,"onUpdate:show":e[23]||(e[23]=t=>Ce.value=t),preset:"dialog",title:"OTP验证","positive-text":"发送","negative-text":"取消",onPositiveClick:zs},{default:p(()=>[a("div",ii,[a("div",ni,[c(r(I),null,{default:p(()=>e[99]||(e[99]=[m("短信验证引导")])),_:1})]),pe.value?(y(),T("div",oi,[c(l,{value:pe.value,"onUpdate:value":e[20]||(e[20]=t=>pe.value=t)},null,8,["value"]),c(r(I),{class:"ml-2"},{default:p(()=>e[100]||(e[100]=[m("自定义文案")])),_:1})])):S("",!0),pe.value?(y(),T("div",ci,[c(r(R),{value:ue.value,"onUpdate:value":e[22]||(e[22]=t=>ue.value=t),type:"textarea",placeholder:"请输入自定义验证文案",rows:4},null,8,["value"])])):(y(),T("div",ri,[c(r(R),{value:ue.value,"onUpdate:value":e[21]||(e[21]=t=>ue.value=t),placeholder:"请输入手机号格式（默认是后3-4位）"},null,8,["value"])]))])]),_:1},8,["show"]),c(r(G),{show:Se.value,"onUpdate:show":e[27]||(e[27]=t=>Se.value=t),preset:"dialog",title:"邮箱OTP验证","positive-text":"发送","negative-text":"取消",onPositiveClick:Os},{default:p(()=>[a("div",ui,[a("div",di,[c(r(I),null,{default:p(()=>e[101]||(e[101]=[m("邮箱验证引导")])),_:1})]),ve.value?(y(),T("div",pi,[c(l,{value:ve.value,"onUpdate:value":e[24]||(e[24]=t=>ve.value=t)},null,8,["value"]),c(r(I),{class:"ml-2"},{default:p(()=>e[102]||(e[102]=[m("自定义文案")])),_:1})])):S("",!0),ve.value?(y(),T("div",fi,[c(r(R),{value:de.value,"onUpdate:value":e[26]||(e[26]=t=>de.value=t),type:"textarea",placeholder:"请输入自定义验证文案",rows:4},null,8,["value"])])):(y(),T("div",vi,[c(r(R),{value:de.value,"onUpdate:value":e[25]||(e[25]=t=>de.value=t),placeholder:"请输入邮箱（格式：a***@xxx.com），或者根据使用场景来填写"},null,8,["value"])]))])]),_:1},8,["show"]),c(r(G),{show:Pe.value,"onUpdate:show":e[30]||(e[30]=t=>Pe.value=t),preset:"dialog",title:"PIN验证","positive-text":"发送","negative-text":"取消",onPositiveClick:Rs},{default:p(()=>[a("div",mi,[a("div",gi,[c(r(I),null,{default:p(()=>e[103]||(e[103]=[m("PIN验证引导")])),_:1})]),fe.value?(y(),T("div",_i,[c(l,{value:fe.value,"onUpdate:value":e[28]||(e[28]=t=>fe.value=t)},null,8,["value"]),c(r(I),{class:"ml-2"},{default:p(()=>e[104]||(e[104]=[m("自定义文案")])),_:1})])):S("",!0),fe.value?(y(),T("div",yi,[c(r(R),{value:ze.value,"onUpdate:value":e[29]||(e[29]=t=>ze.value=t),type:"textarea",placeholder:"请输入自定义验证文案",rows:4},null,8,["value"])])):S("",!0)])]),_:1},8,["show"]),c(r(G),{show:Te.value,"onUpdate:show":e[33]||(e[33]=t=>Te.value=t),preset:"dialog",title:"APP验证","positive-text":"发送","negative-text":"取消",onPositiveClick:Es},{default:p(()=>[a("div",bi,[a("div",xi,[c(r(I),null,{default:p(()=>e[105]||(e[105]=[m("APP验证引导")])),_:1})]),me.value?(y(),T("div",hi,[c(l,{value:me.value,"onUpdate:value":e[31]||(e[31]=t=>me.value=t)},null,8,["value"]),c(r(I),{class:"ml-2"},{default:p(()=>e[106]||(e[106]=[m("自定义文案")])),_:1})])):S("",!0),me.value?(y(),T("div",wi,[c(r(R),{value:Ue.value,"onUpdate:value":e[32]||(e[32]=t=>Ue.value=t),type:"textarea",placeholder:"请输入自定义验证文案",rows:4},null,8,["value"])])):S("",!0)])]),_:1},8,["show"]),c(r(G),{show:De.value,"onUpdate:show":e[35]||(e[35]=t=>De.value=t),preset:"dialog",title:"拒绝支付","positive-text":"发送","negative-text":"取消",onPositiveClick:Ms},{default:p(()=>[a("div",ki,[c(r(I),null,{default:p(()=>e[107]||(e[107]=[m("自定义拒绝文案")])),_:1})]),c(r(R),{value:Oe.value,"onUpdate:value":e[34]||(e[34]=t=>Oe.value=t),type:"textarea",placeholder:"不输入则显示系统默认(支持HTML标签)",rows:4},null,8,["value"])]),_:1},8,["show"]),c(r(G),{show:Ie.value,"onUpdate:show":e[39]||(e[39]=t=>Ie.value=t),preset:"dialog",title:"断开并拉黑","positive-text":"确认拉黑","negative-text":"取消",onPositiveClick:Hs},{default:p(()=>[a("div",qi,[a("div",null,[c(r(I),{class:"mb-2 block"},{default:p(()=>e[108]||(e[108]=[m("黑名单类型")])),_:1}),c(r(le),{value:A.blacklist_type,"onUpdate:value":e[36]||(e[36]=t=>A.blacklist_type=t),options:hs,placeholder:"选择黑名单类型"},null,8,["value"])]),a("div",null,[c(r(I),{class:"mb-2 block"},{default:p(()=>e[109]||(e[109]=[m("重定向URL（可选）")])),_:1}),c(r(R),{value:A.redirect_url,"onUpdate:value":e[37]||(e[37]=t=>A.redirect_url=t),placeholder:"留空使用默认跳转页面"},null,8,["value"])]),a("div",null,[c(r(I),{class:"mb-2 block"},{default:p(()=>e[110]||(e[110]=[m("备注说明")])),_:1}),c(r(R),{value:A.notes,"onUpdate:value":e[38]||(e[38]=t=>A.notes=t),type:"textarea",placeholder:"请输入拉黑原因或备注信息",rows:4},null,8,["value"])])])]),_:1},8,["show"]),c(r(G),{show:qe.value,"onUpdate:show":e[40]||(e[40]=t=>qe.value=t),preset:"card",title:"卡片模拟图",style:{width:"600px"},"mask-closable":!0},{default:p(()=>{var t,n,v,P,f,z,$,C,E,M,B,F,W,J,Q,K;return[U.value?(y(),T("div",$i,[a("div",Ci,[a("div",Si,[e[111]||(e[111]=a("div",{class:"chip-logo"},[a("div",{class:"chip"})],-1)),a("div",Pi,[a("img",{src:Ze(U.value.card_type),alt:Xe(U.value.card_type),class:"brand-logo"},null,8,Ti)])]),a("div",Di,u(U.value.card_number?U.value.card_number.replace(/(\d{4})(?=\d)/g,"$1 "):"5144 4024 6292 7009"),1),a("div",Ii,[a("div",zi,[e[112]||(e[112]=a("div",{class:"label"},"Card Holder",-1)),a("div",Ui,u(U.value.card_holder||"Adrian Orbe"),1)]),a("div",Oi,[e[113]||(e[113]=a("div",{class:"label"},"Expires",-1)),a("div",Ni,u(U.value.expiry_date||"09/26"),1)]),a("div",Ri,[e[114]||(e[114]=a("div",{class:"label"},"CVV",-1)),a("div",Li,u(U.value.cvv||"825"),1)])])]),(t=U.value)!=null&&t.card_info?(y(),T("div",Ei,[e[120]||(e[120]=a("h3",null,"🏦 Card Info 详细信息",-1)),a("div",ji,[a("div",Mi,[e[115]||(e[115]=a("span",{class:"info-label"},"🔢 BIN",-1)),a("span",Ai,u(((v=(n=U.value)==null?void 0:n.card_info)==null?void 0:v.bin)||"未知"),1)]),a("div",Vi,[e[116]||(e[116]=a("span",{class:"info-label"},"🏷️ 品牌",-1)),a("span",Hi,u(((f=(P=U.value)==null?void 0:P.card_info)==null?void 0:f.brand)||"未知"),1)]),a("div",Bi,[e[117]||(e[117]=a("span",{class:"info-label"},"💳 卡片类型",-1)),a("span",Fi,u((($=(z=U.value)==null?void 0:z.card_info)==null?void 0:$.card_type)||"未知"),1)]),a("div",Wi,[e[118]||(e[118]=a("span",{class:"info-label"},"🌐 国家",-1)),a("span",Ji,u(((M=(E=(C=U.value)==null?void 0:C.card_info)==null?void 0:E.country)==null?void 0:M.name)||"未知")+" "+u(((W=(F=(B=U.value)==null?void 0:B.card_info)==null?void 0:F.country)==null?void 0:W.emoji)||""),1)]),a("div",Qi,[e[119]||(e[119]=a("span",{class:"info-label"},"🏛️ 银行",-1)),a("span",Ki,u(((K=(Q=(J=U.value)==null?void 0:J.card_info)==null?void 0:Q.bank)==null?void 0:K.name)||"未知"),1)])])])):S("",!0)])):S("",!0)]}),_:1},8,["show"]),c(r(G),{show:ke.value,"onUpdate:show":e[44]||(e[44]=t=>ke.value=t),preset:"dialog",title:"导出支付请求数据","positive-text":"开始导出","negative-text":"取消","positive-button-props":{loading:je.value},style:{width:"600px"},onPositiveClick:Ct},{default:p(()=>[a("div",Gi,[a("div",Yi,[e[121]||(e[121]=a("h4",null,"导出模式",-1)),c(r(le),{value:b.export_mode,"onUpdate:value":e[41]||(e[41]=t=>b.export_mode=t),options:Je,placeholder:"选择导出模式"},null,8,["value"]),a("div",Zi,[c(r(I),{depth:"3",style:{"font-size":"12px"}},{default:p(()=>{var t;return[m(u((t=Je.find(n=>n.value===b.export_mode))==null?void 0:t.description),1)]}),_:1})])]),a("div",Xi,[e[122]||(e[122]=a("h4",null,"导出格式",-1)),c(r(le),{value:b.format,"onUpdate:value":e[42]||(e[42]=t=>b.format=t),options:gs,placeholder:"选择导出格式"},null,8,["value"])]),a("div",en,[e[124]||(e[124]=a("h4",null,"额外筛选",-1)),c(r(_e),{vertical:""},{default:p(()=>[a("div",null,[c(r(I),null,{default:p(()=>e[123]||(e[123]=[m("卡片类型：")])),_:1}),c(r(le),{value:b.card_type,"onUpdate:value":e[43]||(e[43]=t=>b.card_type=t),options:_s,placeholder:"选择卡片类型",style:{width:"200px","margin-left":"8px"},clearable:""},null,8,["value"])])]),_:1})]),a("div",sn,[e[126]||(e[126]=a("h4",null,"当前搜索条件",-1)),a("div",tn,[b.status?(y(),X(r(h),{key:0,type:"info",size:"small"},{default:p(()=>{var t;return[m(" 状态: "+u(((t=ce[b.status])==null?void 0:t.label)||b.status),1)]}),_:1})):S("",!0),b.is_completed!==void 0?(y(),X(r(h),{key:1,type:"info",size:"small"},{default:p(()=>[m(" 完成状态: "+u(b.is_completed?"已完成":"未完成"),1)]),_:1})):S("",!0),b.success!==void 0?(y(),X(r(h),{key:2,type:"info",size:"small"},{default:p(()=>[m(" 成功状态: "+u(b.success?"成功":"失败"),1)]),_:1})):S("",!0),b.user_uuid?(y(),X(r(h),{key:3,type:"info",size:"small"},{default:p(()=>[m("用户UUID: "+u(b.user_uuid),1)]),_:1})):S("",!0),b.client_id?(y(),X(r(h),{key:4,type:"info",size:"small"},{default:p(()=>[m("客户端ID: "+u(b.client_id),1)]),_:1})):S("",!0),b.ip_address?(y(),X(r(h),{key:5,type:"info",size:"small"},{default:p(()=>[m("IP地址: "+u(b.ip_address),1)]),_:1})):S("",!0),b.start_date?(y(),X(r(h),{key:6,type:"info",size:"small"},{default:p(()=>[m(" 开始时间: "+u(new Date(b.start_date).toLocaleString()),1)]),_:1})):S("",!0),b.end_date?(y(),X(r(h),{key:7,type:"info",size:"small"},{default:p(()=>[m(" 结束时间: "+u(new Date(b.end_date).toLocaleString()),1)]),_:1})):S("",!0),Object.values(b).some(t=>t!==void 0&&t!=="")?S("",!0):(y(),X(r(I),{key:8,depth:"3"},{default:p(()=>e[125]||(e[125]=[m(" 无筛选条件，将导出所有数据 ")])),_:1}))])]),a("div",an,[c(r(_e),null,{default:p(()=>[c(r(Z),{size:"small",type:"tertiary",onClick:St},{default:p(()=>e[127]||(e[127]=[m("重置配置")])),_:1})]),_:1})])])]),_:1},8,["show","positive-button-props"]),c(r(G),{show:Ne.value,"onUpdate:show":e[48]||(e[48]=t=>Ne.value=t),preset:"dialog",title:"快速添加卡头备注","positive-text":"确定","negative-text":"取消",onPositiveClick:ut},{default:p(()=>[a("div",ln,[a("div",null,[c(r(I),{class:"mb-2 block"},{default:p(()=>e[128]||(e[128]=[m("卡号")])),_:1}),c(r(R),{value:Ge.value,disabled:"",placeholder:"当前选择的卡号"},null,8,["value"])]),a("div",null,[c(r(I),{class:"mb-2 block"},{default:p(()=>e[129]||(e[129]=[m("卡头 *")])),_:1}),c(r(R),{value:V.card_prefix,"onUpdate:value":e[45]||(e[45]=t=>V.card_prefix=t),placeholder:"系统自动提取，可手动调整",maxlength:"8"},null,8,["value"]),c(r(I),{depth:"3",class:"mt-1 text-sm"},{default:p(()=>e[130]||(e[130]=[m("卡头必须是6-8位数字，系统已自动提取前6位")])),_:1})]),a("div",null,[c(r(I),{class:"mb-2 block"},{default:p(()=>e[131]||(e[131]=[m("备注内容 *")])),_:1}),c(r(R),{value:V.note_content,"onUpdate:value":e[46]||(e[46]=t=>V.note_content=t),type:"textarea",placeholder:"请输入备注内容",rows:3,maxlength:"200","show-count":""},null,8,["value"])]),a("div",null,[c(r(I),{class:"mb-2 block"},{default:p(()=>e[132]||(e[132]=[m("标签颜色")])),_:1}),c(r(le),{value:V.tag_color,"onUpdate:value":e[47]||(e[47]=t=>V.tag_color=t),options:Ke.value.map(t=>({label:t.name,value:t.value,color:t.color})),placeholder:"选择标签颜色"},null,8,["value","options"])])])]),_:1},8,["show"])])}}}),bn=Vt(on,[["__scopeId","data-v-1719d204"]]);export{bn as default};
