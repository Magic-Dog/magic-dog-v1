import{_ as fe,a as ge}from"./table-header-operation.vue_vue_type_script_setup_true_lang-CceyS1md.js";import{c as O,b as _e,g as ve,h as he}from"./auth-DgEtrDql.js";import{r as M,a as z,$ as t,ag as j,ah as ye,d as Y,ai as q,aj as ae,ak as be,o as B,c as $,w as n,f as a,g as I,t as A,h as e,b as H,I as J,J as X,N as te,al as le,B as K,am as Ne,an as ke,ao as Q,H as ne,x as we,p as Te,K as Z,ap as W,aq as Ce}from"./index-DatkZRbF.js";import{u as se,s as oe,a as De,b as Ue}from"./business-cw982MEc.js";import{u as re,a as ue}from"./form-x_OFTNP-.js";import{_ as xe,a as Se,N as Pe}from"./DataTable-DMOCqobO.js";import{_ as Re,a as ie}from"./FormItem-C7758XXs.js";import{N as pe}from"./Space-CI4Nw6uS.js";import{_ as Ee,a as Ge}from"./round-refresh-D0U2Bnw5.js";import{_ as Be}from"./Grid-UXeFur27.js";import{_ as Oe,a as Fe}from"./CollapseItem-BZSLyfdP.js";import{N as Me}from"./Popconfirm-BqwKHHew.js";import"./get-slot-Bk_rJcZu.js";import"./Pagination-qfxkEyuV.js";function $e(){return O.Get("/system-manage/roles")}function ze(o){return O.Post("/system-manage/users/all/",{data:o})}function Ie(o){return O.Post("/systemManage/users",o)}function Ae(o){return O.Patch("/systemManage/users",o)}function Ke(o){return O.Delete(`/system-manage/users/${o}`)}function Le(o){return O.Delete("/system-manage/users",{ids:o})}function ee(o){return!!o.key}function Ve(o){const N="__selection__",g="__expand__",_=M((r=>{const d=[];return r.forEach(v=>{ee(v)?d.push({key:v.key,title:v.title,checked:!0}):v.type==="selection"?d.push({key:N,title:t("common.check"),checked:!0}):v.type==="expand"&&d.push({key:g,title:t("common.expandColumn"),checked:!0})}),d})(o())),S=z(()=>{const r=o(),d=new Map;return r.forEach(c=>{ee(c)?d.set(c.key,c):c.type==="selection"?d.set(N,c):c.type==="expand"&&d.set(g,c)}),_.value.filter(c=>c.checked).map(c=>d.get(c.key))});return{columnChecks:_,columns:S}}function je(o,N){const{bool:g,setTrue:D,setFalse:_}=j(),{bool:S,setTrue:r,setFalse:d}=j(),{bool:v,setTrue:c,setFalse:E}=j(),C=M("add"),m=w=>o.value.find(h=>h.id===w)||null;function s(){C.value="add",D()}const k=M(null);function P(w){C.value="edit",k.value=ye(m(w)),D()}const U=M([]);async function R(){var w,h;c();try{const x=U.value.map(f=>m(f)).filter(Boolean);await((w=N.batchDelete)==null?void 0:w.call(N,x)),(h=window.$message)==null||h.success(t("common.deleteSuccess")),U.value=[]}finally{E()}}async function G(w){var x,f;r();const h=m(w);if(h)try{await((x=N.delete)==null?void 0:x.call(N,h)),(f=window.$message)==null||f.success(t("common.deleteSuccess")),U.value=[]}finally{d()}}return{drawerVisible:g,openDrawer:D,closeDrawer:_,operateType:C,handleAdd:s,editingData:k,handleEdit:P,checkedRowKeys:U,deleting:S,handleDelete:G,batchDeleting:v,handleBatchDelete:R}}const We=Y({name:"UserOperateDrawer",__name:"user-operate-drawer",props:q({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:q(["submitted"],["update:visible"]),setup(o,{emit:N}){const g=o,D=N,_=ae(o,"visible"),{formRef:S,validate:r,restoreValidation:d}=re(),{defaultRequiredRule:v}=ue(),c=z(()=>({add:t("page.manage.user.addUser"),edit:t("page.manage.user.editUser")})[g.operateType]),{loading:E,reset:C,send:m,form:s,updateForm:k}=_e(f=>g.operateType==="add"?Ie(f):Ae(f),{initialForm:{userName:"",userGender:null,nickName:"",userPhone:"",userEmail:"",byUserRoleCodeList:[],statusType:null},resetAfterSubmiting:!0}),P={userName:v,statusType:v},{data:U,loading:R}=ve($e,[_],{initialData:[],middleware(f,u){return _.value?u():void 0}}),G=z(()=>{const f=U.value.map(T=>({label:T.roleName,value:T.roleCode}));return[...s.value.byUserRoleCodeList.map(T=>({label:T,value:T})),...f]});function w(){g.operateType==="edit"&&g.rowData?k(g.rowData):g.operateType==="add"&&C()}function h(){_.value=!1}async function x(){var f;await r(),await m(),(f=window.$message)==null||f.success(t("common.updateSuccess")),h(),D("submitted")}return be(_,()=>{_.value&&(d(),w())}),(f,u)=>{const T=te,l=Re,i=Se,y=xe,L=le,V=ie,b=K,de=pe,me=Ne,ce=ke;return B(),$(ce,{show:_.value,"onUpdate:show":u[7]||(u[7]=p=>_.value=p),"display-directive":"show",width:360},{default:n(()=>[a(me,{title:c.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[a(de,{size:16},{default:n(()=>[a(b,{onClick:h},{default:n(()=>[I(A(e(t)("common.cancel")),1)]),_:1}),a(b,{type:"primary",loading:e(E),onClick:x},{default:n(()=>[I(A(e(t)("common.confirm")),1)]),_:1},8,["loading"])]),_:1})]),default:n(()=>[a(V,{ref_key:"formRef",ref:S,model:e(s),rules:P},{default:n(()=>[a(l,{label:e(t)("page.manage.user.userName"),path:"userName"},{default:n(()=>[a(T,{value:e(s).userName,"onUpdate:value":u[0]||(u[0]=p=>e(s).userName=p),placeholder:e(t)("page.manage.user.form.userName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{label:e(t)("page.manage.user.userGender"),path:"userGender"},{default:n(()=>[a(y,{value:e(s).userGender,"onUpdate:value":u[1]||(u[1]=p=>e(s).userGender=p)},{default:n(()=>[(B(!0),H(X,null,J(e(se),p=>(B(),$(i,{key:p.value,value:p.value,label:e(t)(p.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(l,{label:e(t)("page.manage.user.nickName"),path:"nickName"},{default:n(()=>[a(T,{value:e(s).nickName,"onUpdate:value":u[2]||(u[2]=p=>e(s).nickName=p),placeholder:e(t)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{label:e(t)("page.manage.user.userPhone"),path:"userPhone"},{default:n(()=>[a(T,{value:e(s).userPhone,"onUpdate:value":u[3]||(u[3]=p=>e(s).userPhone=p),placeholder:e(t)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{label:e(t)("page.manage.user.userEmail"),path:"email"},{default:n(()=>[a(T,{value:e(s).userEmail,"onUpdate:value":u[4]||(u[4]=p=>e(s).userEmail=p),placeholder:e(t)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{label:e(t)("page.manage.user.userStatusType"),path:"status"},{default:n(()=>[a(y,{value:e(s).statusType,"onUpdate:value":u[5]||(u[5]=p=>e(s).statusType=p)},{default:n(()=>[(B(!0),H(X,null,J(e(oe),p=>(B(),$(i,{key:p.value,value:p.value,label:e(t)(p.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(l,{label:e(t)("page.manage.user.userRole"),path:"roles"},{default:n(()=>[a(L,{value:e(s).byUserRoleCodeList,"onUpdate:value":u[6]||(u[6]=p=>e(s).byUserRoleCodeList=p),multiple:"",loading:e(R),options:G.value,placeholder:e(t)("page.manage.user.form.userRole")},null,8,["value","loading","options","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),qe=Y({name:"UserSearch",__name:"user-search",props:{model:{required:!0},modelModifiers:{}},emits:q(["search"],["update:model"]),setup(o,{emit:N}){const g=N,{formRef:D,validate:_,restoreValidation:S}=re(),r=ae(o,"model"),d={...r.value},v=z(()=>{const{patternRules:C}=ue();return{userEmail:C.email,userPhone:C.phone}});async function c(){await S(),Object.assign(r.value,d)}async function E(){await _(),g("search")}return(C,m)=>{const s=te,k=fe,P=le,U=Ee,R=K,G=Ge,w=pe,h=Be,x=ie,f=Oe,u=Fe,T=ne;return B(),$(T,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[a(u,{"default-expanded-names":["user-search"]},{default:n(()=>[a(f,{title:e(t)("common.search"),name:"user-search"},{default:n(()=>[a(x,{ref_key:"formRef",ref:D,model:r.value,rules:v.value,"label-placement":"left","label-width":80},{default:n(()=>[a(h,{responsive:"screen","item-responsive":""},{default:n(()=>[a(k,{span:"24 s:12 m:6",label:e(t)("page.manage.user.userName"),path:"userName",class:"pr-24px"},{default:n(()=>[a(s,{value:r.value.userName,"onUpdate:value":m[0]||(m[0]=l=>r.value.userName=l),placeholder:e(t)("page.manage.user.form.userName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(k,{span:"24 s:12 m:6",label:e(t)("page.manage.user.userGender"),path:"userGender",class:"pr-24px"},{default:n(()=>[a(P,{value:r.value.userGender,"onUpdate:value":m[1]||(m[1]=l=>r.value.userGender=l),placeholder:e(t)("page.manage.user.form.userGender"),options:e(Q)(e(se)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(k,{span:"24 s:12 m:6",label:e(t)("page.manage.user.nickName"),path:"nickName",class:"pr-24px"},{default:n(()=>[a(s,{value:r.value.nickName,"onUpdate:value":m[2]||(m[2]=l=>r.value.nickName=l),placeholder:e(t)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(k,{span:"24 s:12 m:6",label:e(t)("page.manage.user.userPhone"),path:"userPhone",class:"pr-24px"},{default:n(()=>[a(s,{value:r.value.userPhone,"onUpdate:value":m[3]||(m[3]=l=>r.value.userPhone=l),placeholder:e(t)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(k,{span:"24 s:12 m:6",label:e(t)("page.manage.user.userEmail"),path:"userEmail",class:"pr-24px"},{default:n(()=>[a(s,{value:r.value.userEmail,"onUpdate:value":m[4]||(m[4]=l=>r.value.userEmail=l),placeholder:e(t)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(k,{span:"24 s:12 m:6",label:e(t)("page.manage.user.userStatusType"),path:"userStatusType",class:"pr-24px"},{default:n(()=>[a(P,{value:r.value.statusType,"onUpdate:value":m[5]||(m[5]=l=>r.value.statusType=l),placeholder:e(t)("page.manage.user.form.userStatusType"),options:e(Q)(e(oe)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(k,{span:"24 m:12",class:"pr-24px"},{default:n(()=>[a(w,{class:"w-full",justify:"end"},{default:n(()=>[a(R,{onClick:c},{icon:n(()=>[a(U,{class:"text-icon"})]),default:n(()=>[I(" "+A(e(t)("common.reset")),1)]),_:1}),a(R,{type:"primary",ghost:"",onClick:E},{icon:n(()=>[a(G,{class:"text-icon"})]),default:n(()=>[I(" "+A(e(t)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),He={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function F(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!Ce(o)}const ia=Y({name:"alova_user",__name:"index",setup(o){const N=we(),g=Te({status:null,userName:null,userGender:null,nickName:null,userPhone:null,userEmail:null}),{loading:D,data:_,refresh:S,reload:r,page:d,pageSize:v,pageCount:c,send:E,remove:C}=he((l,i)=>ze({...g,current:l,size:i}),{data:({records:l})=>l,total:({total:l})=>l,watchingStates:[g],debounce:[1e3]}),m=(l=1)=>{d.value=l,E(d.value,v.value)},{drawerVisible:s,operateType:k,editingData:P,handleAdd:U,handleEdit:R,handleDelete:G,handleBatchDelete:w,checkedRowKeys:h,deleting:x}=je(_,{async delete(l){await Ke(l.id),C(l)},async batchDelete(l){await Le(l.map(({id:i})=>i)),C(...l)}});function f(l){R(l)}const{columnChecks:u,columns:T}=Ve(()=>[{type:"selection",align:"center",width:48},{key:"userName",title:t("page.manage.user.userName"),align:"center",minWidth:100},{key:"userGender",title:t("page.manage.user.userGender"),align:"center",width:100,render:l=>{if(l.userGender===null)return null;const i={1:"primary",2:"error",3:"error"},y=t(De[l.userGender]);return a(Z,{type:i[l.userGender]},F(y)?y:{default:()=>[y]})}},{key:"nickName",title:t("page.manage.user.nickName"),align:"center",minWidth:100},{key:"userPhone",title:t("page.manage.user.userPhone"),align:"center",width:120},{key:"userEmail",title:t("page.manage.user.userEmail"),align:"center",minWidth:200},{key:"statusType",title:t("page.manage.user.userStatusType"),align:"center",width:100,render:l=>{if(l.statusType===null)return null;const i={1:"success",2:"warning"},y=t(Ue[l.statusType]);return a(Z,{type:i[l.statusType]},F(y)?y:{default:()=>[y]})}},{key:"operate",title:t("common.operate"),align:"center",width:130,render:l=>{let i;return a("div",{class:"flex-center gap-8px"},[a(K,{type:"primary",ghost:!0,size:"small",onClick:()=>f(l.id)},F(i=t("common.edit"))?i:{default:()=>[i]}),a(Me,{onPositiveClick:()=>G(l.id),positiveButtonProps:{loading:x.value}},{default:()=>t("common.confirmDelete"),trigger:()=>{let y;return a(K,{type:"error",ghost:!0,size:"small"},F(y=t("common.delete"))?y:{default:()=>[y]})}})])}}]);return(l,i)=>{const y=ge,L=Pe,V=ne;return B(),H("div",He,[a(qe,{model:g,"onUpdate:model":i[0]||(i[0]=b=>g=b),onSearch:m},null,8,["model"]),a(V,{title:e(t)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[a(y,{columns:e(u),"onUpdate:columns":i[1]||(i[1]=b=>W(u)?u.value=b:null),"disabled-delete":e(h).length===0,loading:e(D),onAdd:e(U),onDelete:e(w),onRefresh:e(S)},null,8,["columns","disabled-delete","loading","onAdd","onDelete","onRefresh"])]),default:n(()=>[a(L,{"checked-row-keys":e(h),"onUpdate:checkedRowKeys":i[2]||(i[2]=b=>W(h)?h.value=b:null),columns:e(T),data:e(_),size:"small","flex-height":!e(N).isMobile,"scroll-x":962,loading:e(D),remote:"","row-key":b=>b.id,pagination:{page:e(d),pageSize:e(v),showSizePicker:!0,pageCount:e(c),pageSizes:[10,15,20,25,30],onUpdatePage(b){d.value=b},onUpdatePageSize(b){v.value=b}},class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(We,{visible:e(s),"onUpdate:visible":i[3]||(i[3]=b=>W(s)?s.value=b:null),"operate-type":e(k),"row-data":e(P),onSubmitted:e(r)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{ia as default};
