import{dy as P,d as te,r as B,p as C,a as T,i as le,o as ae,b as re,f as l,w as a,h as s,K as b,g as o,t as x,B as g,H as R,bT as A,a2 as u,cx as O,cB as H,al as ne,N as ie,cy as se}from"./index-ClXfI4FU.js";import{N as D}from"./Space-CXAaFBqz.js";import{N as q}from"./Popconfirm-CSNmD-NH.js";import{_ as ue,a as oe}from"./FormItem-0Apn8Goa.js";import{N as de}from"./DatePicker-DqoFgBzS.js";import{N as pe}from"./DataTable-BPNYEKTe.js";import"./get-slot-Bk_rJcZu.js";import"./Pagination-BdniygT7.js";function ce(v={}){const h=Object.fromEntries(Object.entries(v).filter(([,_])=>_!=null&&_!==""));return P({url:"/payment/blacklist",method:"get",params:h})}function fe(v){return P({url:"/payment/blacklist",method:"post",data:v})}function _e(v){return P({url:`/payment/blacklist/${v}`,method:"delete"})}function ge(v,h){return P({url:`/payment/blacklist/${v}`,method:"put",data:h})}function ve(v){return P({url:`/payment/blacklist/${v}/deactivate`,method:"put"})}const me={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},ye=te({name:"session_blacklist",__name:"index",setup(v){const h=B(!1),_=B([]),p=C({page:1,pageSize:20,total:0,showSizePicker:!0,pageSizes:[10,20,50,100]}),d=C({page:1,size:20,blacklist_type:"",is_active:void 0,user_uuid:"",start_date:"",end_date:""}),k=C({start_date:null,end_date:null}),$=B(!1),c=C({user_uuid:"",blacklist_type:"user_black",redirect_url:"",notes:""}),N=B(!1),f=C({user_uuid:"",blacklist_type:"user_black",redirect_url:"",notes:""}),M=B(0),j={pay_wrong:{label:"风控拦截",type:"warning"},user_black:{label:"黑名单跳转",type:"error"}},E=[{key:"id",title:"ID",align:"center",width:80},{key:"user_uuid",title:"用户UUID",align:"center",width:320,render:t=>u("span",{class:"text-xs"},t.user_uuid)},{key:"user_info",title:"用户信息",align:"center",width:180,render:t=>t.user_info?u(H,{trigger:"hover"},{trigger:()=>u("div",{class:"cursor-pointer"},[u("div",`IP: ${t.user_info.ip_address}`),u(b,{type:t.is_online?"success":"default",size:"small"},{default:()=>t.is_online?"在线":"离线"})]),default:()=>u("div",[u("div",`IP: ${t.user_info.ip_address}`),u("div",`首次访问: ${O(t.user_info.first_seen)}`),u("div",`最后访问: ${O(t.user_info.last_seen)}`),u("div",`UserAgent: ${t.user_info.user_agent}`)])}):"-"},{key:"blacklist_type",title:"黑名单类型",align:"center",width:120,render:t=>{const e=j[t.blacklist_type];return u(b,{type:e.type},{default:()=>e.label})}},{key:"redirect_url",title:"重定向URL",align:"center",width:200,render:t=>t.redirect_url?u(H,{trigger:"hover"},{trigger:()=>u("a",{href:t.redirect_url,target:"_blank",class:"text-blue-500 hover:text-blue-700 cursor-pointer"},t.redirect_url.length>30?`${t.redirect_url.substring(0,30)}...`:t.redirect_url),default:()=>t.redirect_url}):"-"},{key:"notes",title:"备注",align:"center",width:200,render:t=>t.notes?u(H,{trigger:"hover"},{trigger:()=>u("span",{class:"cursor-pointer"},t.notes.length>20?`${t.notes.substring(0,20)}...`:t.notes),default:()=>t.notes}):"-"},{key:"is_active",title:"状态",align:"center",width:80,render:t=>u(b,{type:t.is_active?"success":"default"},{default:()=>t.is_active?"启用":"停用"})},{key:"create_time",title:"创建时间",align:"center",width:180,render:t=>O(t.create_time)},{key:"actions",title:"操作",align:"center",width:200,render:t=>u(D,{justify:"center"},{default:()=>[u(g,{size:"small",type:"primary",onClick:()=>Q(t)},{default:()=>"编辑"}),t.is_active?u(q,{onPositiveClick:()=>Y(t.id)},{trigger:()=>u(g,{size:"small",type:"warning"},{default:()=>"停用"}),default:()=>"确认停用该黑名单记录吗？"}):null,u(q,{onPositiveClick:()=>Z(t.id)},{trigger:()=>u(g,{size:"small",type:"error"},{default:()=>"删除"}),default:()=>"确认删除该黑名单记录吗？"})].filter(Boolean)})}];async function m(){var t;try{h.value=!0;const e={...d,page:p.page,size:p.pageSize,start_date:k.start_date?new Date(k.start_date).toISOString():void 0,end_date:k.end_date?new Date(k.end_date).toISOString():void 0},{data:n}=await ce(e);_.value=(n==null?void 0:n.blacklist)||[],p.total=(n==null?void 0:n.total)||0}catch(e){console.error("获取黑名单列表失败:",e),(t=window.$message)==null||t.error("获取黑名单列表失败")}finally{h.value=!1}}function L(){p.page=1,d.page=1,m()}function F(){Object.assign(d,{page:1,size:20,blacklist_type:"",is_active:void 0,user_uuid:""}),Object.assign(k,{start_date:null,end_date:null}),p.page=1,m()}function V(t){p.page=t,d.page=t,m()}function W(t){p.pageSize=t,p.page=1,d.size=t,d.page=1,m()}function J(){m()}function K(){Object.assign(c,{user_uuid:"",blacklist_type:"user_black",redirect_url:"",notes:""}),$.value=!0}function Q(t){Object.assign(f,{user_uuid:t.user_uuid,blacklist_type:t.blacklist_type,redirect_url:t.redirect_url||"",notes:t.notes||""}),M.value=t.id,N.value=!0}async function G(){var t,e,n;if(!c.user_uuid.trim()){(t=window.$message)==null||t.error("请输入用户UUID");return}try{await fe(c),(e=window.$message)==null||e.success("添加黑名单成功"),$.value=!1,m()}catch(i){console.error("添加黑名单失败:",i),(n=window.$message)==null||n.error("添加黑名单失败")}}async function X(){var t,e,n;if(!f.user_uuid.trim()){(t=window.$message)==null||t.error("请输入用户UUID");return}try{await ge(M.value,f),(e=window.$message)==null||e.success("更新黑名单成功"),N.value=!1,m()}catch(i){console.error("更新黑名单失败:",i),(n=window.$message)==null||n.error("更新黑名单失败")}}async function Y(t){var e,n;try{await ve(t),(e=window.$message)==null||e.success("停用黑名单成功"),m()}catch(i){console.error("停用黑名单失败:",i),(n=window.$message)==null||n.error("停用黑名单失败")}}async function Z(t){var e,n;try{await _e(t),(e=window.$message)==null||e.success("删除黑名单成功"),m()}catch(i){console.error("删除黑名单失败:",i),(n=window.$message)==null||n.error("删除黑名单失败")}}const U=T(()=>{const t=_.value.length,e=_.value.filter(w=>w.is_active).length,n=t-e,i=_.value.filter(w=>w.blacklist_type==="pay_wrong").length,y=_.value.filter(w=>w.blacklist_type==="user_black").length,z=_.value.filter(w=>w.is_online).length,I=t-z;return{total:t,active:e,inactive:n,payWrong:i,userBlack:y,online:z,offline:I}}),ee=T(()=>{const t=window.innerHeight;return Math.max(300,t-200-80-60-100)});return le(()=>{m()}),(t,e)=>{const n=ne,i=ue,y=ie,z=de,I=oe,w=pe;return ae(),re("div",me,[l(s(R),{title:"黑名单管理",class:"card-wrapper",size:"small"},{"header-extra":a(()=>[l(s(D),null,{default:a(()=>[l(s(b),{type:"info"},{default:a(()=>[o("总计: "+x(U.value.total),1)]),_:1}),l(s(b),{type:"success"},{default:a(()=>[o("启用: "+x(U.value.active),1)]),_:1}),l(s(b),{type:"default"},{default:a(()=>[o("停用: "+x(U.value.inactive),1)]),_:1}),l(s(b),{type:"warning"},{default:a(()=>[o("风控拦截: "+x(U.value.payWrong),1)]),_:1}),l(s(b),{type:"error"},{default:a(()=>[o("黑名单跳转: "+x(U.value.userBlack),1)]),_:1}),l(s(b),{type:"success"},{default:a(()=>[o("在线: "+x(U.value.online),1)]),_:1}),l(s(b),{type:"default"},{default:a(()=>[o("离线: "+x(U.value.offline),1)]),_:1})]),_:1})]),default:a(()=>[l(s(D),{vertical:""},{default:a(()=>[l(I,{inline:"",model:d,"label-placement":"left"},{default:a(()=>[l(i,{label:"黑名单类型"},{default:a(()=>[l(n,{value:d.blacklist_type,"onUpdate:value":e[0]||(e[0]=r=>d.blacklist_type=r),placeholder:"选择黑名单类型",clearable:"",style:{width:"140px"},options:Object.entries(j).map(([r,S])=>({label:S.label,value:r}))},null,8,["value","options"])]),_:1}),l(i,{label:"状态"},{default:a(()=>[l(n,{value:d.is_active,"onUpdate:value":e[1]||(e[1]=r=>d.is_active=r),placeholder:"选择状态",clearable:"",style:{width:"100px"},options:[{label:"启用",value:"true"},{label:"停用",value:"false"}]},null,8,["value"])]),_:1}),l(i,{label:"用户UUID"},{default:a(()=>[l(y,{value:d.user_uuid,"onUpdate:value":e[2]||(e[2]=r=>d.user_uuid=r),placeholder:"请输入用户UUID",clearable:"",style:{width:"200px"}},null,8,["value"])]),_:1}),l(i,{label:"开始时间"},{default:a(()=>[l(z,{value:k.start_date,"onUpdate:value":e[3]||(e[3]=r=>k.start_date=r),type:"datetime",placeholder:"选择开始时间",clearable:"",style:{width:"180px"}},null,8,["value"])]),_:1}),l(i,{label:"结束时间"},{default:a(()=>[l(z,{value:k.end_date,"onUpdate:value":e[4]||(e[4]=r=>k.end_date=r),type:"datetime",placeholder:"选择结束时间",clearable:"",style:{width:"180px"}},null,8,["value"])]),_:1}),l(i,null,{default:a(()=>[l(s(D),null,{default:a(()=>[l(s(g),{type:"primary",onClick:L},{default:a(()=>e[17]||(e[17]=[o("搜索")])),_:1}),l(s(g),{onClick:F},{default:a(()=>e[18]||(e[18]=[o("重置")])),_:1}),l(s(g),{onClick:J},{default:a(()=>e[19]||(e[19]=[o("刷新")])),_:1}),l(s(g),{type:"info",onClick:K},{default:a(()=>e[20]||(e[20]=[o("添加黑名单")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),l(s(R),{class:"flex-1-hidden card-wrapper table-card"},{default:a(()=>[l(w,{columns:E,data:_.value,loading:h.value,pagination:{page:p.page,pageSize:p.pageSize,itemCount:p.total,showSizePicker:!0,showQuickJumper:!0,pageSizes:[10,20,50,100],prefix:()=>`共 ${p.total} 条记录`,"onUpdate:page":V,"onUpdate:pageSize":W},"scroll-x":1500,"max-height":ee.value,size:"small","row-key":r=>r.id},null,8,["data","loading","pagination","max-height","row-key"])]),_:1}),l(s(A),{show:$.value,"onUpdate:show":e[10]||(e[10]=r=>$.value=r),preset:"card",title:"添加黑名单",style:{width:"500px"},"mask-closable":!1},{footer:a(()=>[l(s(D),{justify:"end"},{default:a(()=>[l(s(g),{onClick:e[9]||(e[9]=r=>$.value=!1)},{default:a(()=>e[21]||(e[21]=[o("取消")])),_:1}),l(s(g),{type:"primary",onClick:G},{default:a(()=>e[22]||(e[22]=[o("确认添加")])),_:1})]),_:1})]),default:a(()=>[l(I,{model:c,"label-placement":"left","label-width":"120px"},{default:a(()=>[l(i,{label:"用户UUID",required:""},{default:a(()=>[l(y,{value:c.user_uuid,"onUpdate:value":e[5]||(e[5]=r=>c.user_uuid=r),placeholder:"请输入用户UUID"},null,8,["value"])]),_:1}),l(i,{label:"黑名单类型",required:""},{default:a(()=>[l(n,{value:c.blacklist_type,"onUpdate:value":e[6]||(e[6]=r=>c.blacklist_type=r),options:Object.entries(j).map(([r,S])=>({label:S.label,value:r}))},null,8,["value","options"])]),_:1}),l(i,{label:"重定向URL"},{default:a(()=>[l(y,{value:c.redirect_url,"onUpdate:value":e[7]||(e[7]=r=>c.redirect_url=r),placeholder:"可选，为空时系统将使用默认重定向URL"},null,8,["value"])]),_:1}),l(i,{label:"备注"},{default:a(()=>[l(y,{value:c.notes,"onUpdate:value":e[8]||(e[8]=r=>c.notes=r),type:"textarea",placeholder:"请输入备注信息",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),l(s(A),{show:N.value,"onUpdate:show":e[16]||(e[16]=r=>N.value=r),preset:"card",title:"编辑黑名单",style:{width:"500px"},"mask-closable":!1},{footer:a(()=>[l(s(D),{justify:"end"},{default:a(()=>[l(s(g),{onClick:e[15]||(e[15]=r=>N.value=!1)},{default:a(()=>e[23]||(e[23]=[o("取消")])),_:1}),l(s(g),{type:"primary",onClick:X},{default:a(()=>e[24]||(e[24]=[o("确认更新")])),_:1})]),_:1})]),default:a(()=>[l(I,{model:f,"label-placement":"left","label-width":"120px"},{default:a(()=>[l(i,{label:"用户UUID",required:""},{default:a(()=>[l(y,{value:f.user_uuid,"onUpdate:value":e[11]||(e[11]=r=>f.user_uuid=r),placeholder:"请输入用户UUID"},null,8,["value"])]),_:1}),l(i,{label:"黑名单类型",required:""},{default:a(()=>[l(n,{value:f.blacklist_type,"onUpdate:value":e[12]||(e[12]=r=>f.blacklist_type=r),options:Object.entries(j).map(([r,S])=>({label:S.label,value:r}))},null,8,["value","options"])]),_:1}),l(i,{label:"重定向URL"},{default:a(()=>[l(y,{value:f.redirect_url,"onUpdate:value":e[13]||(e[13]=r=>f.redirect_url=r),placeholder:"可选，为空时系统将使用默认重定向URL"},null,8,["value"])]),_:1}),l(i,{label:"备注"},{default:a(()=>[l(y,{value:f.notes,"onUpdate:value":e[14]||(e[14]=r=>f.notes=r),type:"textarea",placeholder:"请输入备注信息",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])])}}}),Ne=se(ye,[["__scopeId","data-v-d0bcc52e"]]);export{Ne as default};
