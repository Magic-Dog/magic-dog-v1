import{_ as te,c as oe,a as ne}from"./table-header-operation.vue_vue_type_script_setup_true_lang-e-OyP4HL.js";import{d as $,ai as V,aj as G,$ as l,p as se,r as K,ak as E,o as C,c as O,w as t,f as a,h as e,b as H,I as re,J as pe,b1 as B,bw as M,e as j,ao as z,bx as J,N as W,al as Q,am as ie,an as ue,g as R,t as A,B as L,H as X,x as de,by as me,K as F,ap as P,aq as ge,bz as ce,bA as fe}from"./index-ClXfI4FU.js";import{l as Y,e as Z,f as _e,g as ve}from"./business-B_Lx5lMj.js";import{u as be,a as ye}from"./table-Dvx1bO8G.js";import{u as ee}from"./form-DySsNS_1.js";import{N as ae}from"./DatePicker-DqoFgBzS.js";import{_ as he,a as Te,N as we}from"./DataTable-BPNYEKTe.js";import{_ as De,a as le}from"./FormItem-0Apn8Goa.js";import{_ as ke,a as xe}from"./round-refresh-CZv1uMDH.js";import{u as Ne}from"./auth-BZvMIY-p.js";import{N as Ue}from"./Space-CXAaFBqz.js";import{_ as qe}from"./Grid-CH66uKej.js";import{N as Ce}from"./Popconfirm-CSNmD-NH.js";import"./Pagination-BdniygT7.js";import"./get-slot-Bk_rJcZu.js";const Pe=$({name:"LogOperateDrawer",__name:"log-operate-drawer",props:V({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(v){const D=v,b=G(v,"visible"),{formRef:y,restoreValidation:x}=ee(),h=l("page.manage.log.viewLog"),s=se(m());function m(){return{logType:"1",byUser:"",logDetailType:null,createTime:0,requestPath:"",requestDomain:"",responseCode:"",xRequestId:"",requestParams:"",responseData:"",userAgent:"",processTime:"",ipAddress:""}}const _=K([]);async function q(){const{error:N,data:o}=await J({current:1,size:1e3});if(!N){const u=o.records.map(c=>({label:c.nickName,value:c.id.toString()}));_.value=u}}function k(){Object.assign(s,m()),D.operateType==="edit"&&D.rowData&&Object.assign(s,D.rowData)}return E(b,()=>{b.value&&(k(),x())}),q(),(N,o)=>{const u=Te,c=he,p=De,w=ae,f=W,U=Q,d=le,r=ie,g=ue;return C(),O(g,{show:b.value,"onUpdate:show":o[12]||(o[12]=n=>b.value=n),"display-directive":"show",width:360},{default:t(()=>[a(r,{title:e(h),"native-scrollbar":!1,closable:""},{default:t(()=>[a(d,{ref_key:"formRef",ref:y,model:s},{default:t(()=>[a(p,{label:e(l)("page.manage.log.logType"),path:"logType"},{default:t(()=>[a(c,{value:s.logType,"onUpdate:value":o[0]||(o[0]=n=>s.logType=n)},{default:t(()=>[(C(!0),H(pe,null,re(e(Y),n=>(C(),O(u,{key:n.value,value:n.value,label:e(l)(n.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(p,{label:e(l)("page.manage.log.createTime"),path:"createTime"},{default:t(()=>[a(w,{value:s.createTime,"onUpdate:value":o[1]||(o[1]=n=>s.createTime=n),type:"datetime",placeholder:e(l)("page.manage.log.form.createTime"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(p,{label:e(l)("page.manage.log.xRequestId"),path:"xRequestId"},{default:t(()=>[a(f,{value:s.xRequestId,"onUpdate:value":o[2]||(o[2]=n=>s.xRequestId=n)},null,8,["value"])]),_:1},8,["label"]),B(j("div",null,[a(p,{label:e(l)("page.manage.log.byUser"),path:"byUser",class:"w-65 pr-24px"},{default:t(()=>[a(U,{value:s.byUser,"onUpdate:value":o[3]||(o[3]=n=>s.byUser=n),filterable:"",clearable:"",options:_.value,placeholder:e(l)("page.manage.log.form.byUser")},null,8,["value","options","placeholder"])]),_:1},8,["label"]),a(p,{label:e(l)("page.manage.log.logDetailType"),path:"logDetailType"},{default:t(()=>[a(U,{value:s.logDetailType,"onUpdate:value":o[4]||(o[4]=n=>s.logDetailType=n),placeholder:e(l)("page.manage.log.form.logType"),options:e(z)(e(Z)),filterable:"",clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])],512),[[M,s.logType!=="1"]]),B(j("div",null,[a(p,{label:e(l)("page.manage.log.requestPath"),path:"requestPath"},{default:t(()=>[a(f,{value:s.requestPath,"onUpdate:value":o[5]||(o[5]=n=>s.requestPath=n)},null,8,["value"])]),_:1},8,["label"]),a(p,{label:e(l)("page.manage.log.requestParams"),path:"requestParams"},{default:t(()=>[a(f,{value:s.requestParams,"onUpdate:value":o[6]||(o[6]=n=>s.requestParams=n)},null,8,["value"])]),_:1},8,["label"]),a(p,{label:e(l)("page.manage.log.responseData"),path:"responseData"},{default:t(()=>[a(f,{value:s.responseData,"onUpdate:value":o[7]||(o[7]=n=>s.responseData=n)},null,8,["value"])]),_:1},8,["label"]),a(p,{label:e(l)("page.manage.log.userAgent"),path:"userAgent"},{default:t(()=>[a(f,{value:s.userAgent,"onUpdate:value":o[8]||(o[8]=n=>s.userAgent=n)},null,8,["value"])]),_:1},8,["label"]),a(p,{label:e(l)("page.manage.log.processTime"),path:"processTime"},{default:t(()=>[a(f,{value:s.processTime,"onUpdate:value":o[9]||(o[9]=n=>s.processTime=n)},null,8,["value"])]),_:1},8,["label"]),a(p,{label:e(l)("page.manage.log.ipAddress"),path:"ipAddress"},{default:t(()=>[a(f,{value:s.ipAddress,"onUpdate:value":o[10]||(o[10]=n=>s.ipAddress=n)},null,8,["value"])]),_:1},8,["label"]),a(p,{label:e(l)("page.manage.log.responseCode"),path:"responseCode"},{default:t(()=>[a(f,{value:s.responseCode,"onUpdate:value":o[11]||(o[11]=n=>s.responseCode=n),placeholder:e(l)("page.manage.log.form.responseCode")},null,8,["value","placeholder"])]),_:1},8,["label"])],512),[[M,s.logType==="1"]])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Re=$({name:"LogSearch",__name:"log-search",props:{model:{required:!0},modelModifiers:{}},emits:V(["reset","search"],["update:model"]),setup(v,{emit:D}){const b=D,{hasAuth:y}=Ne(),{formRef:x,validate:h,restoreValidation:s}=ee(),m=G(v,"model"),_=K([]);async function q(){const{error:o,data:u}=await J({current:1,size:1e3});if(!o){const c=u.records.map(p=>({label:p.nickName,value:p.id.toString()}));_.value=c}}async function k(){await s(),b("reset")}async function N(){await h(),b("search")}return q(),(o,u)=>{const c=Q,p=te,w=W,f=ae,U=ke,d=L,r=xe,g=Ue,n=qe,T=le,S=X;return C(),O(S,{title:e(l)("common.search"),bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[a(T,{ref_key:"formRef",ref:x,model:m.value,"label-placement":"left","label-width":100},{default:t(()=>[a(n,{responsive:"screen","item-responsive":""},{default:t(()=>[B(a(p,{span:"24 s:12 m:6",label:e(l)("page.manage.log.logType"),path:"logType",class:"pr-24px"},{default:t(()=>[a(c,{value:m.value.logType,"onUpdate:value":u[0]||(u[0]=i=>m.value.logType=i),placeholder:e(l)("page.manage.log.form.logType"),options:e(z)(e(Y)),filterable:"",clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),[[M,e(y)("B_Add_Del_Batch-del")]]),a(p,{span:"24 s:12 m:6",label:e(l)("page.manage.log.byUser"),path:"byUser",class:"pr-24px"},{default:t(()=>[a(c,{value:m.value.byUser,"onUpdate:value":u[1]||(u[1]=i=>m.value.byUser=i),filterable:"",clearable:"",options:_.value,placeholder:e(l)("page.manage.log.form.byUser")},null,8,["value","options","placeholder"])]),_:1},8,["label"]),a(p,{span:"24 s:12 m:6",label:e(l)("page.manage.log.logDetailType"),path:"logDetailType",class:"pr-24px"},{default:t(()=>[a(c,{value:m.value.logDetailType,"onUpdate:value":u[2]||(u[2]=i=>m.value.logDetailType=i),placeholder:e(l)("page.manage.log.form.logType"),options:e(z)(e(Z)),filterable:"",clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(p,{span:"24 s:12 m:6",label:e(l)("page.manage.log.requestPath"),path:"requestPath",class:"pr-24px"},{default:t(()=>[a(w,{value:m.value.requestPath,"onUpdate:value":u[3]||(u[3]=i=>m.value.requestPath=i),placeholder:e(l)("page.manage.log.form.requestPath")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(p,{span:"24 s:12 m:9",label:e(l)("page.manage.log.createTime"),path:"createTime",class:"pr-24px"},{default:t(()=>[a(f,{value:m.value.timeRange,"onUpdate:value":u[4]||(u[4]=i=>m.value.timeRange=i),type:"datetimerange",clearable:"",class:"createTime",placement:"top-end"},null,8,["value"])]),_:1},8,["label"]),a(p,{span:"24 s:12 m:6",label:e(l)("page.manage.log.responseCode"),path:"responseCode",class:"pr-24px"},{default:t(()=>[a(w,{value:m.value.responseCode,"onUpdate:value":u[5]||(u[5]=i=>m.value.responseCode=i),placeholder:e(l)("page.manage.log.form.responseCode")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(p,{span:"24 s:12 m:6",label:e(l)("page.manage.log.xRequestId"),path:"xRequestId",class:"pr-24px"},{default:t(()=>[a(w,{value:m.value.xRequestId,"onUpdate:value":u[6]||(u[6]=i=>m.value.xRequestId=i)},null,8,["value"])]),_:1},8,["label"]),a(p,{span:"24 m:9",class:"pr-24px"},{default:t(()=>[a(g,{class:"w-full",justify:"end"},{default:t(()=>[a(d,{onClick:k},{icon:t(()=>[a(U,{class:"text-icon"})]),default:t(()=>[R(" "+A(e(l)("common.reset")),1)]),_:1}),a(d,{type:"primary",ghost:"",onClick:N},{icon:t(()=>[a(r,{class:"text-icon"})]),default:t(()=>[R(" "+A(e(l)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])}}}),Ae={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function I(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!ge(v)}const Je=$({name:"manage_log",__name:"index",setup(v){const D=de(),{columns:b,columnChecks:y,data:x,getData:h,loading:s,mobilePagination:m,searchParams:_,resetSearchParams:q}=be({apiFn:me,showTotal:!0,apiParams:{current:1,size:10,logType:"2",byUser:null,logDetailType:null,requestPath:null,timeRange:[new Date().setHours(0,0,0,0),new Date().setHours(23,59,59,0)],responseCode:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:l("common.index"),align:"center",width:64},{key:"requestDomain",title:l("page.manage.log.requestDomain"),align:"center",width:300},{key:"requestPath",title:l("page.manage.log.requestPath"),align:"center",width:300},{key:"byUserInfo.nickName",title:l("page.manage.log.byUser"),align:"center",width:100},{key:"logDetailType",title:l("page.manage.log.logDetailType"),align:"center",minWidth:50,render:d=>{if(d.logDetailType){const r=l(_e[d.logDetailType]);return a(F,{type:"default"},I(r)?r:{default:()=>[r]})}return null}},{key:"logType",title:l("page.manage.log.logType"),align:"center",width:100,render:d=>{const r={1:"default",2:"error",3:"primary",4:"info"},g=l(ve[d.logType]);return a(F,{type:r[d.logType]},I(g)?g:{default:()=>[g]})}},{key:"fmtCreateTime",title:l("page.manage.log.createTime"),align:"center",width:200},{key:"responseCode",title:l("page.manage.log.responseCode"),align:"center",width:100},{key:"operate",title:l("common.operate"),align:"center",width:130,render:d=>{let r;return a("div",{class:"flex-center gap-8px"},[a(L,{type:"primary",ghost:!0,size:"small",onClick:()=>U(d.id)},I(r=l("common.view"))?r:{default:()=>[r]})])}}]}),{drawerVisible:k,operateType:N,checkedRowKeys:o,onBatchDeleted:u,editingData:c,handleEdit:p}=ye(x,h);async function w(){var r;const{error:d}=await ce();d||((r=window.$message)==null||r.success(l("common.deleteSuccess")),await h())}async function f(){const{error:d}=await fe({ids:o.value});d||u()}function U(d){p(d)}return E(()=>_.logType,d=>{const r=["requestDomain","requestPath"];let g;d!=="1"?g=!1:g=!0,y.value.forEach(T=>{r.includes(T.key)&&(T.checked=g)});const n=["byUserInfo.nickName","logDetailType"];d==="1"?g=!1:g=!0,y.value.forEach(T=>{n.includes(T.key)&&(T.checked=g)})},{immediate:!0}),(d,r)=>{const g=oe,n=ne,T=we,S=X;return C(),H("div",Ae,[a(Re,{model:e(_),"onUpdate:model":r[0]||(r[0]=i=>P(_)?_.value=i:null),onReset:e(q),onSearch:e(h)},null,8,["model","onReset","onSearch"]),a(S,{title:e(l)("page.manage.log.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[a(n,{columns:e(y),"onUpdate:columns":r[1]||(r[1]=i=>P(y)?y.value=i:null),"disabled-delete":e(o).length===0,loading:e(s),"table-id":"log",onAdd:w,onDelete:f,onRefresh:e(h)},{default:t(()=>[a(e(Ce),{onPositiveClick:w},{trigger:t(()=>[a(e(L),{size:"small",ghost:"",type:"error"},{icon:t(()=>[a(g,{class:"text-icon"})]),default:t(()=>[R(" "+A(e(l)("page.manage.log.deleteAll")),1)]),_:1})]),default:t(()=>[R(" "+A(e(l)("page.manage.log.confirmDeleteAll")),1)]),_:1})]),_:1},8,["columns","disabled-delete","loading","onRefresh"])]),default:t(()=>[a(T,{"checked-row-keys":e(o),"onUpdate:checkedRowKeys":r[2]||(r[2]=i=>P(o)?o.value=i:null),columns:e(b),data:e(x),size:"small","flex-height":!e(D).isMobile,"scroll-x":962,loading:e(s),remote:"","row-key":i=>i.id,pagination:e(m),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(Pe,{visible:e(k),"onUpdate:visible":r[3]||(r[3]=i=>P(k)?k.value=i:null),"operate-type":e(N),"row-data":e(c),onSubmitted:e(h)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{Je as default};
