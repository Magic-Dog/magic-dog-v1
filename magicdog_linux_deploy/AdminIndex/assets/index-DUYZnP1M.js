import{_ as re,a as ue}from"./table-header-operation.vue_vue_type_script_setup_true_lang-CiPrrw16.js";import{d as q,ai as j,aj as H,a as J,$ as l,p as pe,r as F,ak as ie,o as S,c as M,w as t,f as a,g as z,t as $,h as e,b as I,I as V,J as A,bO as Q,ci as me,cj as de,N as X,al as Y,B as L,bT as ce,ao as K,H as Z,x as fe,ap as O,bx as ge,K as W,ck as _e,cl as ve,aq as be}from"./index-BQSxQzVO.js";import{u as ee,s as ae,a as he,b as ye}from"./business-BbH9a7Zw.js";import{u as Ne,a as we}from"./table-w9EXwZGW.js";import{u as le,a as te}from"./form-DJEUg3NP.js";import{_ as ke,a as se}from"./FormItem-Ddsiq6Pr.js";import{_ as Te,a as Ue,N as Re}from"./DataTable-BTKI-G85.js";import{N as ne}from"./Space-Bg__R6dn.js";import{_ as xe,a as Se}from"./round-refresh-DfX8EReU.js";import{_ as Ge}from"./Grid-gDLBcKFD.js";import{_ as Ce,a as De}from"./CollapseItem-DqarcKfC.js";import{N as Pe}from"./Popconfirm-OV6lVfnz.js";import"./get-slot-Bk_rJcZu.js";import"./Pagination-DvoOntIf.js";const Ee=q({name:"UserOperateDrawer",__name:"user-operate-drawer",props:j({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:j(["submitted"],["update:visible"]),setup(k,{emit:D}){const _=k,R=D,N=H(k,"visible"),{formRef:G,validate:i,restoreValidation:C}=le(),{defaultRequiredRule:T}=te(),x=J(()=>({add:l("page.manage.user.addUser"),edit:l("page.manage.user.editUser")})[_.operateType]),s=pe(U());function U(){return{userName:"",password:"",userGender:"3",nickName:"",userPhone:"",userEmail:"",byUserRoleCodeList:["R_USER"],statusType:"1"}}const b=F({userName:T,password:T,nickName:T,statusType:T}),p=F([]);async function w(){const{error:h,data:n}=await Q({size:1e3,statusType:"1"});if(!h){const f=n.records.map(g=>({label:g.roleName,value:g.roleCode}));p.value=f}}function c(){Object.assign(s,U()),_.operateType==="edit"&&_.rowData&&(console.log("props.rowData",_.rowData),Object.assign(s,_.rowData)),_.operateType==="add"?b.value.password.required=!0:_.operateType==="edit"&&(b.value.password.required=!1)}function v(){N.value=!1}async function P(){var h,n;if(await i(),_.operateType==="add"){const{error:f}=await me(s);f||(h=window.$message)==null||h.success(l("common.addSuccess"))}else if(_.operateType==="edit"){console.log(s);const{error:f}=await de(s);f||(n=window.$message)==null||n.success(l("common.updateSuccess"))}v(),R("submitted")}return ie(N,()=>{N.value&&(c(),C(),w())}),(h,n)=>{const f=X,g=ke,u=Ue,r=Te,d=Y,E=se,m=L,y=ne,oe=ce;return S(),M(oe,{show:N.value,"onUpdate:show":n[8]||(n[8]=o=>N.value=o),preset:"dialog",title:x.value},{action:t(()=>[a(y,{size:16},{default:t(()=>[a(m,{onClick:v},{default:t(()=>[z($(e(l)("common.cancel")),1)]),_:1}),a(m,{type:"primary",onClick:P},{default:t(()=>[z($(e(l)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[a(E,{ref_key:"formRef",ref:G,model:s,rules:b.value,"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging",size:"medium",class:"max-w-150"},{default:t(()=>[a(g,{label:e(l)("page.manage.user.userName"),path:"userName"},{default:t(()=>[a(f,{value:s.userName,"onUpdate:value":n[0]||(n[0]=o=>s.userName=o),placeholder:e(l)("page.manage.user.form.userName"),"on-update-value":o=>{s.nickName=o}},null,8,["value","placeholder","on-update-value"])]),_:1},8,["label"]),a(g,{label:e(l)("page.manage.user.password"),path:"password"},{default:t(()=>[a(f,{value:s.password,"onUpdate:value":n[1]||(n[1]=o=>s.password=o),placeholder:e(l)("page.manage.user.form.password")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(g,{label:e(l)("page.manage.user.userGender"),path:"userGender"},{default:t(()=>[a(r,{value:s.userGender,"onUpdate:value":n[2]||(n[2]=o=>s.userGender=o)},{default:t(()=>[(S(!0),I(A,null,V(e(ee),o=>(S(),M(u,{key:o.value,value:o.value,label:e(l)(o.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(g,{label:e(l)("page.manage.user.nickName"),path:"nickName"},{default:t(()=>[a(f,{value:s.nickName,"onUpdate:value":n[3]||(n[3]=o=>s.nickName=o),placeholder:e(l)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(g,{label:e(l)("page.manage.user.userPhone"),path:"userPhone"},{default:t(()=>[a(f,{value:s.userPhone,"onUpdate:value":n[4]||(n[4]=o=>s.userPhone=o),placeholder:e(l)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(g,{label:e(l)("page.manage.user.userEmail"),path:"email"},{default:t(()=>[a(f,{value:s.userEmail,"onUpdate:value":n[5]||(n[5]=o=>s.userEmail=o),placeholder:e(l)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(g,{label:e(l)("page.manage.user.userRole"),path:"roles"},{default:t(()=>[a(d,{value:s.byUserRoleCodeList,"onUpdate:value":n[6]||(n[6]=o=>s.byUserRoleCodeList=o),multiple:"",filterable:"",clearable:"",options:p.value,placeholder:e(l)("page.manage.user.form.userRole")},null,8,["value","options","placeholder"])]),_:1},8,["label"]),a(g,{label:e(l)("page.manage.user.userStatusType"),path:"status"},{default:t(()=>[a(r,{value:s.statusType,"onUpdate:value":n[7]||(n[7]=o=>s.statusType=o)},{default:t(()=>[(S(!0),I(A,null,V(e(ae),o=>(S(),M(u,{key:o.value,value:o.value,label:e(l)(o.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["show","title"])}}}),Oe=q({name:"UserSearch",__name:"user-search",props:{model:{required:!0},modelModifiers:{}},emits:j(["reset","search"],["update:model"]),setup(k,{emit:D}){const _=D,{formRef:R,validate:N,restoreValidation:G}=le(),i=H(k,"model"),C=J(()=>{const{patternRules:b}=te();return{userEmail:b.email,userPhone:b.phone}}),T=F([]);async function x(){const{error:b,data:p}=await Q({size:1e3,statusType:"1"});if(!b){const w=p.records.map(c=>({label:c.roleName,value:c.roleCode}));T.value=w}}async function s(){await G(),_("reset")}async function U(){await N(),_("search")}return x(),(b,p)=>{const w=X,c=re,v=Y,P=xe,h=L,n=Se,f=ne,g=Ge,u=se,r=Ce,d=De,E=Z;return S(),M(E,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[a(d,null,{default:t(()=>[a(r,{title:e(l)("common.search"),name:"user-search"},{default:t(()=>[a(u,{ref_key:"formRef",ref:R,model:i.value,rules:C.value,"label-placement":"left","label-width":80},{default:t(()=>[a(g,{responsive:"screen","item-responsive":""},{default:t(()=>[a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userName"),path:"userName",class:"pr-24px"},{default:t(()=>[a(w,{value:i.value.userName,"onUpdate:value":p[0]||(p[0]=m=>i.value.userName=m),placeholder:e(l)("page.manage.user.form.userName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userGender"),path:"userGender",class:"pr-24px"},{default:t(()=>[a(v,{value:i.value.userGender,"onUpdate:value":p[1]||(p[1]=m=>i.value.userGender=m),placeholder:e(l)("page.manage.user.form.userGender"),options:e(K)(e(ee)),filterable:"",clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.nickName"),path:"nickName",class:"pr-24px"},{default:t(()=>[a(w,{value:i.value.nickName,"onUpdate:value":p[2]||(p[2]=m=>i.value.nickName=m),placeholder:e(l)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userPhone"),path:"userPhone",class:"pr-24px"},{default:t(()=>[a(w,{value:i.value.userPhone,"onUpdate:value":p[3]||(p[3]=m=>i.value.userPhone=m),placeholder:e(l)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userEmail"),path:"userEmail",class:"pr-24px"},{default:t(()=>[a(w,{value:i.value.userEmail,"onUpdate:value":p[4]||(p[4]=m=>i.value.userEmail=m),placeholder:e(l)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userStatusType"),path:"userStatusType",class:"pr-24px"},{default:t(()=>[a(v,{value:i.value.statusType,"onUpdate:value":p[5]||(p[5]=m=>i.value.statusType=m),placeholder:e(l)("page.manage.user.form.userStatusType"),options:e(K)(e(ae)),filterable:"",clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userRole"),path:"roles",class:"pr-24px"},{default:t(()=>[a(v,{value:i.value.byUserRoleCodeList,"onUpdate:value":p[6]||(p[6]=m=>i.value.byUserRoleCodeList=m),options:T.value,placeholder:e(l)("page.manage.user.form.userRole"),filterable:"",clearable:""},null,8,["value","options","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 m:6",class:"pr-24px"},{default:t(()=>[a(f,{class:"w-full",justify:"end"},{default:t(()=>[a(h,{onClick:s},{icon:t(()=>[a(P,{class:"text-icon"})]),default:t(()=>[z(" "+$(e(l)("common.reset")),1)]),_:1}),a(h,{type:"primary",ghost:"",onClick:U},{icon:t(()=>[a(n,{class:"text-icon"})]),default:t(()=>[z(" "+$(e(l)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),Be={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function B(k){return typeof k=="function"||Object.prototype.toString.call(k)==="[object Object]"&&!be(k)}const Qe=q({name:"manage_user",__name:"index",setup(k){const D=fe(),{columns:_,columnChecks:R,data:N,getData:G,getDataByPage:i,loading:C,mobilePagination:T,searchParams:x,resetSearchParams:s}=Ne({apiFn:ge,showTotal:!0,apiParams:{current:1,size:10,userName:null,password:null,userGender:null,nickName:null,userPhone:null,userEmail:null,byUserRoleCodeList:null,statusType:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:l("common.index"),align:"center",width:64},{key:"userName",title:l("page.manage.user.userName"),align:"center",minWidth:100},{key:"userGender",title:l("page.manage.user.userGender"),align:"center",width:100,render:u=>{if(u.userGender===null)return null;const r={1:"primary",2:"error",3:"info"},d=l(he[u.userGender]);return a(W,{type:r[u.userGender]},B(d)?d:{default:()=>[d]})}},{key:"nickName",title:l("page.manage.user.nickName"),align:"center",minWidth:100},{key:"userPhone",title:l("page.manage.user.userPhone"),align:"center",width:120},{key:"userEmail",title:l("page.manage.user.userEmail"),align:"center",minWidth:200},{key:"statusType",title:l("page.manage.user.userStatusType"),align:"center",width:100,render:u=>{if(u.statusType===null)return null;const r={1:"success",2:"warning"},d=l(ye[u.statusType]);return a(W,{type:r[u.statusType]},B(d)?d:{default:()=>[d]})}},{key:"operate",title:l("common.operate"),align:"center",width:130,render:u=>{let r;return a("div",{class:"flex-center gap-8px"},[a(L,{type:"primary",ghost:!0,size:"small",onClick:()=>g(u.id)},B(r=l("common.edit"))?r:{default:()=>[r]}),a(Pe,{onPositiveClick:()=>f(u.id)},{default:()=>l("common.confirmDelete"),trigger:()=>{let d;return a(L,{type:"error",ghost:!0,size:"small"},B(d=l("common.delete"))?d:{default:()=>[d]})}})])}}]}),{drawerVisible:U,operateType:b,editingData:p,handleAdd:w,handleEdit:c,checkedRowKeys:v,onBatchDeleted:P,onDeleted:h}=we(N,G);async function n(){const{error:u}=await _e({ids:v.value});u||P()}async function f(u){const{error:r}=await ve({id:u});r||h()}function g(u){c(u)}return(u,r)=>{const d=ue,E=Re,m=Z;return S(),I("div",Be,[a(Oe,{model:e(x),"onUpdate:model":r[0]||(r[0]=y=>O(x)?x.value=y:null),onReset:e(s),onSearch:e(i)},null,8,["model","onReset","onSearch"]),a(m,{title:e(l)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[a(d,{columns:e(R),"onUpdate:columns":r[1]||(r[1]=y=>O(R)?R.value=y:null),"disabled-delete":e(v).length===0,loading:e(C),"table-id":"user",onAdd:e(w),onDelete:n,onRefresh:e(G)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:t(()=>[a(E,{"checked-row-keys":e(v),"onUpdate:checkedRowKeys":r[2]||(r[2]=y=>O(v)?v.value=y:null),columns:e(_),data:e(N),size:"small","flex-height":!e(D).isMobile,"scroll-x":962,loading:e(C),remote:"","row-key":y=>y.id,pagination:e(T),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(Ee,{visible:e(U),"onUpdate:visible":r[3]||(r[3]=y=>O(U)?U.value=y:null),"operate-type":e(b),"row-data":e(p),onSubmitted:e(i)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{Qe as default};
