import{d as B,v as S,r as o,a as T,i as z,o as g,b as v,e,f as y,w as k,h as b,N as C,B as D,g as L,cu as V,t as c,ae as p,H,dK as F,dL as U,cy as E}from"./index-_Jo3eeBk.js";const K={class:"min-h-500px bg-gray-50 p-6 dark:bg-gray-900"},M={class:"mx-auto max-w-4xl"},P={class:"grid grid-cols-1 gap-6 lg:grid-cols-1"},j={class:"space-y-6"},q={class:"flex gap-3"},G={key:0,class:"border border-gray-200 rounded-lg bg-gray-50 p-4 dark:border-gray-700 dark:bg-[rgb(31,41,55)]"},J={class:"mb-2 flex items-center"},O={class:"text-sm text-gray-900 dark:text-gray-100"},Q={key:0,class:"text-xs text-gray-600 dark:text-gray-400"},R={key:1,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},W={key:2,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},X=B({name:"system-auth",__name:"index",setup(Y){const{startLoading:$,endLoading:I}=S(),d=o(""),u=o(""),m=o(!1),r=o(""),f=o(0),h=o(0),w=o(""),x=o(""),N=T(()=>{switch(r.value){case"active":return"系统授权有效";case"unbound":return"设备未绑定授权码";case"expired":return"系统授权已过期";case"inactive":return"系统授权无效";default:return"未知状态"}});async function _(){var n,t,l,i,s;$();try{const{data:a}=await F();a?(d.value=a.expireTime||"未设置",r.value=a.status||"unbound",f.value=a.remainingDays||0,h.value=a.remainingHours||0,w.value=a.deviceId||"",x.value=a.licenseCode||"",a.status==="active"?(n=window.$message)==null||n.success("授权信息加载成功"):a.status==="unbound"?(t=window.$message)==null||t.info("设备未绑定授权码"):a.status==="expired"?(l=window.$message)==null||l.warning("系统授权已过期"):a.status==="inactive"&&((i=window.$message)==null||i.error("系统授权无效"))):(d.value="未授权",r.value="unbound")}catch(a){console.error("Failed to fetch auth info:",a),(s=window.$message)==null||s.error("获取授权信息失败"),d.value="获取失败",r.value="unbound"}finally{I()}}async function A(){var n,t,l,i;if(!u.value.trim()){(n=window.$message)==null||n.warning("请输入授权码");return}m.value=!0;try{const{data:s}=await U({authCode:u.value});s&&s.success?(d.value=s.expireTime,r.value="active",u.value="",(t=window.$message)==null||t.success(s.message||"授权激活成功"),await _()):(l=window.$message)==null||l.error((s==null?void 0:s.message)||"授权码无效或已过期")}catch(s){console.error("Failed to submit auth code:",s),(i=window.$message)==null||i.error("授权激活失败，请检查授权码是否正确")}finally{m.value=!1}}return z(()=>{_()}),(n,t)=>(g(),v("div",K,[e("div",M,[t[10]||(t[10]=e("div",{class:"mb-6"},[e("h1",{class:"mb-2 text-2xl text-gray-900 font-bold dark:text-gray-100"},"系统授权"),e("p",{class:"text-gray-600 dark:text-gray-400"},"管理系统授权码和查看授权状态")],-1)),e("div",P,[y(b(H),{class:"border-0 shadow-sm transition-shadow hover:shadow-md"},{header:k(()=>t[2]||(t[2]=[e("div",{class:"flex items-center"},[e("div",{class:"mr-3 h-8 w-2 rounded-full bg-green-500"}),e("div",null,[e("h3",{class:"text-lg text-gray-900 font-semibold dark:text-gray-100"},"系统授权管理"),e("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"输入授权码激活系统或查看当前授权状态")])],-1)])),default:k(()=>[e("div",j,[e("div",null,[t[3]||(t[3]=e("label",{class:"mb-2 block text-sm text-gray-700 font-medium dark:text-gray-300"},"当前授权到期时间",-1)),y(b(C),{value:d.value,"onUpdate:value":t[0]||(t[0]=l=>d.value=l),placeholder:"未授权",size:"large",disabled:"",readonly:""},null,8,["value"]),t[4]||(t[4]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"显示当前系统的授权到期时间",-1))]),e("div",null,[t[6]||(t[6]=e("label",{class:"mb-2 block text-sm text-gray-700 font-medium dark:text-gray-300"},"授权码",-1)),e("div",q,[y(b(C),{value:u.value,"onUpdate:value":t[1]||(t[1]=l=>u.value=l),placeholder:"请输入授权码",size:"large",type:"password","show-password-on":"click",style:{flex:"1"},loading:m.value},null,8,["value","loading"]),y(b(D),{type:"primary",size:"large",loading:m.value,onClick:A},{default:k(()=>t[5]||(t[5]=[L("激活授权")])),_:1},8,["loading"])]),t[7]||(t[7]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"输入有效的授权码来激活或延长系统授权",-1))]),t[9]||(t[9]=e("div",{class:"border border-blue-200 rounded-lg bg-blue-50 p-4 dark:border-gray-700 dark:bg-[rgb(31,41,55)]"},[e("h4",{class:"mb-3 text-sm text-blue-800 font-medium dark:text-blue-400"},"授权说明"),e("div",{class:"text-xs text-blue-700 space-y-2 dark:text-gray-300"},[e("p",null,"• 如果授权码提示无效，则说明激活码已过期"),e("p",null,"• 如果短时间多次激活，该IP以及授权码将被列入黑名单"),e("p",null,"• 如果当前授权码还未到期，但是用新授权码激活了，那么之前的到期时间会累加到新授权码上面"),e("p",null,"• 如果当前授权码在其他服务器上使用后，那么当前服务器将失效"),e("p",null,"• 在成功使用授权码后，同一授权码在30分钟内不能再次被使用")])],-1)),r.value?(g(),v("div",G,[t[8]||(t[8]=e("h4",{class:"mb-2 text-sm text-gray-700 font-medium dark:text-gray-300"},"授权状态",-1)),e("div",J,[e("div",{class:V(["mr-2 h-3 w-3 rounded-full",{"bg-green-500":r.value==="active","bg-red-500":r.value==="expired","bg-orange-500":r.value==="inactive","bg-gray-500":r.value==="unbound"}])},null,2),e("span",O,c(N.value),1)]),r.value==="active"&&f.value>0?(g(),v("div",Q," 剩余时间："+c(f.value)+"天 "+c(h.value)+"小时 ",1)):p("",!0),w.value?(g(),v("div",R,"设备ID："+c(w.value),1)):p("",!0),x.value&&x.value!=="****"?(g(),v("div",W," 授权码："+c(x.value),1)):p("",!0)])):p("",!0)])]),_:1})])])]))}}),ee=E(X,[["__scopeId","data-v-42820d30"]]);export{ee as default};
