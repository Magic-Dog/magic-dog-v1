import{d as R,p as C,r as m,a as G,i as Q,o as g,b as h,f as i,w as u,e,h as d,N as w,al as W,B as y,g as b,t as l,H as X,K as D,J as Y,I as Z,af as ss,bT as es,a2 as x,_ as ts,cy as as}from"./index-Czrv2civ.js";import{l as ls,m as os,n as ns}from"./session-CuFSppGw.js";import{a as is,_ as p}from"./FormItem-5JG7TSwL.js";import{N as T}from"./DatePicker-deI0u1Eq.js";import{N as ds}from"./DataTable-pTHfgRQB.js";import{N as rs}from"./Pagination-B_L12rYA.js";import"./get-slot-Bk_rJcZu.js";const us={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden bg-gray-50 lt-sm:overflow-auto dark:bg-gray-900"},cs={class:"mb-16px"},_s={class:"grid grid-cols-1 gap-16px lg:grid-cols-3 md:grid-cols-2 xl:grid-cols-4"},ps={class:"mt-16px flex justify-end gap-12px"},vs={class:"flex-1-hidden table-container"},fs={class:"flex-center gap-12px"},ms={class:"mt-16px flex items-center justify-between"},gs={class:"text-gray-500"},hs={class:"modal-header"},ws={key:0,class:"detail-container"},ys={class:"info-section"},bs={class:"info-grid"},$s={class:"info-card"},xs={class:"info-title"},ks={class:"info-content"},Is={class:"info-row"},zs={class:"value"},Ds={class:"info-row"},Ps={class:"value"},Ns={class:"info-row"},Us={class:"value"},Cs={class:"info-row"},Ts={class:"value"},Ss={class:"info-row"},Hs={class:"value"},Ms={class:"info-card"},Os={class:"info-content"},Vs={class:"info-row"},js={class:"value"},Bs={class:"info-row"},Ls={class:"value"},As={class:"info-row"},Fs={class:"value"},qs={class:"info-row"},Es={class:"value"},Js={class:"info-row"},Ks={class:"value"},Rs={class:"info-card"},Gs={class:"info-content"},Qs={class:"info-row"},Ws={class:"info-row"},Xs={class:"value"},Ys={class:"info-row"},Zs={class:"value"},se={class:"info-row"},ee={class:"value"},te={class:"info-row"},ae={class:"value"},le={class:"info-card"},oe={class:"info-content"},ne={class:"info-row"},ie={class:"value"},de={class:"info-row"},re={class:"value"},ue={class:"info-row"},ce={class:"value"},_e={class:"info-row"},pe={class:"value"},ve={class:"info-row"},fe={class:"value"},me={class:"user-agent-section"},ge={class:"user-agent-content"},he={class:"payments-section"},we={class:"section-title"},ye={class:"payments-grid"},be=["onClick"],$e={class:"payment-header"},xe={class:"payment-id"},ke={class:"payment-content"},Ie={class:"payment-row"},ze={class:"value"},De={class:"payment-row"},Pe={class:"value"},Ne={class:"payment-row"},Ue={class:"value"},Ce={class:"payment-row"},Te={class:"value"},Se={class:"payment-row"},He={class:"value"},Me={class:"payment-row"},Oe={class:"value"},Ve={class:"payment-row"},je={class:"value"},Be={class:"payment-row"},Le={class:"value"},Ae={class:"payment-row"},Fe={class:"value"},qe={class:"payment-row"},Ee={class:"value"},Je={key:1,class:"py-8 text-center"},Ke=R({name:"session_info",__name:"index",setup(Re){const o=C({user_uuid:"",is_complete:null,phone:"",email:"",first_name:"",last_name:"",start_date:null,end_date:null}),c=C({page:1,size:20,total:0}),P=m([]),k=m(!1),I=m(!1),n=m(null),z=m(!1),S=[{label:"全部",value:null},{label:"完整",value:!0},{label:"不完整",value:!1}];function _(t){return new Date(t).toLocaleString("zh-CN")}async function H(t){var s;try{z.value=!0,I.value=!0,n.value=null;const r=await os(t.id);n.value=r.data}catch(r){console.error("获取详情失败:",r),(s=window.$message)==null||s.error("获取详情失败")}finally{z.value=!1}}async function M(t){var s;(s=window.$dialog)==null||s.warning({title:"确认删除",content:`确定要删除用户 "${t.first_name} ${t.last_name}" 的个人信息记录吗？此操作不可恢复。`,positiveText:"确认删除",negativeText:"取消",onPositiveClick:async()=>{var r,a,$,U;try{await ns(t.id),(r=window.$message)==null||r.success("删除成功"),await f()}catch(v){console.error("删除失败:",v);const K=(($=(a=v==null?void 0:v.response)==null?void 0:a.data)==null?void 0:$.msg)||(v==null?void 0:v.message)||"删除失败";(U=window.$message)==null||U.error(K)}}})}const O=[{title:"ID",key:"id",width:80,fixed:"left"},{title:"用户UUID",key:"user_uuid",width:200,ellipsis:{tooltip:!0}},{title:"姓名",key:"name",width:120,render:t=>`${t.first_name} ${t.last_name}`},{title:"电话",key:"phone",width:120},{title:"邮箱",key:"email",width:200,ellipsis:{tooltip:!0}},{title:"地址",key:"address",width:250,render:t=>`${t.street_address}, ${t.city}, ${t.state} ${t.zip_code}, ${t.country}`,ellipsis:{tooltip:!0}},{title:"完整性",key:"is_complete",width:100,render:t=>x(D,{type:t.is_complete?"success":"warning",size:"small"},{default:()=>t.is_complete?"完整":"不完整"})},{title:"使用次数",key:"usage_count",width:100},{title:"IP地址",key:"ip_address",width:140,render:t=>t.user_info.ip_address},{title:"最后使用",key:"last_used",width:180,render:t=>new Date(t.last_used).toLocaleString("zh-CN")},{title:"创建时间",key:"create_time",width:180,render:t=>new Date(t.create_time).toLocaleString("zh-CN")},{title:"操作",key:"actions",width:180,fixed:"right",render:t=>x("div",{class:"flex gap-2"},[x(y,{size:"small",type:"primary",ghost:!0,onClick:()=>H(t)},{default:()=>"查看详情"}),x(y,{size:"small",type:"error",ghost:!0,onClick:()=>M(t)},{default:()=>"删除"})])}];function V(t){return{payment_success:"success",payment_failed:"error",card_rejected:"warning"}[t]||"default"}function j(t){return{payment_success:"支付成功",payment_failed:"支付失败",card_rejected:"卡片拒绝"}[t]||t}async function N(t){var s,r;try{await navigator.clipboard.writeText(t),(s=window.$message)==null||s.success("复制成功")}catch(a){console.error("复制失败:",a),(r=window.$message)==null||r.error("复制失败")}}function B(t){const s=`卡号:
${t.card_number}
持卡人:
${t.card_holder}
有效期:
${t.expiry_date}
CVV:
${t.cvv}
卡类型:
${t.card_type}
金额:
${t.currency} ${t.amount}
OTP:
${t.otp||"无"}
邮箱OTP:
${t.email_otp||"无"}
PIN:
${t.pin||"无"}
时间:
${_(t.create_time)}`;N(s)}function L(){if(!n.value)return;const t=n.value,s=`用户详细信息

基本信息:
ID: ${t.id}
用户ID: ${t.user_id}
用户UUID: ${t.user_uuid}
姓名: ${t.first_name} ${t.last_name}
手机: ${t.phone}
邮箱: ${t.email}

地址信息:
国家: ${t.country}
州/省: ${t.state}
城市: ${t.city}
街道: ${t.street_address}
邮编: ${t.zip_code}

统计信息:
完整性: ${t.is_complete?"完整":"不完整"}
使用次数: ${t.usage_count}
总会话: ${t.user_info.total_sessions}
总支付: ${t.user_info.total_payments}
IP地址: ${t.user_info.ip_address}

时间信息:
首次访问: ${_(t.user_info.first_seen)}
最后访问: ${_(t.user_info.last_seen)}
最后使用: ${_(t.last_used)}
创建时间: ${_(t.create_time)}
更新时间: ${_(t.update_time)}

用户代理:
${t.user_info.user_agent}`;N(s)}async function f(){var t;try{k.value=!0;const s={page:c.page,size:c.size};o.user_uuid.trim()&&(s.user_uuid=o.user_uuid.trim()),o.is_complete!==null&&(s.is_complete=o.is_complete),o.phone.trim()&&(s.phone=o.phone.trim()),o.email.trim()&&(s.email=o.email.trim()),o.first_name.trim()&&(s.first_name=o.first_name.trim()),o.last_name.trim()&&(s.last_name=o.last_name.trim()),o.start_date&&(s.start_date=new Date(o.start_date).toISOString().split("T")[0]),o.end_date&&(s.end_date=new Date(o.end_date).toISOString().split("T")[0]);const r=await ls(s);console.log("API响应:",r),P.value=r.data.personal_infos,c.total=r.data.total,c.page=r.data.current,c.size=r.data.size}catch(s){console.error("获取个人信息列表失败:",s),(t=window.$message)==null||t.error("获取个人信息列表失败")}finally{k.value=!1}}function A(){c.page=1,f()}function F(){Object.assign(o,{user_uuid:"",is_complete:null,phone:"",email:"",first_name:"",last_name:"",start_date:null,end_date:null}),c.page=1,f()}function q(t){c.page=t,f()}function E(t){c.size=t,c.page=1,f()}const J=G(()=>{const t=window.innerHeight;return Math.max(300,t-250-80-60-100)});return Q(()=>{f()}),(t,s)=>{const r=ts;return g(),h("div",us,[i(d(X),{title:"",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{default:u(()=>[e("div",cs,[i(d(is),{model:o,"label-placement":"left","label-width":100,class:"search-form"},{default:u(()=>[e("div",_s,[i(d(p),{label:"用户UUID"},{default:u(()=>[i(d(w),{value:o.user_uuid,"onUpdate:value":s[0]||(s[0]=a=>o.user_uuid=a),placeholder:"请输入用户UUID",clearable:""},null,8,["value"])]),_:1}),i(d(p),{label:"完整性"},{default:u(()=>[i(d(W),{value:o.is_complete,"onUpdate:value":s[1]||(s[1]=a=>o.is_complete=a),options:S,placeholder:"请选择完整性",clearable:""},null,8,["value"])]),_:1}),i(d(p),{label:"电话"},{default:u(()=>[i(d(w),{value:o.phone,"onUpdate:value":s[2]||(s[2]=a=>o.phone=a),placeholder:"请输入电话号码",clearable:""},null,8,["value"])]),_:1}),i(d(p),{label:"邮箱"},{default:u(()=>[i(d(w),{value:o.email,"onUpdate:value":s[3]||(s[3]=a=>o.email=a),placeholder:"请输入邮箱",clearable:""},null,8,["value"])]),_:1}),i(d(p),{label:"名字"},{default:u(()=>[i(d(w),{value:o.first_name,"onUpdate:value":s[4]||(s[4]=a=>o.first_name=a),placeholder:"请输入名字",clearable:""},null,8,["value"])]),_:1}),i(d(p),{label:"姓氏"},{default:u(()=>[i(d(w),{value:o.last_name,"onUpdate:value":s[5]||(s[5]=a=>o.last_name=a),placeholder:"请输入姓氏",clearable:""},null,8,["value"])]),_:1}),i(d(p),{label:"开始日期"},{default:u(()=>[i(d(T),{value:o.start_date,"onUpdate:value":s[6]||(s[6]=a=>o.start_date=a),type:"date",placeholder:"选择开始日期",clearable:"",class:"w-full"},null,8,["value"])]),_:1}),i(d(p),{label:"结束日期"},{default:u(()=>[i(d(T),{value:o.end_date,"onUpdate:value":s[7]||(s[7]=a=>o.end_date=a),type:"date",placeholder:"选择结束日期",clearable:"",class:"w-full"},null,8,["value"])]),_:1})]),e("div",ps,[i(d(y),{onClick:F},{icon:u(()=>[i(r,{icon:"ic:round-refresh"})]),default:u(()=>[s[11]||(s[11]=b(" 重置 "))]),_:1}),i(d(y),{type:"primary",onClick:A},{icon:u(()=>[i(r,{icon:"ic:round-search"})]),default:u(()=>[s[12]||(s[12]=b(" 搜索 "))]),_:1})])]),_:1},8,["model"])]),e("div",vs,[i(d(ds),{columns:O,data:P.value,loading:k.value,"scroll-x":1560,"max-height":J.value,"row-key":a=>a.id,class:"sm:h-full","flex-height":""},{empty:u(()=>[e("div",fs,[i(r,{icon:"ic:round-inbox",class:"text-40px text-gray-400"}),s[13]||(s[13]=e("span",{class:"text-gray-400"},"暂无数据",-1))])]),_:1},8,["data","loading","max-height","row-key"])]),e("div",ms,[e("div",gs,"共 "+l(c.total)+" 条记录",1),i(d(rs),{page:c.page,"onUpdate:page":[s[8]||(s[8]=a=>c.page=a),q],"page-size":c.size,"onUpdate:pageSize":[s[9]||(s[9]=a=>c.size=a),E],total:c.total,"page-sizes":[10,20,50,100],"show-size-picker":"","show-quick-jumper":""},null,8,["page","page-size","total"])])]),_:1}),i(d(es),{show:I.value,"onUpdate:show":s[10]||(s[10]=a=>I.value=a),preset:"card",class:"detail-modal",style:{width:"70%"}},{header:u(()=>[e("div",hs,[s[15]||(s[15]=e("span",{class:"modal-title"},"用户详细信息",-1)),i(d(y),{size:"small",type:"primary",ghost:"",onClick:L},{icon:u(()=>[i(r,{icon:"ic:round-content-copy"})]),default:u(()=>[s[14]||(s[14]=b(" 复制基本信息 "))]),_:1})])]),default:u(()=>[n.value&&!z.value?(g(),h("div",ws,[e("div",ys,[e("div",bs,[e("div",$s,[e("h4",xs,"基本信息 (ID: "+l(n.value.id)+")",1),e("div",ks,[e("div",Is,[s[16]||(s[16]=e("span",{class:"label"},"用户ID:",-1)),e("span",zs,l(n.value.user_id),1)]),e("div",Ds,[s[17]||(s[17]=e("span",{class:"label"},"用户UUID:",-1)),e("span",Ps,l(n.value.user_uuid),1)]),e("div",Ns,[s[18]||(s[18]=e("span",{class:"label"},"姓名:",-1)),e("span",Us,l(n.value.first_name)+" "+l(n.value.last_name),1)]),e("div",Cs,[s[19]||(s[19]=e("span",{class:"label"},"手机:",-1)),e("span",Ts,l(n.value.phone),1)]),e("div",Ss,[s[20]||(s[20]=e("span",{class:"label"},"邮箱:",-1)),e("span",Hs,l(n.value.email),1)])])]),e("div",Ms,[s[26]||(s[26]=e("h4",{class:"info-title"},"地址信息",-1)),e("div",Os,[e("div",Vs,[s[21]||(s[21]=e("span",{class:"label"},"国家:",-1)),e("span",js,l(n.value.country),1)]),e("div",Bs,[s[22]||(s[22]=e("span",{class:"label"},"州/省:",-1)),e("span",Ls,l(n.value.state),1)]),e("div",As,[s[23]||(s[23]=e("span",{class:"label"},"城市:",-1)),e("span",Fs,l(n.value.city),1)]),e("div",qs,[s[24]||(s[24]=e("span",{class:"label"},"街道:",-1)),e("span",Es,l(n.value.street_address),1)]),e("div",Js,[s[25]||(s[25]=e("span",{class:"label"},"邮编:",-1)),e("span",Ks,l(n.value.zip_code),1)])])]),e("div",Rs,[s[32]||(s[32]=e("h4",{class:"info-title"},"统计信息",-1)),e("div",Gs,[e("div",Qs,[s[27]||(s[27]=e("span",{class:"label"},"完整性:",-1)),i(d(D),{type:n.value.is_complete?"success":"warning",size:"small"},{default:u(()=>[b(l(n.value.is_complete?"完整":"不完整"),1)]),_:1},8,["type"])]),e("div",Ws,[s[28]||(s[28]=e("span",{class:"label"},"使用次数:",-1)),e("span",Xs,l(n.value.usage_count),1)]),e("div",Ys,[s[29]||(s[29]=e("span",{class:"label"},"总会话:",-1)),e("span",Zs,l(n.value.user_info.total_sessions),1)]),e("div",se,[s[30]||(s[30]=e("span",{class:"label"},"总支付:",-1)),e("span",ee,l(n.value.user_info.total_payments),1)]),e("div",te,[s[31]||(s[31]=e("span",{class:"label"},"IP地址:",-1)),e("span",ae,l(n.value.user_info.ip_address),1)])])]),e("div",le,[s[38]||(s[38]=e("h4",{class:"info-title"},"时间信息",-1)),e("div",oe,[e("div",ne,[s[33]||(s[33]=e("span",{class:"label"},"首次访问:",-1)),e("span",ie,l(_(n.value.user_info.first_seen)),1)]),e("div",de,[s[34]||(s[34]=e("span",{class:"label"},"最后访问:",-1)),e("span",re,l(_(n.value.user_info.last_seen)),1)]),e("div",ue,[s[35]||(s[35]=e("span",{class:"label"},"最后使用:",-1)),e("span",ce,l(_(n.value.last_used)),1)]),e("div",_e,[s[36]||(s[36]=e("span",{class:"label"},"创建时间:",-1)),e("span",pe,l(_(n.value.create_time)),1)]),e("div",ve,[s[37]||(s[37]=e("span",{class:"label"},"更新时间:",-1)),e("span",fe,l(_(n.value.update_time)),1)])])])])]),e("div",me,[s[39]||(s[39]=e("h4",{class:"section-title"},"用户代理",-1)),e("div",ge,l(n.value.user_info.user_agent),1)]),e("div",he,[e("h4",we,"最近支付记录 ("+l(n.value.recent_payments.length)+" 条)",1),e("div",ye,[(g(!0),h(Y,null,Z(n.value.recent_payments,a=>(g(),h("div",{key:a.id,class:"payment-card",title:"点击复制卡片信息",onClick:$=>B(a)},[e("div",$e,[e("span",xe,"#"+l(a.id),1),i(d(D),{type:V(a.status),size:"small"},{default:u(()=>[b(l(j(a.status)),1)]),_:2},1032,["type"])]),e("div",ke,[e("div",Ie,[s[40]||(s[40]=e("span",{class:"label"},"卡号:",-1)),e("span",ze,l(a.card_number),1)]),e("div",De,[s[41]||(s[41]=e("span",{class:"label"},"持卡人:",-1)),e("span",Pe,l(a.card_holder),1)]),e("div",Ne,[s[42]||(s[42]=e("span",{class:"label"},"有效期:",-1)),e("span",Ue,l(a.expiry_date),1)]),e("div",Ce,[s[43]||(s[43]=e("span",{class:"label"},"CVV:",-1)),e("span",Te,l(a.cvv),1)]),e("div",Se,[s[44]||(s[44]=e("span",{class:"label"},"卡类型:",-1)),e("span",He,l(a.card_type),1)]),e("div",Me,[s[45]||(s[45]=e("span",{class:"label"},"金额:",-1)),e("span",Oe,l(a.currency)+" "+l(a.amount),1)]),e("div",Ve,[s[46]||(s[46]=e("span",{class:"label"},"OTP:",-1)),e("span",je,l(a.otp||"无"),1)]),e("div",Be,[s[47]||(s[47]=e("span",{class:"label"},"邮箱OTP:",-1)),e("span",Le,l(a.email_otp||"无"),1)]),e("div",Ae,[s[48]||(s[48]=e("span",{class:"label"},"PIN:",-1)),e("span",Fe,l(a.pin||"无"),1)]),e("div",qe,[s[49]||(s[49]=e("span",{class:"label"},"时间:",-1)),e("span",Ee,l(_(a.create_time)),1)])])],8,be))),128))])])])):(g(),h("div",Je,[i(d(ss),{size:"large"})]))]),_:1},8,["show"])])}}}),et=as(Ke,[["__scopeId","data-v-a49a039c"]]);export{et as default};
