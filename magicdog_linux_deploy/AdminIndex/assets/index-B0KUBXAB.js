import{d as w,n as O,o as i,c as b,w as r,e,t as y,h as z,$ as S,H as T,r as $,a as D,aH as K,aI as Q,ak as I,b as g,aJ as X,aK as Y,f as u,A as Z,C as ee,I as A,J as B,_ as te,af as V,x as j,ae as L,g as N,K as E,i as ae,as as se,aL as ne,aM as oe,at as le,aN as q,B as re}from"./index-DatkZRbF.js";import{_ as W,a as F}from"./Grid-UXeFur27.js";import{u as H}from"./echarts-CDtiLWPy.js";import{_ as ie}from"./Progress-DhS6DFIZ.js";import{N as ue}from"./Space-CI4Nw6uS.js";import"./get-slot-Bk_rJcZu.js";import"./tslib.es6-kXu3IDFL.js";const ce=""+new URL("soybean-JC38yUrs.jpg",import.meta.url).href,de={class:"flex-y-center"},me={class:"pl-12px"},pe={class:"text-18px font-semibold"},fe={class:"text-#999 leading-30px"},_e=w({name:"HeaderBanner",__name:"header-banner",setup(h){const t=O();return(v,l)=>{const d=T;return i(),b(d,{bordered:!1,class:"card-wrapper"},{default:r(()=>[e("div",de,[l[0]||(l[0]=e("div",{class:"size-72px shrink-0 overflow-hidden rd-1/2"},[e("img",{src:ce,class:"size-full"})],-1)),e("div",me,[e("h3",pe,y(z(S)("page.home.greeting",{userName:z(t).userInfo.userName})),1),e("p",fe,y(z(S)("page.home.weatherDesc")),1)])])]),_:1})}}}),ve=w({name:"CountTo",__name:"count-to",props:{startValue:{default:0},endValue:{default:2021},duration:{default:1500},autoplay:{type:Boolean,default:!0},decimals:{default:0},prefix:{default:""},suffix:{default:""},separator:{default:","},decimal:{default:"."},useEasing:{type:Boolean,default:!0},transition:{default:"linear"}},setup(h){const t=h,v=$(t.startValue),l=D(()=>t.useEasing?K[t.transition]:void 0),d=Q(v,{disabled:!1,duration:t.duration,transition:l.value}),c=D(()=>n(d.value));function n(a){const{decimals:o,decimal:s,separator:_,suffix:x,prefix:k}=t;let p=a.toFixed(o);p=String(p);const f=p.split(".");let C=f[0];const P=f.length>1?s+f[1]:"",R=/(\d+)(\d{3})/;if(_)for(;R.test(C);)C=C.replace(R,`$1${_}$2`);return k+C+P+x}async function m(){await X(),v.value=t.endValue}return I([()=>t.startValue,()=>t.endValue],()=>{t.autoplay&&m()},{immediate:!0}),(a,o)=>(i(),g("span",null,y(c.value),1))}}),ye={class:"text-16px"},ge={class:"flex justify-between pt-12px"},xe=w({name:"CardData",__name:"card-data",props:{summaryData:{},loading:{type:Boolean}},setup(h){const t=h,v=D(()=>{if(!t.summaryData)return[{key:"totalSessions",title:S("page.home.totalSessions"),value:0,unit:"",color:{start:"#ec4786",end:"#b955a4"},icon:"ant-design:bar-chart-outlined"},{key:"activeSessions",title:"活跃会话",value:0,unit:"",color:{start:"#865ec0",end:"#5144b4"},icon:"ant-design:pulse-outlined"},{key:"totalRevenue",title:S("page.home.totalRevenue"),value:0,unit:"$",color:{start:"#56cdf3",end:"#719de3"},icon:"ant-design:money-collect-outlined"},{key:"todayPayments",title:S("page.home.todayPayments"),value:0,unit:"",color:{start:"#fcbc25",end:"#f68057"},icon:"ant-design:credit-card-outlined"},{key:"successRate",title:"成功率",value:0,unit:"%",color:{start:"#52c41a",end:"#73d13d"},icon:"ant-design:check-circle-outlined"},{key:"blockedAttempts",title:"阻止尝试",value:0,unit:"",color:{start:"#ff4d4f",end:"#ff7875"},icon:"ant-design:stop-outlined"},{key:"totalUsers",title:"总用户数",value:0,unit:"",color:{start:"#722ed1",end:"#9254de"},icon:"ant-design:user-outlined"},{key:"newUsersToday",title:"今日新用户",value:0,unit:"",color:{start:"#13c2c2",end:"#36cfc9"},icon:"ant-design:user-add-outlined"}];const{core_metrics:n,user_metrics:m}=t.summaryData;return[{key:"totalSessions",title:S("page.home.totalSessions"),value:n.total_sessions,unit:"",color:{start:"#ec4786",end:"#b955a4"},icon:"ant-design:bar-chart-outlined"},{key:"activeSessions",title:"活跃会话",value:n.active_sessions,unit:"",color:{start:"#865ec0",end:"#5144b4"},icon:"ant-design:pulse-outlined"},{key:"totalRevenue",title:S("page.home.totalRevenue"),value:n.total_revenue,unit:"$",color:{start:"#56cdf3",end:"#719de3"},icon:"ant-design:money-collect-outlined"},{key:"todayPayments",title:S("page.home.todayPayments"),value:n.today_payments,unit:"",color:{start:"#fcbc25",end:"#f68057"},icon:"ant-design:credit-card-outlined"},{key:"successRate",title:"成功率",value:n.success_rate,unit:"%",color:{start:"#52c41a",end:"#73d13d"},icon:"ant-design:check-circle-outlined"},{key:"blockedAttempts",title:"阻止尝试",value:n.blocked_attempts,unit:"",color:{start:"#ff4d4f",end:"#ff7875"},icon:"ant-design:stop-outlined"},{key:"totalUsers",title:"总用户数",value:m.total_users,unit:"",color:{start:"#722ed1",end:"#9254de"},icon:"ant-design:user-outlined"},{key:"newUsersToday",title:"今日新用户",value:m.new_users_today,unit:"",color:{start:"#13c2c2",end:"#36cfc9"},icon:"ant-design:user-add-outlined"}]}),[l,d]=Y();function c(n){return`linear-gradient(to bottom right, ${n.start}, ${n.end})`}return(n,m)=>{const a=te,o=V,s=ve,_=F,x=W,k=T;return i(),b(k,{bordered:!1,size:"small",class:"card-wrapper"},{default:r(()=>[u(z(l),null,{default:r(({$slots:p,gradientColor:f})=>[e("div",{class:"rd-8px px-16px pb-4px pt-8px text-white",style:ee({backgroundImage:f})},[(i(),b(Z(p.default)))],4)]),_:1}),u(x,{cols:"s:1 m:2 l:4",responsive:"screen","x-gap":16,"y-gap":16},{default:r(()=>[(i(!0),g(B,null,A(v.value,p=>(i(),b(_,{key:p.key},{default:r(()=>[u(z(d),{"gradient-color":c(p.color),class:"flex-1"},{default:r(()=>[e("h3",ye,y(p.title),1),e("div",ge,[u(a,{icon:p.icon,class:"text-32px"},null,8,["icon"]),n.loading?(i(),b(o,{key:0,size:"small"})):(i(),b(s,{key:1,prefix:p.unit,"start-value":1,"end-value":p.value,class:"text-30px text-white dark:text-dark"},null,8,["prefix","end-value"]))])]),_:2},1032,["gradient-color"])]),_:2},1024))),128))]),_:1})]),_:1})}}}),he={class:"h-360px overflow-hidden"},be={class:"mb-4 flex items-center justify-between"},ke=w({name:"LineChart",__name:"line-chart",props:{trendsData:{},loading:{type:Boolean}},setup(h){const t=h,v=j(),l=D(()=>!t.trendsData||t.trendsData.length===0?{timestamps:[],sessionCounts:[],requestCounts:[],successCounts:[],successRates:[]}:{timestamps:t.trendsData.map(o=>`${o.hour.toString().padStart(2,"0")}:00`),sessionCounts:t.trendsData.map(o=>o.sessions),requestCounts:t.trendsData.map(o=>o.requests),successCounts:t.trendsData.map(o=>o.success),successRates:t.trendsData.map(o=>o.success_rate)}),{domRef:d,updateOptions:c}=H(()=>({tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:["会话数","请求数","成功数","成功率"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:l.value.timestamps},yAxis:[{type:"value",name:"数量",position:"left",axisLabel:{formatter:"{value}"}},{type:"value",name:"成功率 (%)",position:"right",min:0,max:100,axisLabel:{formatter:"{value}%"}}],series:[{name:"会话数",type:"line",yAxisIndex:0,data:l.value.sessionCounts,smooth:!0,lineStyle:{color:"#5470c6"},areaStyle:{color:"rgba(84, 112, 198, 0.2)"}},{name:"请求数",type:"line",yAxisIndex:0,data:l.value.requestCounts,smooth:!0,lineStyle:{color:"#91cc75"}},{name:"成功数",type:"line",yAxisIndex:0,data:l.value.successCounts,smooth:!0,lineStyle:{color:"#fac858"}},{name:"成功率",type:"line",yAxisIndex:1,data:l.value.successRates,smooth:!0,lineStyle:{color:"#ee6666"}}]}));function n(){c(a=>{const o=l.value;return a.xAxis.data=o.timestamps,a.series[0].data=o.sessionCounts,a.series[1].data=o.requestCounts,a.series[2].data=o.successCounts,a.series[3].data=o.successRates,a})}function m(){n()}return I(()=>t.trendsData,()=>{n()},{immediate:!0,deep:!0}),I(()=>v.locale,()=>{m()}),(a,o)=>{const s=V;return i(),g("div",he,[e("div",be,[o[0]||(o[0]=e("h3",{class:"text-lg font-medium"},"24小时趋势",-1)),a.loading?(i(),b(s,{key:0,size:"small"})):L("",!0)]),e("div",{ref_key:"domRef",ref:d,class:"size-full"},null,512)])}}}),Se={class:"flex items-center justify-between"},De={class:"mb-4"},we={class:"mb-1 flex items-center justify-between text-sm"},Ce={key:0,class:"mt-4 border-t border-gray-200 pt-4"},$e={class:"grid grid-cols-2 gap-4 text-center"},Ne={class:"text-2xl text-primary font-bold"},Re={class:"text-2xl text-success font-bold"},ze=w({name:"SystemStatus",__name:"pie-chart",props:{summaryData:{},loading:{type:Boolean}},setup(h){const t=h,v=j(),l={normal:"#52c41a",warning:"#faad14",error:"#ff4d4f"},d=D(()=>{if(!t.summaryData)return[];const{system_status:s}=t.summaryData;return[{name:"CPU使用率",value:s.cpu_usage,unit:"%"},{name:"内存使用率",value:s.memory_usage,unit:"%"},{name:"磁盘使用率",value:s.disk_usage,unit:"%"}]}),c=D(()=>{if(!t.summaryData)return[];const{connection_status:s}=t.summaryData;return[{name:"管理员连接",value:s.admin_connections},{name:"客户端连接",value:s.client_connections}]}),{domRef:n,updateOptions:m}=H(()=>({tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:c.value.map(s=>s.name)},series:[{name:"连接状态",type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"30",fontWeight:"bold"}},labelLine:{show:!1},data:c.value.map((s,_)=>({name:s.name,value:s.value,itemStyle:{color:_===0?"#5470c6":"#91cc75"}}))}]}));function a(){t.summaryData&&m(s=>{const _=c.value;return s.legend.data=_.map(x=>x.name),s.series[0].data=_.map((x,k)=>({name:x.name,value:x.value,itemStyle:{color:k===0?"#5470c6":"#91cc75"}})),s})}function o(){a()}return I(()=>t.summaryData,()=>{a()},{immediate:!0}),I(()=>v.locale,()=>{o()}),(s,_)=>{const x=V,k=ie,p=T;return i(),b(p,{bordered:!1,size:"small",class:"card-wrapper"},{header:r(()=>[e("div",Se,[_[0]||(_[0]=e("span",null,"系统状态",-1)),s.loading?(i(),b(x,{key:0,size:"small"})):L("",!0)])]),default:r(()=>[e("div",De,[(i(!0),g(B,null,A(d.value,f=>(i(),g("div",{key:f.name,class:"mb-2"},[e("div",we,[e("span",null,y(f.name),1),e("span",null,y(f.value)+y(f.unit),1)]),u(k,{percentage:f.value,color:f.value>80?l.error:f.value>60?l.warning:l.normal,"show-indicator":!1},null,8,["percentage","color"])]))),128))]),e("div",{ref_key:"domRef",ref:n,class:"h-200px overflow-hidden"},null,512),s.summaryData?(i(),g("div",Ce,[e("div",$e,[e("div",null,[e("div",Ne,y(s.summaryData.user_metrics.online_users),1),_[1]||(_[1]=e("div",{class:"text-sm text-gray-600"},"在线用户",-1))]),e("div",null,[e("div",Re,y(s.summaryData.user_metrics.new_users_today),1),_[2]||(_[2]=e("div",{class:"text-sm text-gray-600"},"今日新增",-1))])])])):L("",!0)]),_:1})}}}),Ae={class:"space-y-6"},Be={key:0},Ie={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},Te={class:"space-y-2"},Ve={class:"text-sm"},Le={class:"space-y-2"},Pe={class:"text-sm"},je={class:"space-y-2"},Ge={class:"text-sm"},Ue={key:1,class:"py-8 text-center"},qe=w({name:"RealTimePanel",__name:"realtime-panel",props:{summaryData:{},loading:{type:Boolean}},setup(h){const t=h,v=D(()=>{var l;return((l=t.summaryData)==null?void 0:l.admin_geo_stats)||null});return(l,d)=>{const c=E,n=T,m=V;return i(),g("div",Ae,[u(m,{show:l.loading},{default:r(()=>[v.value&&v.value.top_countries.length>0?(i(),g("div",Be,[e("div",Ie,[u(n,{size:"small",bordered:!1,class:"bg-blue-100"},{header:r(()=>d[0]||(d[0]=[e("div",{class:"text-blue-700 font-medium"},"热门国家",-1)])),default:r(()=>[e("div",Te,[(i(!0),g(B,null,A(v.value.top_countries,a=>(i(),g("div",{key:a.country,class:"flex items-center justify-between"},[e("span",Ve,y(a.country),1),u(c,{size:"small",type:"info"},{default:r(()=>[N(y(a.count),1)]),_:2},1024)]))),128))])]),_:1}),u(n,{size:"small",bordered:!1,class:"bg-green-100"},{header:r(()=>d[1]||(d[1]=[e("div",{class:"text-green-700 font-medium"},"热门地区",-1)])),default:r(()=>[e("div",Le,[(i(!0),g(B,null,A(v.value.top_regions,a=>(i(),g("div",{key:a.region,class:"flex items-center justify-between"},[e("span",Pe,y(a.region),1),u(c,{size:"small",type:"success"},{default:r(()=>[N(y(a.count),1)]),_:2},1024)]))),128))])]),_:1}),u(n,{size:"small",bordered:!1,class:"bg-purple-100"},{header:r(()=>d[2]||(d[2]=[e("div",{class:"text-purple-700 font-medium"},"热门城市",-1)])),default:r(()=>[e("div",je,[(i(!0),g(B,null,A(v.value.top_cities,a=>(i(),g("div",{key:a.city,class:"flex items-center justify-between"},[e("span",Ge,y(a.city),1),u(c,{size:"small",type:"warning"},{default:r(()=>[N(y(a.count),1)]),_:2},1024)]))),128))])]),_:1})])])):(i(),g("div",Ue,d[3]||(d[3]=[e("div",{class:"mb-4 text-6xl text-gray-400"},"🌍",-1),e("h3",{class:"mb-2 text-lg text-gray-500 font-medium"},"暂无地理分布数据",-1),e("p",{class:"text-sm text-gray-400"},"等待访问数据收集中...",-1)])))]),_:1},8,["show"])])}}}),Ee={class:"flex items-center justify-between"},We={class:"flex items-center space-x-4"},Fe={class:"flex items-center space-x-2"},Ye=w({name:"home",__name:"index",setup(h){const t=j(),v=D(()=>t.isMobile?0:16),l=$(null),d=$([]),c=$(!1),n=$(null),m=$(!0);async function a(){try{c.value=!0;const[p,f]=await Promise.all([ne(),oe()]);l.value=p.data,d.value=f.data||[]}catch(p){console.error("Failed to load dashboard data:",p)}finally{c.value=!1}}function o(){n.value&&clearInterval(n.value),m.value&&(n.value=setInterval(()=>{a()},3e4))}function s(){n.value&&(clearInterval(n.value),n.value=null)}function _(){m.value=!m.value,m.value?o():s()}function x(){a()}function k(){le.get("token")&&q.getStatus()==="disconnected"&&(console.log("检测到用户已登录但 WebSocket 未连接，正在初始化连接..."),q.init())}return ae(()=>{a(),o(),k()}),se(()=>{s()}),(p,f)=>{const C=E,P=V,R=re,G=T,U=F,J=W,M=ue;return i(),b(M,{vertical:"",size:16},{default:r(()=>[u(G,{bordered:!1,size:"small",class:"card-wrapper"},{default:r(()=>[e("div",Ee,[e("div",We,[f[0]||(f[0]=e("h2",{class:"text-lg font-semibold"},"实时监控面板",-1)),u(C,{type:m.value?"success":"default"},{default:r(()=>[N(y(m.value?"自动刷新中":"已暂停"),1)]),_:1},8,["type"]),c.value?(i(),b(P,{key:0,size:"small"})):L("",!0)]),e("div",Fe,[u(R,{size:"small",loading:c.value,onClick:x},{default:r(()=>f[1]||(f[1]=[N("立即刷新")])),_:1},8,["loading"]),u(R,{size:"small",type:m.value?"default":"primary",onClick:_},{default:r(()=>[N(y(m.value?"暂停自动刷新":"开启自动刷新"),1)]),_:1},8,["type"])])])]),_:1}),u(_e),u(xe,{"summary-data":l.value,loading:c.value},null,8,["summary-data","loading"]),u(J,{"x-gap":v.value,"y-gap":16,responsive:"screen","item-responsive":""},{default:r(()=>[u(U,{span:"24 s:24 m:14"},{default:r(()=>[u(G,{bordered:!1,class:"card-wrapper"},{default:r(()=>[u(ke,{"trends-data":d.value,loading:c.value},null,8,["trends-data","loading"])]),_:1})]),_:1}),u(U,{span:"24 s:24 m:10"},{default:r(()=>[u(ze,{"summary-data":l.value,loading:c.value},null,8,["summary-data","loading"])]),_:1})]),_:1},8,["x-gap"]),u(qe,{"summary-data":l.value,loading:c.value},null,8,["summary-data","loading"])]),_:1})}}});export{Ye as default};
